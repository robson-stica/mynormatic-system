
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Normatic - Portal Normatic</title>
        <script>
            // Enable Tailwind dark mode using the 'class' strategy
            window.tailwind = window.tailwind || {};
            window.tailwind.config = { darkMode: 'class' };
        </script>
        <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Leaflet (mapa interativo) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Adicionando a biblioteca Marked.js para renderizar Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- SheetJS para leitura de arquivos Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- EmailJS para envio de e-mails -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        /* Estilos Gerais */
        body { 
            font-family: 'Montserrat', sans-serif;
            background-color: #f8f9fa;
            color: #222;
        }
        :root { color-scheme: light dark; }

        /* Estilos do Cabeçalho */
        .header-top {
            background: #ffffff; 
            padding: 20px 40px;
            border-bottom: 1px solid #e5e7eb;
        }

        /* ====== ESTILOS DO CHAT (fale_conosco.html) ====== */
        #chat-window::-webkit-scrollbar {
            width: 8px;
        }
        #chat-window::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* gray-300 */
            border-radius: 4px;
        }
        .chat-bubble-user {
            background-color: #2563eb; /* blue-600 */
            color: white;
            border-radius: 18px 18px 2px 18px;
        }
        .chat-bubble-ai {
            background-color: #ffffff;
            color: #1f2937; /* gray-800 */
            border-radius: 18px 18px 18px 2px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }
        .citation {
            font-size: 0.7rem;
            color: #9ca3af; /* gray-400 */
            margin-top: 0.5rem;
            display: block;
        }
        .citation a {
            color: #2563eb;
            text-decoration: none;
        }
        /* Animação do indicador de digitação */
        .dot-flashing {
            position: relative;
            width: 5px;
            height: 5px;
            border-radius: 5px;
            background-color: #94a3b8; /* slate-400 */
            color: #94a3b8;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: 0s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: "";
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -10px;
            width: 5px;
            height: 5px;
            border-radius: 5px;
            background-color: #94a3b8;
            color: #94a3b8;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: 0.3s;
        }
        .dot-flashing::after {
            left: 10px;
            width: 5px;
            height: 5px;
            border-radius: 5px;
            background-color: #94a3b8;
            color: #94a3b8;
            animation: dotFlashing 1s infinite linear alternate;
            animation-delay: 0.6s;
        }
        @keyframes dotFlashing {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        /* ====== FIM DOS ESTILOS DO CHAT ====== */

        /* Tamanho mínimo dos boxes de funcionalidades igual ao box de login */
        .min-func-box {
            height: calc(100vh - 96px - 16px); /* 96px header + 16px gap */
            min-height: calc(100vh - 96px - 16px);
            max-height: calc(100vh - 32px); /* nunca ultrapassa a tela, deixa espaço para header/footer */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: stretch;
        }
        .header-top .container {
            position: relative;
            display: flex;
            justify-content: center; 
            align-items: center;
        }
        
        .main-nav-bar {
            background: #173c58;
            padding: 20px 40px;
        }
        .main-nav-bar ul {
            display: flex;
            justify-content: space-between;
            width: 100%;
            list-style: none;
            letter-spacing: 0.5px;
            transition: font-size 0.3s ease;
        }
        .main-nav-bar a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.2rem;
            white-space: nowrap; /* Impede que o texto do link quebre */
            transition: color 0.2s, font-size 0.3s ease;
        }
        .main-nav-bar a:hover {
            color: #e01818;
        }
        
        /* Estilos do Portal */
        .normatic-red-text { color: #ca3828; }
        .normatic-blue-text { color: #173c58; }
        .normatic-transparent-text { color: transparent; }
        
        .btn-primary {
            background-color: #ca3828;
            color: white;
            font-weight: 600;
            border-radius: 6px;
            padding: 12px 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Leaflet helpers */
        #leaflet-map { width: 100%; height: 100%; }
        .truck-icon { font-size: 22px; line-height: 1; }
        .btn-primary:hover {
            background-color: #b02f21;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            background-color: #fca5a5;
            cursor: not-allowed;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .nav-item.active { 
            background-color: rgba(202, 56, 40, 0.1);
            color: #ca3828; 
            font-weight: 600;
        }
        
        .banner-img {
            width: 100%;
            display: block;
        }
        
        .page-content {
            display: none;
        }
        .page-content.active {
            display: flex;
            flex-direction: column;
        }

        #page-recomendacoes .view {
            display: none;
        }
        #page-recomendacoes .view.active {
            display: block;
        }
        @keyframes spin { from { opacity: 0; transform: rotate(0deg); } to { opacity: 1; transform: rotate(360deg); } }
        .spinner { 
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        .chat-bubble { max-width: 75%; }
        .chat-bubble-user { background-color: #173c58; color: white; }
        .chat-bubble-ai { background-color: #e5e7eb; color: #1f2937; }
        .chat-bubble-ai ul { list-style-type: disc; margin-left: 20px; }
        .chat-bubble-ai p { margin-bottom: 8px; }
        .chat-bubble-specialist { background-color: #dcfce7; color: #166534; border-left: 3px solid #22c55e; }
        
        /* Estilos de Citação/Fonte para o Consultor IA */
        .ai-source-box {
            background-color: #f0f9ff; /* blue-50 */
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding: 12px;
            margin-top: 10px;
            border-radius: 0 4px 4px 0;
            font-size: 0.85rem;
            color: #1e40af; /* blue-800 */
        }
        .ai-source-box a {
            color: #1d4ed8; /* blue-700 */
            text-decoration: underline;
        }

        /* ====== TAMANHO DO GRÁFICO DE PIZZA EM TRATAMENTOS ====== */
        /* Reduz o tamanho somente do gráfico de Carga por Tipo de Forno e centraliza */
        #tratamentosChart {
            width: 460px !important;
            height: 460px !important;
            display: block;
            margin: 0 auto;
            transform: translateY(-48px); /* desloca para cima no quadro */
        }
        @media (max-width: 500px) {
            #tratamentosChart {
                width: 360px !important;
                height: 360px !important;
                transform: translateY(-32px);
            }
        }

        /* ========================= */
        /*  LIGHT MODE ADMIN FIXES   */
        /* ========================= */
        /* Garante que o card do cadastro fique claro no modo claro */
        html:not(.dark) #page-cadastro-clientes #cadastro-cliente-form {
            background-color: #ffffff !important;
            border-color: #e5e7eb !important; /* gray-200 */
        }
        /* Garante que os cards de clientes fiquem claros no modo claro */
        html:not(.dark) #page-lista-clientes #clientes-list > div {
            background-color: #ffffff !important;
            border-color: #e5e7eb !important;
        }
        html:not(.dark) #page-editar-clientes #editar-clientes-list > div {
            background-color: #ffffff !important;
            border-color: #e5e7eb !important;
        }

        /* ========================= */
        /*   LIGHT MODE CONTRAST     */
        /* ========================= */
        /* Em modo claro, use o azul escuro do sistema para textos antes acinzentados */
        html:not(.dark) .page-content .text-gray-500,
        html:not(.dark) .page-content .text-gray-600,
        html:not(.dark) .page-content .text-gray-700 {
            color: #0f2742 !important; /* azul escuro do sistema */
        }
        
        /* Nome das empresas em azul escuro no modo claro */
        html:not(.dark) .cliente-item h3,
        html:not(.dark) .cliente-item-editar h3 {
            color: #0f2742 !important; /* azul escuro do sistema */
        }
        
        /* Dados de cadastro expandidos em azul no modo claro */
        html:not(.dark) .cliente-details .text-gray-900,
        html:not(.dark) .cliente-details-editar .text-gray-900 {
            color: #0f2742 !important; /* azul escuro do sistema */
        }
        
        /* Hover dos cards de clientes igual ao menu (gray-200 no claro) */
        html:not(.dark) .cliente-item:hover,
        html:not(.dark) .cliente-item-editar:hover {
            background-color: #e5e7eb !important; /* gray-200 */
        }

        /* ========================= */
        /* LIGHT: RASTREAMENTO FIXES */
        /* ========================= */
        /* Caixas claras e texto com contraste adequado no rastreamento (modo claro) */
        html:not(.dark) #page-rastreamento .bg-white,
        html:not(.dark) #page-rastreamento .bg-gray-50 {
            background-color: #ffffff !important;
        }
        html:not(.dark) #page-rastreamento .border {
            border-color: #e5e7eb !important; /* gray-200 */
        }
        html:not(.dark) #page-rastreamento .text-gray-500,
        html:not(.dark) #page-rastreamento .text-gray-600,
        html:not(.dark) #page-rastreamento .text-gray-700,
        html:not(.dark) #page-rastreamento .text-gray-900 {
            color: #0f2742 !important; /* azul escuro do sistema */
        }
        
        /* Área expandida dos clientes sempre clara no modo claro */
        html:not(.dark) .cliente-details,
        html:not(.dark) .cliente-details-editar {
            background-color: #ffffff !important;
            border-color: #e5e7eb !important;
        }

        /* ========================= */
        /*        DARK THEME         */
        /* ========================= */
        /* Use Tailwind's dark class on <html> to apply these overrides */
        .dark body { background-color: #111827; color: #e5e7eb; }
        .dark .header-top { background: #0b1220; border-bottom-color: #374151; }
        .dark .main-nav-bar { background: #0f2742; }
        .dark .main-nav-bar a { color: #ffffff; }
        .dark .main-nav-bar a:hover { color: #f87171; }
        .dark .bg-white { background-color: #111827 !important; color: #e5e7eb; }
        .dark .bg-gray-50 { background-color: #0b1220 !important; }
    /* No dark mode, todos os textos em tons de cinza devem ficar brancos */
    .dark .text-gray-200,
    .dark .text-gray-300,
    .dark .text-gray-400,
    .dark .text-gray-500,
    .dark .text-gray-600,
    .dark .text-gray-700,
    .dark .text-gray-800,
    .dark .text-gray-900 { color: #ffffff !important; }
        .dark .border-gray-200 { border-color: #374151 !important; }
        .dark .border-gray-300 { border-color: #4b5563 !important; }
        .dark .chat-bubble-ai { background-color: #374151; color: #e5e7eb; }
        .dark .ai-source-box { background-color: #0f172a; border-left-color: #60a5fa; color: #bfdbfe; }
        .dark .ai-source-box a { color: #93c5fd; }
        .dark #calc-modal-backdrop { background-color: rgba(17,24,39,0.75); }
        /* Textos "azuis" devem ficar brancos no modo escuro */
        .dark .normatic-blue-text { 
            color: #ffffff !important;
        }
        .dark .normatic-red-text { 
            color: #ffffff !important;
        }
        .dark .timeline-step.completed h3 { color: #ffffff !important; }
    /* Ícones (Lucide e Font Awesome) mais amigáveis no escuro */
    .dark svg.lucide { stroke: #e5e7eb; }
    .dark [data-lucide] { color: #e5e7eb; }
    .dark i[class^="fa"],
    .dark i[class*=" fa-"] { color: #e5e7eb; }
    /* Botões e elementos de ação sutis no escuro */
    .dark .btn-primary { box-shadow: 0 6px 14px -4px rgba(0,0,0,0.5); }
    .dark .status-card:hover { box-shadow: 0 10px 20px -5px rgba(0,0,0,0.6); }

    /* ========================= */
    /*   DASHBOARD NUMBERS DARK  */
    /* ========================= */
    /* Cores amigáveis no escuro para os contadores dos cards */
    .dark #client-pending-count,
    .dark [data-count-type="pendente"] { color: #facc15 !important; } /* amber-400 */
    .dark #client-prod-count,
    .dark [data-count-type="producao"] { color: #60a5fa !important; } /* blue-400 */
    .dark #client-quality-count,
    .dark [data-count-type="qualidade"] { color: #a78bfa !important; } /* violet-400 */
    .dark #client-completed-count,
    .dark [data-count-type="finalizado"] { color: #34d399 !important; } /* emerald-400 */

    /* Ajuste de classes Tailwind comuns para estados no escuro (mais legíveis) */
    .dark .text-green-600, .dark .text-green-700 { color: #34d399 !important; }
    .dark .text-blue-600, .dark .text-blue-700 { color: #60a5fa !important; }
    .dark .text-orange-600, .dark .text-amber-600 { color: #f59e0b !important; }
    .dark .text-purple-600, .dark .text-violet-600, .dark .text-indigo-600 { color: #a78bfa !important; }

                /* ========================= */
                /*  INPUTS ALWAYS LIGHT UI   */
                /* ========================= */
                /* Caixas de texto claras no modo claro e escuro */
                input[type="text"],
                input[type="email"],
                input[type="password"],
                input[type="number"],
                input[type="search"],
                input[type="tel"],
                input[type="url"],
                input[type="date"],
                input[type="time"],
                textarea,
                select,
                .form-input,
                .form-textarea,
                .form-select {
                    background-color: #ffffff !important;
                    color: #111827 !important; /* gray-900 */
                    border: 1px solid #e5e7eb; /* gray-200 */
                    caret-color: #0f172a; /* slate-900 */
                }
                .dark input[type="text"],
                .dark input[type="email"],
                .dark input[type="password"],
                .dark input[type="number"],
                .dark input[type="search"],
                .dark input[type="tel"],
                .dark input[type="url"],
                .dark input[type="date"],
                .dark input[type="time"],
                .dark textarea,
                .dark select,
                .dark .form-input,
                .dark .form-textarea,
                .dark .form-select {
                    background-color: #ffffff !important;
                    color: #111827 !important;
                    border-color: #e5e7eb !important;
                    caret-color: #0f172a;
                }
                /* Placeholder visível e neutro */
                input::placeholder,
                textarea::placeholder { color: #6b7280; /* gray-500 */ opacity: 1; }
                .dark input::placeholder,
                .dark textarea::placeholder { color: #6b7280; opacity: 1; }
                /* Foco acessível */
                input:focus,
                textarea:focus,
                select:focus,
                .form-input:focus,
                .form-textarea:focus,
                .form-select:focus {
                    outline: none;
                    border-color: #2563eb; /* blue-600 */
                    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.25);
                    background-color: #ffffff;
                    color: #111827;
                }
                .dark input:focus,
                .dark textarea:focus,
                .dark select:focus,
                .dark .form-input:focus,
                .dark .form-textarea:focus,
                .dark .form-select:focus {
                    outline: none;
                    border-color: #2563eb !important;
                    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35);
                    background-color: #ffffff !important;
                    color: #111827 !important;
                }


        #hamburger-button {
            display: none;
            background: transparent;
            border: none;
            padding: 0;
            cursor: pointer;
        }

        /* Estilos da Linha do Tempo */
        .timeline-step .timeline-icon {
            transition: all 0.3s ease;
        }
        .timeline-step.completed .timeline-icon {
            background-color: #173c58; /* azul normatic */
        }
        .timeline-step.completed .timeline-icon i {
            color: white;
        }
        .timeline-step.completed h3 {
            color: #173c58;
            font-weight: 600;
        }

        .timeline-step.active .timeline-icon {
            background-color: #ca3828; /* vermelho normatic */
        }
        .timeline-step.active .timeline-icon i {
            color: white;
        }
        .timeline-step.active h3 {
            color: #ca3828;
            font-weight: 700;
        }
        
        /* Estilo para Cards Interativos */
        .status-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .status-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .status-card.active-status {
            border-color: #ca3828 !important;
            border-width: 2px;
            box-shadow: 0 4px 10px rgba(202, 56, 40, 0.3);
        }


        /* AJUSTES DE RESPONSIVIDADE PARA FONTE DO MENU */
        @media (max-width: 1200px) {
            .main-nav-bar a {
                font-size: 1.1rem;
            }
        }
        @media (max-width: 992px) {
            .main-nav-bar a {
                font-size: 1.0rem;
            }
        }
        @media (max-width: 768px) {
            .main-nav-bar a {
                font-size: 0.85rem;
            }
        }

        /* PONTO DE QUEBRA PARA CABEÇALHO EM TELAS MENORES */
        @media (max-width: 650px) {
            .header-top {
                padding-top: 16px;
                padding-bottom: 16px;
            }
            .header-top .container {
                flex-wrap: wrap;
                justify-content: space-between;
                align-items: center;
                row-gap: 16px; /* Espaço entre a linha do logo e a linha dos botões */
            }

            #home-logo-link {
                order: -1; /* Coloca o logo como primeiro item */
                width: 100%; /* Faz o logo ocupar toda a largura da primeira linha */
            }

            /* Reseta o posicionamento absoluto dos containers de botões */
            #portal-actions-container,
            #user-info {
                position: static;
                transform: none;
            }
            
            #user-info {
                flex-direction: column;
                align-items: flex-end;
                gap: 2px;
            }
            #user-info.space-x-4 > :not([hidden]) ~ :not([hidden]) {
                margin-left: 0;
            }

            .main-nav-bar a {
                font-size: 0.75rem;
            }
        }

        /* PONTO DE QUEBRA PRINCIPAL PARA MOBILE */
        @media (max-width: 500px) {
          .header-top {
            padding: 10px 8px;
          }
          .main-nav-bar {
            padding: 12px 20px;
            position: relative; 
            display: flex;
            justify-content: space-between; /* Ícone do menu à esquerda, botão à direita */
            align-items: center;
            min-height: 64px;
          }
          #hamburger-button {
              display: block; 
          }
          .main-nav-bar ul {
            display: none; /* Esconde a lista original */
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: #173c58;
            border-top: 1px solid #3b5a72;
            padding: 16px 0;
            z-index: 100;
            flex-direction: column;
            gap: 16px;
            align-items: center;
          }
          .main-nav-bar ul.menu-open {
              display: flex; /* Mostra o menu quando aberto */
          }
          .main-nav-bar a {
            font-size: 1rem; /* Tamanho da fonte dentro do menu aberto */
          }

          #main-nav #header-auth-section {
              position: static;
              transform: none;
          }
          #main-nav #header-auth-section .btn-primary {
            padding: 6px 10px;
            font-size: 0.8rem;
          }
          
          /* Ajuste para os checkboxes na tela de login */
          #login-form .flex.justify-center.gap-4 {
            flex-direction: column;
            align-items: flex-start;
            width: fit-content;
            margin: 0 auto;
          }
          
          .container {
            padding: 0 8px;
          }
          #dashboard-view {
            max-width: 100vw;
            min-width: 0;
            border-radius: 0;
            box-shadow: none;
          }
          #main-content-area {
                        padding: 8px !important;
                        display: flex;
                        flex-direction: column;
                        height: 100%;
                        min-height: calc(100vh - 96px);
                        box-sizing: border-box;
                    }
                    .page-content {
                        padding: 0 !important;
                        flex: 1 1 auto;
                        height: 100%;
                        min-height: 0;
                        overflow: auto;
                    }
                    .page-content.active {
                        display: flex;
                        flex-direction: column;
                    }
        /* Altura reduzida para gráficos do dashboard */
        .chart-short { height:160px !important; max-height:160px !important; }
    /* Opções de usuário (login) */
    .user-type-label { display:flex; align-items:center; padding:12px; border:2px solid #e5e7eb; border-radius:0.5rem; cursor:pointer; transition:background-color .15s,border-color .15s,color .15s; background-color:#ffffff; }
    .user-type-label.selected { border-color:#173c58; background-color:#e6f0f7; }
    .user-type-label .font-medium { color:#1f2937; }
    .user-type-label.selected .font-medium { color:#173c58; }
    .user-type-label:hover { border-color:#173c58; background-color:#f0f6fb; }
    /* (Removido bloco compacto gestor) */

          .main-content {
            overflow: hidden; /* Esconde a parte da imagem que transborda */
          }
          .banner-img {
            width: 100vw !important;
            max-width: 100vw !important;
            height: 150vw !important; /* 2.5x da largura da tela */
            object-fit: cover;
            object-position: left center;
            display: block;
            border-radius: 0;
          }
          /* ===== FIM DA ALTERAÇÃO ===== */

          .grid {
            grid-template-columns: 1fr !important;
          }
          .md\:grid-cols-2, .md\:grid-cols-3, .lg\:grid-cols-4, .lg\:grid-cols-5 {
            grid-template-columns: 1fr !important;
          }
          .md\:w-64, .lg\:w-64 {
            width: 100% !important;
            min-width: 0 !important;
            border-right: none !important;
            border-bottom: 1px solid #e5e7eb !important;
          }
          #calc-results-grid {
            grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
          }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="landing-page-view" class="hidden">
        <main class="main-content">
            <img src="banner2.webp" alt="Banner principal da Normatic" class="banner-img">
        </main>
    </div>

    <div id="client-portal-wrapper" class="flex-grow relative flex flex-col" style="background: linear-gradient(rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.75)), url('bannerforno.png') center/cover fixed; min-height: 100vh;">
        <!-- Elementos ocultos para compatibilidade com JavaScript -->
        <a href="#" id="home-logo-link" class="hidden"></a>
        <button id="hamburger-button" class="hidden"></button>
        
        <!-- Header fixo após login (inicialmente oculto) -->
        <div id="portal-header" class="hidden w-full h-[96px] backdrop-blur-md border-b border-white border-opacity-20 z-50" style="background-color: #173c58;">
            <div class="container mx-auto px-6 h-full flex items-center justify-between">
                <!-- Lado esquerdo: Botões de navegação -->
                <div class="flex items-center gap-3">
                    <button id="portal-toggle-button" class="flex items-center gap-2 text-sm text-white hover:text-gray-200 font-medium transition">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        <span class="hidden sm:inline">Voltar ao Site</span>
                    </button>
                    <button id="previous-function-button" class="text-sm text-white hover:text-gray-200 font-medium transition">
                        <span class="hidden sm:inline">Função Anterior</span>
                        <i data-lucide="arrow-left" class="w-4 h-4 sm:hidden"></i>
                    </button>
                </div>
                
                <!-- Centro: Logo (opcional) -->
                <div class="hidden md:block h-full flex items-center">
                    <img src="logotransparente.png" alt="Normatic" style="height: calc(96px - 4px); margin-top: 2px; margin-bottom: 2px;" class="w-auto">
                </div>
                
                <!-- Lado direito: User info e botões -->
                <div class="flex items-center gap-3">
                    <div id="user-info" class="hidden items-center gap-3">
                        <span id="username-display" class="font-semibold text-white text-sm"></span>
                        <button id="logout-button" class="text-sm text-white hover:text-red-400 flex items-center gap-1 transition">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span class="hidden sm:inline">Sair</span>
                        </button>
                    </div>
                    <button id="theme-toggle"
                            class="inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-white hover:bg-white hover:bg-opacity-10 transition border border-white border-opacity-30"
                            aria-pressed="false" title="Alternar tema">
                        <i data-lucide="moon" class="w-4 h-4"></i>
                        <span class="hidden sm:inline">Modo</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Botão Voltar ao Site (visível apenas antes do login) -->
        <a href="inicial_final.html" id="back-to-site-btn" class="absolute top-6 left-6 z-50 px-6 py-2 rounded-full font-semibold hover:shadow-xl transition transform hover:scale-105 flex items-center gap-2 text-sm text-white" style="background: linear-gradient(to right, #ca3828, #a02d1f);">
            <i class="fas fa-arrow-left"></i>
            Voltar ao Site
        </a>
        
    <main class="container mx-auto px-6 pt-[5px] pb-8 flex items-start justify-center flex-grow">
            <div id="login-view" class="w-full max-w-md fade-in">
                <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
                    <div class="p-2 pb-1 text-center" style="background: linear-gradient(to right, #173c58, #0f2942);">
                        <img src="logotransparente.png" alt="Normatic" class="h-28 w-auto mx-auto mb-1">
                        <h2 class="text-2xl font-bold text-white mb-1">Portal Normatic</h2>
                    </div>
                    <div class="p-8 pb-5">
                        <form id="login-form">
                            <div class="mb-6">
                                <label class="block text-gray-700 font-semibold mb-3 text-center">Selecione o tipo de acesso</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <label class="user-type-label flex items-center p-3 rounded-lg cursor-pointer transition">
                                        <input type="radio" name="userType" value="client" class="mr-2" style="accent-color: #173c58;" checked>
                                        <span class="font-medium">Cliente</span>
                                    </label>
                                    <label class="user-type-label flex items-center p-3 rounded-lg cursor-pointer transition">
                                        <input type="radio" name="userType" value="gestor" class="mr-2" style="accent-color: #173c58;">
                                        <span class="font-medium">Gestor</span>
                                    </label>
                                    <label class="user-type-label flex items-center p-3 rounded-lg cursor-pointer transition">
                                        <input type="radio" name="userType" value="admin" class="mr-2" style="accent-color: #173c58;">
                                        <span class="font-medium">Admin</span>
                                    </label>
                                    <label class="user-type-label flex items-center p-3 rounded-lg cursor-pointer transition">
                                        <input type="radio" name="userType" value="collaborator" class="mr-2" style="accent-color: #173c58;">
                                        <span class="font-medium">Colaborador</span>
                                    </label>
                                </div>
                            </div>
                            <div class="mb-5">
                                <label for="username" class="block text-gray-700 font-semibold mb-2">
                                    <i class="fas fa-user mr-2" style="color: #173c58;"></i>Utilizador
                                </label>
                                <input type="text" id="username" placeholder="Digite seu nome de usuário" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none transition" style="transition: all 0.2s;" onfocus="this.style.borderColor='#173c58'; this.style.boxShadow='0 0 0 3px rgba(23, 60, 88, 0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';" required>
                                <p class="text-xs text-gray-500 mt-1">Teste: Indústria Beta</p>
                            </div>
                            <div class="mb-6">
                                <label for="password" class="block text-gray-700 font-semibold mb-2">
                                    <i class="fas fa-lock mr-2" style="color: #173c58;"></i>Senha
                                </label>
                                <input type="password" id="password" value="123" placeholder="Digite sua senha" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none transition" style="transition: all 0.2s;" onfocus="this.style.borderColor='#173c58'; this.style.boxShadow='0 0 0 3px rgba(23, 60, 88, 0.1)';" onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none';" required>
                            </div>
                            <button type="submit" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-200 hover:shadow-xl transform hover:scale-105 flex items-center justify-center gap-2" style="background: linear-gradient(to right, #173c58, #0f2942);">
                                <i class="fas fa-sign-in-alt"></i>
                                Entrar no Portal
                            </button>
                        </form>
                        <div class="mt-6 text-center">
                            <a href="inicial.html" class="text-sm text-gray-600 transition flex items-center justify-center gap-2" style="transition: color 0.2s;" onmouseover="this.style.color='#173c58';" onmouseout="this.style.color='#4b5563';">
                                <i class="fas fa-arrow-left"></i>
                                Voltar ao site institucional
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dashboard-view" class="w-full max-w-7xl hidden h-full">
                <div class="bg-white rounded-lg shadow-xl overflow-hidden md:flex h-full">
                    <!-- Menu Cliente -->
                    <nav id="client-nav" class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 hidden h-full overflow-auto">
                        <ul class="space-y-2">
                            <!-- NOVO ITEM DE MENU: DASHBOARD -->
                            <li><a href="#dashboard-cliente" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="bar-chart-2" class="w-5 h-5"></i>Painel do Cliente</a></li>
                            
                            <li><a href="#consulta" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="search" class="w-5 h-5"></i>Consulta de Pedido</a></li>
                            <li><a href="#rastreamento" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="map-pin" class="w-6 h-6"></i>Entrega em Tempo Real</a></li>
                            <li><a href="#orcamento" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="file-text" class="w-5 h-5"></i>Solicitar Orçamento</a></li>
                            <li><a href="#historico" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="history" class="w-5 h-5"></i>Histórico</a></li>
                            <li><a href="#downloads" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="download" class="w-5 h-5"></i>Downloads</a></li>
                            <li><a href="#dados" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="user" class="w-5 h-5"></i>Meus Dados</a></li>
                            <li><a href="#coleta" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="truck" class="w-5 h-5"></i>Agendar Coleta</a></li>
                            <li><a href="#entrega" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="package-check" class="w-5 h-5"></i>Agendar Entrega</a></li>
                            <li><a href="#chat" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="message-circle" class="w-5 h-5"></i>Converse Conosco</a></li>
                        </ul>
                    </nav>
                    <!-- Menu Gestor (antigo Administrador) -->
                    <nav id="gestor-nav" class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 hidden h-full overflow-auto">
                        <ul class="space-y-2">
                             <li><a href="#dashboard" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="layout-dashboard" class="w-5 h-5"></i>Dashboard Geral</a></li>
                            <li><a href="#qualidade" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="award" class="w-5 h-5"></i>Qualidade</a></li>
                            <li><a href="#expedicao" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="send" class="w-5 h-5"></i>Expedição</a></li>
                            <li><a href="#tratamentos" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="flame" class="w-5 h-5"></i>Tratamentos</a></li>
                            <li><a href="#financeiro" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="landmark" class="w-5 h-5"></i>Financeiro</a></li>
                            <li><a href="#rh" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="users" class="w-5 h-5"></i>RH</a></li>
                        </ul>
                    </nav>
                    <!-- Menu Administrador (NOVO) -->
                    <nav id="admin-nav" class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 hidden h-full overflow-auto">
                        <ul class="space-y-2">
                             <li><a href="#gerenciar-pedidos" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="package" class="w-5 h-5"></i>Gerenciar Pedidos</a></li>
                             <li><a href="#uploads" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="upload-cloud" class="w-5 h-5"></i>Upload de Documentos</a></li>
                             <li><a href="#cadastro-clientes" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="user-plus" class="w-5 h-5"></i>Cadastro de Clientes</a></li>
                             <li><a href="#lista-clientes" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="users" class="w-5 h-5"></i>Clientes Cadastrados</a></li>
                             <li><a href="#editar-clientes" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="edit" class="w-5 h-5"></i>Editar Cadastros</a></li>
                        </ul>
                    </nav>
                    <!-- Menu Colaborador -->
                     <nav id="collaborator-nav" class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 hidden h-full overflow-auto">
                        <ul class="space-y-2">
                            <li><a href="#consultor-ia" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="brain-circuit" class="w-5 h-5"></i>Consultor Técnico IA</a></li>
                            <li><a href="#calculadora" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="calculator" class="w-5 h-5"></i>Calculadora de Processos</a></li>
                            <li><a href="#instrucoes" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="book-open" class="w-5 h-5"></i>Instruções de Trabalho</a></li>
                            <li><a href="#normas" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="file-text" class="w-5 h-5"></i>Normas Técnicas</a></li>
                            <li><a href="#maquinas" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="settings" class="w-5 h-5"></i>Máquinas e ajustes</a></li>
                        </ul>
                    </nav>
                    <!-- Menu Visitante (Público - sem login) -->
                    <nav id="visitor-nav" class="w-full md:w-64 bg-gray-50 border-r border-gray-200 p-4 hidden h-full overflow-auto">
                        <ul class="space-y-2">
                            <li><a href="#chat" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="message-circle" class="w-5 h-5"></i>Converse Conosco (IA)</a></li>
                            <li><a href="#orcamento" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200"><i data-lucide="file-text" class="w-5 h-5"></i>Solicitar Orçamento</a></li>
                            <li>
                                <button onclick="document.getElementById('login-view').scrollIntoView({behavior: 'smooth'}); document.getElementById('username').focus();" class="nav-item flex items-center gap-3 px-3 py-2 rounded-md font-medium text-gray-700 hover:bg-gray-200 w-full text-left">
                                    <i data-lucide="log-in" class="w-5 h-5"></i>Fazer Login
                                </button>
                            </li>
                        </ul>
                    </nav>

                    <div id="main-content-area" class="flex-1 p-4 md:p-6 h-full overflow-auto">
                        
                        <!-- PÁGINA DO CLIENTE: DASHBOARD (REESTRUTURADO) -->
                        <div id="page-dashboard-cliente" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Painel de Pedidos</h2>
                            <div id="client-dashboard-content">
                                <!-- CARDS DE RESUMO POR ETAPA DO PROCESSO -->
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                    <!-- Card 1: Pedidos em Análise / Pendente -->
                                    <div class="status-card bg-white p-6 rounded-lg border shadow-sm flex items-center justify-between" data-status-group="pendente">
                                        <div>
                                            <h3 class="text-gray-500 text-sm font-semibold">Análise / Pendente</h3>
                                            <p id="client-pending-count" class="text-3xl font-bold text-yellow-600 mt-1">0</p>
                                        </div>
                                        <i data-lucide="alert-triangle" class="w-8 h-8 text-yellow-400"></i>
                                    </div>
                                    <!-- Card 2: Em Produção -->
                                    <div class="status-card bg-white p-6 rounded-lg border shadow-sm flex items-center justify-between" data-status-group="producao">
                                        <div>
                                            <h3 class="text-gray-500 text-sm font-semibold">Em Produção</h3>
                                            <p id="client-prod-count" class="text-3xl font-bold normatic-red-text mt-1">0</p>
                                        </div>
                                        <i data-lucide="flame" class="w-8 h-8 text-red-400"></i>
                                    </div>
                                    <!-- Card 3: Controle de Qualidade -->
                                    <div class="status-card bg-white p-6 rounded-lg border shadow-sm flex items-center justify-between" data-status-group="qualidade">
                                        <div>
                                            <h3 class="text-gray-500 text-sm font-semibold">Controle de Qualidade</h3>
                                            <p id="client-quality-count" class="text-3xl font-bold text-blue-600 mt-1">0</p>
                                        </div>
                                        <i data-lucide="award" class="w-8 h-8 text-blue-400"></i>
                                    </div>
                                    <!-- Card 4: Concluídos -->
                                    <div class="status-card bg-white p-6 rounded-lg border shadow-sm flex items-center justify-between" data-status-group="finalizado">
                                        <div>
                                            <h3 class="text-gray-500 text-sm font-semibold">Finalizado / Coletado</h3>
                                            <p id="client-completed-count" class="text-3xl font-bold text-green-600 mt-1">0</p>
                                        </div>
                                        <i data-lucide="package-check" class="w-8 h-8 text-green-400"></i>
                                    </div>
                                </div>

                                <!-- TABELA DE DETALHES DINÂMICA -->
                                <div class="bg-white p-6 rounded-lg shadow-sm border mt-8 min-func-box">
                                    <h3 id="details-table-title" class="font-semibold mb-4 normatic-blue-text">Pedidos por Status (Clique em um card acima)</h3>
                                    <div id="details-table-container" class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nº Pedido</th>
                                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tratamento</th>
                                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Material</th>
                                                    <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status Atual</th>
                                                    <th class="px-3 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody id="client-orders-table-body" class="bg-white divide-y divide-gray-200">
                                                <tr><td colspan="5" class="text-center py-4 text-gray-500">Clique em um dos cards acima para listar os pedidos neste status.</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- PÁGINAS DO GESTOR -->
                        <div id="page-dashboard" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard Geral</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Índice de Qualidade</h3><p class="text-3xl font-bold text-green-600 mt-1">99.8%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Entregas no Prazo</h3><p class="text-3xl font-bold text-green-600 mt-1">98.2%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Faturação (Mês)</h3><p class="text-3xl font-bold normatic-blue-text mt-1">R$ 1.2M</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Turnover (RH)</h3><p class="text-3xl font-bold normatic-red-text mt-1">1.5%</p></div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                                <div class="lg:col-span-3 bg-white p-6 rounded-lg shadow-sm border"><h3 class="font-semibold mb-4 normatic-blue-text">Pedidos por Mês (Últimos 6)</h3><canvas id="ordersChart" class="chart-short"></canvas></div>
                                <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-sm border"><h3 class="font-semibold mb-4 normatic-blue-text">Tipos de Tratamento</h3><canvas id="treatmentsChart" class="chart-short"></canvas></div>
                            </div>
                        </div>
                        <div id="page-qualidade" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard de Qualidade</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Índice de Conformidade</h3><p class="text-3xl font-bold text-green-600 mt-1">99.8%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Peças Rejeitadas (PPM)</h3><p class="text-3xl font-bold normatic-red-text mt-1">1,250</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Custo da Não-Qualidade</h3><p class="text-3xl font-bold normatic-blue-text mt-1">R$ 15.2k</p></div>
                            </div>
                             <div class="bg-white p-6 rounded-lg shadow-sm border min-func-box"><h3 class="font-semibold mb-4 normatic-blue-text">Evolução do Índice de Conformidade</h3><canvas id="qualidadeChart" class="chart-short"></canvas></div>
                        </div>
                        <div id="page-expedicao" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard de Expedição</h2>
                             <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">On-Time Delivery (OTD)</h3><p class="text-3xl font-bold text-green-600 mt-1">98.2%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Custo de Frete Médio</h3><p class="text-3xl font-bold normatic-blue-text mt-1">R$ 215,50</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Pedidos em Trânsito</h3><p class="text-3xl font-bold normatic-blue-text mt-1">22</p></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border min-func-box"><h3 class="font-semibold mb-4 normatic-blue-text">Pedidos por Transportadora</h3><canvas id="expedicaoChart" class="chart-short"></canvas></div>
                        </div>
                        <div id="page-tratamentos" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard de Tratamentos</h2>
                             <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Eficiência Operacional (OEE)</h3><p class="text-3xl font-bold text-green-600 mt-1">89%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Tempo de Ciclo Médio</h3><p class="text-3xl font-bold normatic-blue-text mt-1">4.2h</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Utilização de Fornos</h3><p class="text-3xl font-bold normatic-blue-text mt-1">76%</p></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border min-func-box"><h3 class="font-semibold mb-4 normatic-blue-text">Carga por Tipo de Forno</h3><canvas id="tratamentosChart" class="chart-short"></canvas></div>
                        </div>
                        <div id="page-financeiro" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard Financeiro</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Faturação (Mês)</h3><p class="text-3xl font-bold text-green-600 mt-1">R$ 1.2M</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Margem de Lucro</h3><p class="text-3xl font-bold text-green-600 mt-1">18.5%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Contas a Receber (Prazo)</h3><p class="text-3xl font-bold normatic-blue-text mt-1">42 dias</p></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border min-func-box"><h3 class="font-semibold mb-4 normatic-blue-text">Faturação vs. Custos</h3><canvas id="financeiroChart" class="chart-short"></canvas></div>
                        </div>
                        <div id="page-rh" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Dashboard de RH</h2>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Turnover (Rotatividade)</h3><p class="text-3xl font-bold normatic-red-text mt-1">1.5%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Absentismo</h3><p class="text-3xl font-bold normatic-red-text mt-1">0.8%</p></div>
                                <div class="bg-gray-50 p-6 rounded-lg border"><h3 class="text-gray-500 text-sm font-semibold">Horas de Treinamento</h3><p class="text-3xl font-bold text-green-600 mt-1">240h</p></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-sm border min-func-box"><h3 class="font-semibold mb-4 normatic-blue-text">Contratações vs. Desligamentos</h3><canvas id="rhChart" class="chart-short"></canvas></div>
                        </div>

                        <!-- PÁGINA DO ADMINISTRADOR: GERENCIAR PEDIDOS -->
                        <div id="page-gerenciar-pedidos" class="page-content">
                            <div class="bg-white rounded-lg shadow-sm border min-func-box flex flex-col">
                                <div class="mb-6">
                                    <h2 class="text-2xl font-bold normatic-blue-text mb-2">Gerenciar Pedidos de Todos os Clientes</h2>
                                    <p class="text-gray-600">Visualize e altere o status de todos os pedidos do sistema</p>
                                </div>

                                <!-- Filtros -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Filtrar por Cliente</label>
                                        <select id="admin-filter-cliente" class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500">
                                            <option value="todos">Todos os Clientes</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Filtrar por Status</label>
                                        <select id="admin-filter-status" class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500">
                                            <option value="todos">Todos os Status</option>
                                            <option value="Aguardando Matéria-prima">Aguardando Matéria-prima</option>
                                            <option value="Aguardando Material">Aguardando Material</option>
                                            <option value="Em Análise">Em Análise</option>
                                            <option value="Pendente">Pendente</option>
                                            <option value="Em Produção">Em Produção</option>
                                            <option value="Controle de Qualidade">Controle de Qualidade</option>
                                            <option value="Finalizado">Finalizado</option>
                                            <option value="Concluído">Concluído</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-semibold text-gray-700 mb-2">Buscar Pedido</label>
                                        <input type="text" id="admin-search-pedido" placeholder="Nº do Pedido" class="w-full px-4 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-blue-500">
                                    </div>
                                </div>

                                <!-- Estatísticas Rápidas -->
                                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-gray-600 font-semibold">Total</p>
                                        <p id="admin-total-pedidos" class="text-2xl font-bold text-blue-600">0</p>
                                    </div>
                                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-gray-600 font-semibold">Pendentes</p>
                                        <p id="admin-total-pendentes" class="text-2xl font-bold text-yellow-600">0</p>
                                    </div>
                                    <div class="bg-red-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-gray-600 font-semibold">Em Produção</p>
                                        <p id="admin-total-producao" class="text-2xl font-bold text-red-600">0</p>
                                    </div>
                                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-gray-600 font-semibold">Qualidade</p>
                                        <p id="admin-total-qualidade" class="text-2xl font-bold text-purple-600">0</p>
                                    </div>
                                    <div class="bg-green-50 p-4 rounded-lg text-center">
                                        <p class="text-sm text-gray-600 font-semibold">Finalizados</p>
                                        <p id="admin-total-finalizados" class="text-2xl font-bold text-green-600">0</p>
                                    </div>
                                </div>

                                <!-- Tabela de Pedidos -->
                                <div class="flex-1 overflow-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-100 sticky top-0">
                                            <tr>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Nº Pedido</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Cliente</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Material</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Tratamento</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Qtd</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Prazo</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Status Atual</th>
                                                <th class="px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase">Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="admin-pedidos-tbody" class="divide-y divide-gray-200">
                                            <tr><td colspan="8" class="text-center py-8 text-gray-500">Carregando pedidos...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- PÁGINA DO ADMINISTRADOR (NOVO) -->
                        <div id="page-uploads" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Upload de Documentos</h2>
                            <p class="text-gray-500 mb-6">Envie documentos para disponibilizar aos clientes.</p>
                            <form id="upload-form" class="space-y-4 max-w-lg bg-white p-6 rounded-lg shadow-sm border">
                                <div>
                                    <label for="upload-client-id" class="block text-sm font-medium text-gray-700">ID do Cliente (Nome Completo da Empresa) <span class="text-red-500">*</span></label>
                                    <input type="text" id="upload-client-id" placeholder="Ex: Indústria Beta" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500" required>
                                </div>
                                <div>
                                    <label for="upload-order-id" class="block text-sm font-medium text-gray-700">Nº do Pedido (Opcional)</label>
                                    <input type="text" id="upload-order-id" placeholder="Ex: 004" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500">
                                </div>
                                <div>
                                    <label for="upload-doc-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tipo de Documento <span class="text-red-500">*</span></label>
                                    <select id="upload-doc-type" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                        <option value="Certificado">Certificado</option>
                                        <option value="Ordem de Serviço">Ordem de Serviço</option>
                                        <option value="Pedido">Pedido</option>
                                        <option value="Laudo">Laudo</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="upload-file" class="block text-sm font-medium text-gray-700">Arquivo <span class="text-red-500">*</span></label>
                                    <input type="file" id="upload-file" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100" required>
                                </div>
                                <div class="text-right">
                                    <button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">
                                        <i data-lucide="upload" class="w-4 h-4 inline-block -mt-1 mr-1"></i>
                                        Enviar
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- PÁGINA CADASTRO DE CLIENTES -->
                        <div id="page-cadastro-clientes" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Cadastro de Clientes</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-6">Cadastre novos clientes no sistema.</p>
                            <form id="cadastro-cliente-form" class="space-y-4 max-w-2xl bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="cliente-nome" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nome da Empresa <span class="text-red-500">*</span></label>
                                        <input type="text" id="cliente-nome" placeholder="Ex: Indústria Beta Ltda" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                    </div>
                                    <div>
                                        <label for="cliente-cnpj" class="block text-sm font-medium text-gray-700 dark:text-gray-300">CNPJ <span class="text-red-500">*</span></label>
                                        <input type="text" id="cliente-cnpj" placeholder="00.000.000/0000-00" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="cliente-email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">E-mail <span class="text-red-500">*</span></label>
                                    <input type="email" id="cliente-email" placeholder="contato@empresa.com.br" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                </div>
                                <div>
                                    <label for="cliente-telefone" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Telefone <span class="text-red-500">*</span></label>
                                    <input type="tel" id="cliente-telefone" placeholder="(00) 0000-0000" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                </div>
                                <div>
                                    <label for="cliente-endereco" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Endereço <span class="text-red-500">*</span></label>
                                    <input type="text" id="cliente-endereco" placeholder="Rua, Número, Bairro, Cidade - UF" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                </div>
                                <div>
                                    <label for="cliente-contato" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nome do Contato Principal <span class="text-red-500">*</span></label>
                                    <input type="text" id="cliente-contato" placeholder="Ex: João Silva" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                </div>
                                <div>
                                    <label for="cliente-senha" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Senha de Acesso <span class="text-red-500">*</span></label>
                                    <input type="password" id="cliente-senha" placeholder="Senha para o cliente acessar o portal" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100" required>
                                </div>
                                <div class="text-right">
                                    <button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">
                                        <i data-lucide="user-plus" class="w-4 h-4 inline-block -mt-1 mr-1"></i>
                                        Cadastrar Cliente
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- PÁGINA LISTA DE CLIENTES -->
                        <div id="page-lista-clientes" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Clientes Cadastrados</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-4">Visualize e gerencie os clientes cadastrados no sistema.</p>
                            
                            <!-- Campo de Busca -->
                            <div class="mb-6">
                                <div class="relative max-w-md">
                                    <input type="text" id="search-clientes" placeholder="Buscar por nome, CNPJ ou e-mail..." class="w-full px-4 py-2.5 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500">
                                    <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div id="clientes-list" class="space-y-4">
                                <!-- Cliente 1 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-blue-600 dark:text-blue-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Indústria Beta Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 12.345.678/0001-90</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">contato@industriabeta.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3333-4444</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua Industrial, 1500, Centro, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">João Silva</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">15/03/2024</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 2 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-purple-600 dark:text-purple-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Metalúrgica Gamma S.A.</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 98.765.432/0001-11</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">vendas@metalurgicagamma.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3555-6666</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Av. das Indústrias, 2800, Distrito Industrial, São José dos Pinhais - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Maria Santos</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">22/05/2024</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 3 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-orange-600 dark:text-orange-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Autopeças Delta Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 55.666.777/0001-88</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">compras@autopecasdelta.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3777-8888</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua dos Mecânicos, 450, Parque Tecnológico, Pinhais - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Carlos Oliveira</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">08/09/2024</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 4 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-green-600 dark:text-green-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Ferramentaria Epsilon Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 11.222.333/0001-44</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">orcamento@ferramentariaepsilon.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3888-9999</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua das Ferramentas, 320, Boqueirão, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Ana Paula Costa</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">12/10/2024</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 5 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-red-600 dark:text-red-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Caldeiraria Zeta S.A.</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 22.333.444/0001-55</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">producao@caldeirariazeta.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3222-1111</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Av. Paraná, 1890, Portão, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Roberto Mendes</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">20/11/2024</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 6 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-indigo-600 dark:text-indigo-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Mecânica Eta Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 33.444.555/0001-66</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">contato@mecanicaeta.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3444-2222</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua Sete de Setembro, 2200, Centro, Araucária - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Fernanda Lima</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">05/01/2025</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 7 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-yellow-600 dark:text-yellow-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Usinagem Theta Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 44.555.666/0001-77</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">vendas@usinagemtheta.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3666-3333</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua das Máquinas, 950, CIC, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Paulo Souza</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">18/02/2025</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 8 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-pink-100 dark:bg-pink-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-pink-600 dark:text-pink-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Siderúrgica Iota S.A.</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 66.777.888/0001-99</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">comercial@siderurgicaiota.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3888-4444</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Av. Comendador Franco, 3500, Jardim Botânico, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Juliana Rocha</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">25/03/2025</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 9 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-teal-600 dark:text-teal-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Fundição Kappa Ltda</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 77.888.999/0001-00</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">atendimento@fundicaokappa.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3999-5555</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Rua da Fundição, 1750, Santa Felicidade, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Ricardo Pereira</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">10/04/2025</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Cliente 10 -->
                                <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                                    <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                        <div class="flex items-center gap-4">
                                            <div class="w-12 h-12 bg-cyan-100 dark:bg-cyan-900 rounded-full flex items-center justify-center">
                                                <i data-lucide="building-2" class="w-6 h-6 text-cyan-600 dark:text-cyan-300"></i>
                                            </div>
                                            <div class="text-left">
                                                <h3 class="font-semibold text-gray-900 dark:text-gray-100">Tratamentos Lambda S.A.</h3>
                                                <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: 88.999.000/0001-11</p>
                                            </div>
                                        </div>
                                        <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                                    </button>
                                    <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                                <p class="text-gray-900 dark:text-gray-100">suporte@tratamentoslambda.com.br</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                                <p class="text-gray-900 dark:text-gray-100">(41) 3111-6666</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Av. das Nações Unidas, 4200, Batel, Curitiba - PR</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                                <p class="text-gray-900 dark:text-gray-100">Beatriz Almeida</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                                <p class="text-gray-900 dark:text-gray-100">22/05/2025</p>
                                            </div>
                                            <div>
                                                <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PÁGINA EDITAR CLIENTES -->
                        <div id="page-editar-clientes" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Editar Cadastros de Clientes</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-4">Selecione um cliente para editar, inativar ou excluir.</p>
                            
                            <!-- Campo de Busca -->
                            <div class="mb-6">
                                <div class="relative max-w-md">
                                    <input type="text" id="search-editar-clientes" placeholder="Buscar por nome, CNPJ ou e-mail..." class="w-full px-4 py-2.5 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500">
                                    <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div id="editar-clientes-list" class="space-y-4">
                                <!-- Os clientes serão renderizados aqui via JavaScript -->
                            </div>
                        </div>
                        
                        <!-- PÁGINAS DO CLIENTE -->
                        <!-- PÁGINA INSTRUÇÕES DE TRABALHO COLABORADOR -->
                        <!-- PÁGINA NORMAS TÉCNICAS COLABORADOR -->
                        <div id="page-normas" class="page-content hidden">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-4">Normas Técnicas</h2>
                            <div class="mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <button type="button" data-norma="norma-nbr6361" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ABNT NBR 6361 – Tratamentos térmicos de aços</button>
                                <button type="button" data-norma="norma-astmb889" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM B889 – Carburizing of Steels</button>
                                <button type="button" data-norma="norma-saej423" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">SAE J423 – Carburizing and Austempering of Steels</button>
                                <button type="button" data-norma="norma-nbr11718" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ABNT NBR 11718 – Têmpera e revenimento em aços</button>
                                <button type="button" data-norma="norma-astma255" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM A255 – Hardenability of Steel by End-Quench Test</button>
                                <button type="button" data-norma="norma-astme140" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM E140 – Conversion of Hardness Values</button>
                                <button type="button" data-norma="norma-nbriso15787" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ABNT NBR ISO 15787 – Nitretação e nitrocarburação</button>
                                <button type="button" data-norma="norma-din17022" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">DIN 17022-4 – Plasma Nitriding of Steels</button>
                                <button type="button" data-norma="norma-nbr11716" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ABNT NBR 11716 – Recozimento e normalização de aços</button>
                                <button type="button" data-norma="norma-astma991" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM A991 – Annealing of Carbon and Alloy Steels</button>
                                <button type="button" data-norma="norma-astma939" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM A939 – Normalizing of Carbon Steels</button>
                                <button type="button" data-norma="norma-astma275" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM A275 – Stress Relief Heat Treatments of Steels</button>
                                <button type="button" data-norma="norma-astma262" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM A262 – Intergranular Corrosion in Stainless Steels</button>
                                <button type="button" data-norma="norma-astmb918" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ASTM B918 – Heat Treatment of Aluminum Alloys</button>
                                <button type="button" data-norma="norma-nbr6834" class="norma-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">ABNT NBR 6834 – Tratamento térmico de ligas de alumínio</button>
                            </div>
                            <div id="norma-content" class="bg-white p-6 rounded-lg shadow border min-func-box">
                                <div id="norma-nbr6361" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ABNT NBR 6361 – Tratamentos térmicos de aços – Diretrizes gerais</h3>
                                    <p>Define requisitos gerais para execução de tratamentos térmicos em aços, estabelecendo parâmetros básicos de temperatura, resfriamento, controle de atmosfera e inspeção.</p>
                                </div>
                                <div id="norma-astmb889" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM B889 – Carburizing of Steels</h3>
                                    <p>Norma que especifica requisitos para cementação (carburização) de aços, incluindo métodos de controle de profundidade da camada e dureza superficial.</p>
                                </div>
                                <div id="norma-saej423" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">SAE J423 – Carburizing and Austempering of Steels</h3>
                                    <p>Guia técnico para aplicação de cementação e austêmpera em aços, detalhando composições químicas, atmosferas de forno e parâmetros de resfriamento.</p>
                                </div>
                                <div id="norma-nbr11718" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ABNT NBR 11718 – Têmpera e revenimento em aços</h3>
                                    <p>Norma brasileira que estabelece procedimentos para têmpera e revenimento, definindo critérios de resfriamento, dureza e microestrutura esperada.</p>
                                </div>
                                <div id="norma-astma255" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM A255 – Hardenability of Steel by End-Quench Test (Jominy Test)</h3>
                                    <p>Norma que padroniza o ensaio de temperabilidade Jominy, usado para medir a profundidade da têmpera em aços.</p>
                                </div>
                                <div id="norma-astme140" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM E140 – Conversion of Hardness Values (Brinell, Rockwell, Vickers, etc.)</h3>
                                    <p>Tabelas e métodos padronizados para conversão entre diferentes escalas de dureza.</p>
                                </div>
                                <div id="norma-nbriso15787" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ABNT NBR ISO 15787 – Tratamento termoquímico – Nitretação e nitrocarburação</h3>
                                    <p>Norma internacional adotada no Brasil que define processos de nitretação e nitrocarburação (inclusive plasma), incluindo atmosferas, tempos e espessura de camada.</p>
                                </div>
                                <div id="norma-din17022" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">DIN 17022-4 – Plasma Nitriding of Steels</h3>
                                    <p>Norma alemã que estabelece parâmetros técnicos de nitretação a plasma em aços, incluindo controle de tensão elétrica, temperatura e formação de camadas compostas.</p>
                                </div>
                                <div id="norma-nbr11716" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ABNT NBR 11716 – Recozimento e normalização de aços</h3>
                                    <p>Define procedimentos de recozimento (total, esferoidização, isotérmico) e normalização para aços, com foco em redução de dureza e refinamento estrutural.</p>
                                </div>
                                <div id="norma-astma991" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM A991 – Annealing of Carbon and Alloy Steels</h3>
                                    <p>Norma americana que padroniza o recozimento de aços carbono e ligados, incluindo parâmetros de resfriamento e propriedades resultantes.</p>
                                </div>
                                <div id="norma-astma939" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM A939 – Normalizing of Carbon Steels</h3>
                                    <p>Norma para normalização de aços carbono, estabelecendo requisitos de temperatura e resfriamento para uniformização estrutural.</p>
                                </div>
                                <div id="norma-astma275" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM A275 – Stress Relief Heat Treatments of Steels</h3>
                                    <p>Define práticas de alívio de tensões em aços, incluindo tratamentos em atmosfera controlada e a vácuo, com critérios para evitar deformações.</p>
                                </div>
                                <div id="norma-astma262" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM A262 – Practices for Detecting Susceptibility to Intergranular Corrosion in Stainless Steels</h3>
                                    <p>Norma usada para avaliar a eficiência de solubilização em inoxidáveis, garantindo resistência à corrosão intergranular.</p>
                                </div>
                                <div id="norma-astmb918" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ASTM B918 – Heat Treatment of Aluminum Alloys</h3>
                                    <p>Norma que estabelece práticas de solubilização, resfriamento e envelhecimento artificial/natural em ligas de alumínio.</p>
                                </div>
                                <div id="norma-nbr6834" class="norma-details hidden">
                                    <h3 class="text-xl font-bold mb-2">ABNT NBR 6834 – Tratamento térmico de ligas de alumínio</h3>
                                    <p>Norma brasileira para tratamento térmico de ligas de alumínio, similar à ASTM B918, com foco em práticas de solubilização e envelhecimento.</p>
                                </div>
                            </div>
                        </div>
                        <div id="page-instrucoes" class="page-content hidden">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-4">Instruções de Trabalho</h2>
                            <div class="mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <button type="button" data-it="it0001" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0001 – Cementação</button>
                                <button type="button" data-it="it0002" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0002 – Têmpera</button>
                                <button type="button" data-it="it0003" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0003 – Revenimento</button>
                                <button type="button" data-it="it0004" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0004 – Nitretação a plasma</button>
                                <button type="button" data-it="it0005" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0005 – Recozimento total</button>
                                <button type="button" data-it="it0006" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0006 – Normalização</button>
                                <button type="button" data-it="it0007" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0007 – Martêmpera</button>
                                <button type="button" data-it="it0008" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0008 – Austêmpera</button>
                                <button type="button" data-it="it0009" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0009 – Alívio de tensões a vácuo</button>
                                <button type="button" data-it="it0010" class="it-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">IT0010 – Solubilização + Envelhecimento</button>
                            </div>
                            <div id="it-content" class="bg-white p-6 rounded-lg shadow border min-func-box">
                                <div id="it0001" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0001 – Cementação</h3>
                                    <p><strong>Descrição:</strong> Tratamento superficial aplicado em aços de baixo carbono para enriquecer a superfície com carbono.</p>
                                    <p><strong>Parâmetros típicos:</strong> 900–950 °C, atmosfera carburante, tempo 6–8h, seguido de têmpera e revenimento.</p>
                                    <p><strong>Objetivo:</strong> Obter camada superficial com dureza elevada (&gt; 58 HRC) mantendo núcleo tenaz.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR 6361 – Tratamentos térmicos de aços – diretrizes gerais.</li>
                                        <li>ASTM B889 – Carburizing of steels.</li>
                                        <li>SAE J423 – Carburizing steels.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Definem parâmetros de temperatura, tempo e atmosfera para cementação em aços de baixo carbono, garantindo controle de camada e dureza superficial.</p>
                                </div>
                                <div id="it0002" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0002 – Têmpera</h3>
                                    <p><strong>Descrição:</strong> Aquecimento acima da temperatura crítica e resfriamento rápido.</p>
                                    <p><strong>Parâmetros típicos:</strong> 820–870 °C, resfriamento em óleo, água ou polímero.</p>
                                    <p><strong>Objetivo:</strong> Aumentar dureza e resistência ao desgaste (até ~60 HRC dependendo do aço).</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR 11718 – Têmpera e revenimento em aços.</li>
                                        <li>ASTM A255 – Hardenability of steel by End-Quench Test (Jominy).</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Estabelecem métodos de têmpera (óleo, água, polímero), critérios de resfriamento e formas de avaliar a temperabilidade dos aços.</p>
                                </div>
                                <div id="it0003" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0003 – Revenimento</h3>
                                    <p><strong>Descrição:</strong> Aquecimento controlado após têmpera para reduzir fragilidade.</p>
                                    <p><strong>Parâmetros típicos:</strong> 150–650 °C, tempo 1–3h, resfriamento ao air.</p>
                                    <p><strong>Objetivo:</strong> Ajustar dureza e tenacidade conforme aplicação (alívio de tensões internas).</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR 11718 – (também contempla revenimento).</li>
                                        <li>ASTM E140 – Conversão de durezas (Brinell, Rockwell, Vickers).</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Definem condições para reduzir fragilidade após têmpera e tabelas de conversão de dureza após revenimento.</p>
                                </div>
                                <div id="it0004" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0004 – Nitretação a plasma</h3>
                                    <p><strong>Descrição:</strong> Enriquecimento superficial com nitrogênio em plasma ionizado.</p>
                                    <p><strong>Parâmetros típicos:</strong> 480–580 °C, atmosfera de N₂+H₂, tempo 10–20h.</p>
                                    <p><strong>Objetivo:</strong> Alta dureza superficial (700–1200 HV), boa resistência ao desgaste e fadiga.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR ISO 15787 – Tratamento termoquímico – nitretação e nitrocarburação.</li>
                                        <li>DIN 17022-4 – Plasma nitriding of steels.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Normas padronizam parâmetros de plasma (tensão, atmosfera e tempo) e critérios de camadas compostas em aços nitretados.</p>
                                </div>
                                <div id="it0005" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0005 – Recozimento total</h3>
                                    <p><strong>Descrição:</strong> Aquecimento seguido de resfriamento lento dentro do forno.</p>
                                    <p><strong>Parâmetros típicos:</strong> 700–750 °C, tempo 2–6h.</p>
                                    <p><strong>Objetivo:</strong> Amolecer o material (dureza &lt; 200 HB), melhorar usinabilidade e homogeneizar estrutura.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR 11716 – Recozimento de aços.</li>
                                        <li>ASTM A991 – Annealing of Carbon and Alloy Steels.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Especificam procedimentos de recozimento total, esferoidização e isotérmico para reduzir dureza e melhorar usinabilidade.</p>
                                </div>
                                <div id="it0006" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0006 – Normalização</h3>
                                    <p><strong>Descrição:</strong> Aquecimento acima da zona crítica e resfriamento em air calmo.</p>
                                    <p><strong>Parâmetros típicos:</strong> 850–900 °C.</p>
                                    <p><strong>Objetivo:</strong> Refinar grão, uniformizar estrutura, preparar para posterior têmpera.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR 11716 – Inclui normalização.</li>
                                        <li>ASTM A 939 – Normalizing of carbon steels.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Estabelecem parâmetros de temperatura e resfriamento em air para uniformização da estrutura do aço.</p>
                                </div>
                                <div id="it0007" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0007 – Martêmpera</h3>
                                    <p><strong>Descrição:</strong> Resfriamento rápido até temperatura intermediária e permanência antes de terminar o resfriamento.</p>
                                    <p><strong>Parâmetros típicos:</strong> Aquecimento a 850 °C, resfriamento em banho de sais a 150–300 °C, seguido de ar.</p>
                                    <p><strong>Objetivo:</strong> Minimizar tensões e distorções em peças temperadas.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ASTM A255 – Ensaios de temperabilidade aplicáveis.</li>
                                        <li>ABNT NBR 11718 – Processos alternativos de têmpera (inclui martêmpera).</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Definem técnicas de resfriamento intermediário (banho de sais), minimizando tensões e distorções em peças de geometria complexa.</p>
                                </div>
                                <div id="it0008" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0008 – Austêmpera</h3>
                                    <p><strong>Descrição:</strong> Resfriamento rápido seguido de permanência em banho de sais até transformação bainítica.</p>
                                    <p><strong>Parâmetros típicos:</strong> Aquecimento a 850–900 °C, resfriamento em sais a 250–400 °C.</p>
                                    <p><strong>Objetivo:</strong> Produzir bainita com boa dureza (~40–55 HRC) e alta resistência à fadiga.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ASTM A255 – (aplicável à caracterização da temperabilidade).</li>
                                        <li>SAE J423 – Procedimentos de austêmpera em ferros fundidos e aços.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Normas estabelecem parâmetros de transformação bainítica, resultando em dureza e resistência melhor equilibradas.</p>
                                </div>
                                <div id="it0009" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0009 – Alívio de tensões a vácuo (Bright Stress Relief)</h3>
                                    <p><strong>Descrição:</strong> Aquecimento em atmosfera controlada para remover tensões.</p>
                                    <p><strong>Parâmetros típicos:</strong> 550–650 °C, tempo 2–4h, resfriamento em vácuo.</p>
                                    <p><strong>Objetivo:</strong> Reduzir tensões internas sem alterar dureza e manter acabamento brilhante.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ABNT NBR ISO 15787 – (aborda alívio de tensões).</li>
                                        <li>ASTM A275 – Stress relief heat treatments of steels.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Normas definem procedimentos para redução de tensões internas sem alteração significativa da dureza, mantendo acabamento superficial.</p>
                                </div>
                                <div id="it0010" class="it-details hidden">
                                    <h3 class="text-xl font-bold mb-2">IT0010 – Solubilização + Envelhecimento (para inox ou alumínio)</h3>
                                    <p><strong>Descrição:</strong> Aquecimento até solubilização seguido de resfriamento rápido e envelhecimento subsequente.</p>
                                    <p><strong>Parâmetros típicos:</strong> 1000–1100 °C solubilização + 500–600 °C envelhecimento.</p>
                                    <p><strong>Objetivo:</strong> Aumentar resistência mecânica em ligas endurecíveis por precipitação.</p>
                                    <p class="mt-4"><strong>Normas relacionadas:</strong></p>
                                    <ul class="list-disc ml-6">
                                        <li>ASTM A262 – Practices for detecting susceptibility to Intergranular Corrosion in Stainless Steels.</li>
                                        <li>ASTM B918 – Heat treatment of aluminum alloys.</li>
                                        <li>ABNT NBR 6834 – Tratamento térmico de ligas de alumínio.</li>
                                    </ul>
                                    <p class="mt-2"><strong>Resumo:</strong> Normas regulam solubilização (dissolução de precipitados), resfriamento rápido e envelhecimento para aumento de resistência mecânica em ligas especiais.</p>
                                </div>
                            </div>
                        </div>
                        <div id="page-consulta" class="page-content">
                             <h2 class="text-2xl font-bold normatic-blue-text mb-2">Consulte o seu Pedido</h2>
                            <p class="text-gray-500 mb-6">Insira o número do pedido para ver o estado atual.</p>
                            <form id="search-form" class="flex flex-col sm:flex-row gap-3">
                                <!-- Sugestão de pedidos para Indústria Beta: 001, 004, 005, 008, 024, 025 -->
                                <input type="text" id="order-id" placeholder="Ex: 004 (para Indústria Beta)" class="w-full px-4 py-3 text-lg border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500" required>
                                <button type="submit" class="w-full sm:w-auto btn-primary font-bold text-lg px-8 py-3 rounded-md flex items-center justify-center">
                                    <span id="button-text">Buscar</span>
                                    <div id="loading-spinner" class="hidden w-6 h-6 border-4 border-white border-t-transparent rounded-full spinner"></div>
                                </button>
                            </form>
                            <div id="result-container" class="hidden mt-6">
                                <div id="success-result" class="hidden">
                                    <h3 class="text-xl font-semibold normatic-blue-text mb-4">Detalhes do Pedido <span id="result-order-id" class="normatic-red-text"></span></h3>
                                    
                                    <!-- Gemini: Resumo Inteligente -->
                                    <div id="gemini-summary-container" class="hidden mb-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-r-lg">
                                        <p class="text-sm font-bold text-blue-800 mb-1 flex items-center gap-2">
                                            <i data-lucide="sparkles" class="w-4 h-4 text-blue-600"></i>
                                            Resumo Inteligente
                                        </p>
                                        <div id="gemini-summary-loader" class="text-center p-2">
                                             <div class="w-5 h-5 border-2 border-blue-400 border-t-transparent rounded-full spinner"></div>
                                        </div>
                                        <div id="gemini-summary-text" class="text-blue-900 hidden prose prose-sm max-w-none"></div>
                                    </div>

                                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Estado</p><p id="status" class="text-lg font-semibold text-green-600"></p></div>
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Prazo de Entrega</p><p id="delivery-date" class="text-lg font-semibold"></p></div>
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Última Atualização</p><p id="last-update" class="text-lg font-semibold"></p></div>
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Material</p><p id="material" class="text-lg font-semibold"></p></div>
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Tratamento</p><p id="treatment" class="text-lg font-semibold"></p></div>
                                        <div class="bg-gray-50 p-4 rounded-md border"><p class="text-sm text-gray-500">Dureza Req.</p><p id="hardness" class="text-lg font-semibold"></p></div>
                                    </div>
                                    
                                    <div id="order-timeline" class="mt-8">
                                        <h4 class="text-lg font-semibold text-gray-700 mb-4">Linha do Tempo do Processo</h4>
                                        <ol class="relative border-l-2 border-gray-200 ml-3">                  
                                            <li class="mb-10 ml-6 timeline-step" data-step="recebido">
                                                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full -left-3.5 ring-8 ring-white timeline-icon">
                                                    <i data-lucide="inbox" class="w-4 h-4 text-gray-600"></i>
                                                </span>
                                                <h3 class="font-semibold text-gray-800">Pedido Recebido/Em Análise</h3>
                                                <p class="text-sm font-normal text-gray-500">O seu pedido foi registado e está em verificação inicial.</p>
                                                <time class="block mt-1 text-xs font-normal leading-none text-gray-400"></time>
                                            </li>
                                            <li class="mb-10 ml-6 timeline-step" data-step="material">
                                                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full -left-3.5 ring-8 ring-white timeline-icon">
                                                    <i data-lucide="boxes" class="w-4 h-4 text-gray-600"></i>
                                                </span>
                                                <h3 class="font-semibold text-gray-800">Aguardando Material/Pendente</h3>
                                                <p class="text-sm font-normal text-gray-500">Estamos a aguardar a chegada das suas peças ou de material necessário.</p>
                                                <time class="block mt-1 text-xs font-normal leading-none text-gray-400"></time>
                                            </li>
                                            <li class="mb-10 ml-6 timeline-step" data-step="producao">
                                                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full -left-3.5 ring-8 ring-white timeline-icon">
                                                    <i data-lucide="flame" class="w-4 h-4 text-gray-600"></i>
                                                </span>
                                                <h3 class="font-semibold text-gray-800">Em Produção</h3>
                                                <p class="text-sm font-normal text-gray-500">As suas peças estão a passar pelo tratamento térmico.</p>
                                                <time class="block mt-1 text-xs font-normal leading-none text-gray-400"></time>
                                            </li>
                                            <li class="mb-10 ml-6 timeline-step" data-step="qualidade">
                                                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full -left-3.5 ring-8 ring-white timeline-icon">
                                                    <i data-lucide="award" class="w-4 h-4 text-gray-600"></i>
                                                </span>
                                                <h3 class="font-semibold text-gray-800">Controle de Qualidade</h3>
                                                <p class="text-sm font-normal text-gray-500">A verificar as especificações e a qualidade do tratamento.</p>
                                                <time class="block mt-1 text-xs font-normal leading-none text-gray-400"></time>
                                            </li>
                                            <li class="ml-6 timeline-step" data-step="finalizado">
                                                <span class="absolute flex items-center justify-center w-6 h-6 bg-gray-200 rounded-full -left-3.5 ring-8 ring-white timeline-icon">
                                                    <i data-lucide="package-check" class="w-4 h-4 text-gray-600"></i>
                                                </span>
                                                <h3 class="font-semibold text-gray-800">Finalizado/Concluído</h3>
                                                <p class="text-sm font-normal text-gray-500">O seu pedido está pronto para expedição ou agendamento de entrega.</p>
                                                <time class="block mt-1 text-xs font-normal leading-none text-gray-400"></time>
                                            </li>
                                        </ol>
                                    </div>

                                    <!-- Gemini: O que acontece a seguir -->
                                    <div class="mt-8 text-center">
                                        <button id="next-steps-button" class="bg-gray-200 text-gray-800 font-semibold px-4 py-2 rounded-md hover:bg-gray-300 transition-colors">
                                           ✨ O que acontece a seguir?
                                        </button>
                                    </div>
                                    <div id="gemini-next-steps-container" class="hidden mt-4 p-4 bg-gray-50 border rounded-lg">
                                        <div id="gemini-next-steps-loader" class="text-center text-sm text-gray-500 flex items-center justify-center gap-2">
                                            <div class="w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full spinner"></div>
                                            A gerar explicação...
                                        </div>
                                        <div id="gemini-next-steps-text" class="text-gray-700 hidden prose prose-sm max-w-none"></div>
                                    </div>

                                </div>
                                <div id="error-message" class="hidden text-center"><p class="text-lg font-medium text-red-600"></p></div>
                            </div>
                        </div>

                        <!-- PÁGINA RASTREAMENTO EM TEMPO REAL -->
                        <div id="page-rastreamento" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Acompanhar Entrega em Tempo Real</h2>
                            <p class="text-gray-500 dark:text-gray-400 mb-6">Veja a localização em tempo real do veículo de entrega.</p>
                            
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Pedido:</p>
                                        <p class="text-lg font-semibold text-gray-900 dark:text-gray-100">#004</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                        <p class="text-lg font-semibold text-green-600 dark:text-green-400">Em Trânsito</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 font-medium">Previsão de Chegada:</p>
                                        <p class="text-lg font-semibold text-gray-900 dark:text-gray-100">Hoje, 16:30</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Mapa -->
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
                                <div id="map-container" class="relative w-full h-96 md:h-[500px] bg-gray-100 dark:bg-gray-900">
                                    <div id="leaflet-map" class="w-full h-full"></div>
                                </div>
                                
                                <div class="p-4 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                    <p class="text-sm text-gray-600 dark:text-gray-400 flex items-center gap-2">
                                        <i data-lucide="map-pin" class="w-4 h-4 text-red-600"></i>
                                        <span id="truck-location">Localização atual: Av. Rui Barbosa, 5520 - São José dos Pinhais, PR</span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div id="page-orcamento" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Solicitar Orçamento</h2>
                            <p class="text-gray-500 mb-6">Preencha os detalhes abaixo para receber uma cotação.</p>
                            <form id="quote-form" class="space-y-4 max-w-lg">
                                <div>
                                    <label for="metal-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tipo de Metal</label>
                                    <select id="metal-type" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                        <option value="construcao_mecanica">Aços de construção mecânica</option>
                                        <option value="ferramenta_especiais">Aços ferramenta, aços rápidos e aços especiais</option>
                                        <option value="ferros_fundidos">Ferros-fundidos</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="treatment-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Tratamentos Necessários</label>
                                    <select id="treatment-type" class="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></select>
                                </div>
                                <div><label for="quantity" class="block text-sm font-medium text-gray-700">Quantidade de Peças</label><input type="number" id="quantity" placeholder="Ex: 50" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"></div>
                                <div class="text-right"><button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">Enviar Solicitação</button></div>
                            </form>
                        </div>
                        <div id="page-historico" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-6">Histórico de Pedidos</h2>
                            <div id="history-list" class="space-y-4"></div>
                        </div>
                        <div id="page-downloads" class="page-content">
                            <!-- Conteúdo será gerado dinamicamente via JS -->
                        </div>
                        <div id="page-dados" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Meus Dados</h2>
                            <p class="text-gray-500 mb-6">Mantenha as suas informações cadastrais atualizadas.</p>
                            <form id="user-data-form" class="space-y-4 max-w-lg">
                                <div><label for="user-name" class="block text-sm font-medium text-gray-700">Nome / Razão Social <span class="text-red-500">*</span></label><input type="text" id="user-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                <div><label for="user-address" class="block text-sm font-medium text-gray-700">Endereço <span class="text-red-500">*</span></label><textarea id="user-address" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></textarea></div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div><label for="user-phone" class="block text-sm font-medium text-gray-700">Telefone <span class="text-red-500">*</span></label><input type="tel" id="user-phone" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                    <div><label for="user-email" class="block text-sm font-medium text-gray-700">E-mail <span class="text-red-500">*</span></label><input type="email" id="user-email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                </div>
                                <hr class="my-4">
                                <div><label for="user-default-delivery" class="block text-sm font-medium text-gray-700">Endereço Padrão de Entrega (Opcional)</label><textarea id="user-default-delivery" rows="3" placeholder="Deixe em branco para usar o endereço principal" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"></textarea></div>
                                <div><label for="user-default-pickup" class="block text-sm font-medium text-gray-700">Endereço Padrão de Coleta (Opcional)</label><textarea id="user-default-pickup" rows="3" placeholder="Deixe em branco para usar o endereço principal" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"></textarea></div>
                                <div class="text-right"><button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">Salvar Alterações</button></div>
                            </form>
                        </div>
                        <div id="page-coleta" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Agendar Coleta</h2>
                            <p class="text-gray-500 mb-6">Preencha os dados para agendarmos a coleta das suas peças.</p>
                            <form id="pickup-form" class="space-y-4 max-w-lg">
                                <div><label for="pickup-order" class="block text-sm font-medium text-gray-700">Nº do Pedido (Opcional)</label><input type="text" id="pickup-order" placeholder="Ex: 12345" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"></div>
                                <div><label for="pickup-address" class="block text-sm font-medium text-gray-700">Endereço de Coleta</label><textarea id="pickup-address" rows="3" placeholder="Rua, Número, Bairro, Cidade" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></textarea></div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div><label for="pickup-date" class="block text-sm font-medium text-gray-700">Data Preferencial</label><input type="date" id="pickup-date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                    <div><label for="pickup-time" class="block text-sm font-medium text-gray-700">Horário Preferencial</label><input type="time" id="pickup-time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                </div>
                                <div class="text-right"><button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">Agendar Coleta</button></div>
                            </form>
                        </div>
                        <div id="page-entrega" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-2">Agendar Entrega</h2>
                            <p class="text-gray-500 mb-6">Informe o endereço e a data para a entrega das peças prontas.</p>
                             <form id="delivery-form" class="space-y-4 max-w-lg">
                                <div><label for="delivery-order" class="block text-sm font-medium text-gray-700">Nº do Pedido</label><input type="text" id="delivery-order" placeholder="Ex: 67890" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                <div><label for="delivery-address" class="block text-sm font-medium text-gray-700">Endereço de Entrega</label><textarea id="delivery-address" rows="3" placeholder="Rua, Número, Bairro, Cidade" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></textarea></div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div><label for="delivery-date-input" class="block text-sm font-medium text-gray-700">Data Preferencial</label><input type="date" id="delivery-date-input" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                    <div><label for="delivery-time" class="block text-sm font-medium text-gray-700">Horário Preferencial</label><input type="time" id="delivery-time" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500" required></div>
                                </div>
                                <div class="text-right"><button type="submit" class="btn-primary font-bold py-2 px-6 rounded-md">Agendar Entrega</button></div>
                            </form>
                        </div>
                        <div id="page-chat" class="page-content">
                            <!-- Chat Container Adaptado de fale_conosco.html -->
                            <div class="w-full max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col" style="height: 80vh; max-height: 700px;">
                                
                                <!-- Cabeçalho -->
                                <header class="bg-gray-800 p-4 text-white flex items-center justify-between rounded-t-xl">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <h1 class="text-xl font-bold">Assistente Normatic</h1>
                                            <p class="text-sm text-gray-400">Especialista em Tratamentos Térmicos</p>
                                        </div>
                                    </div>
                                </header>

                                <!-- Janela de Mensagens -->
                                <main id="chat-window" class="flex-grow p-4 space-y-4 overflow-y-auto bg-gray-50">
                                    <!-- Mensagem de boas-vindas do AI -->
                                    <div class="flex justify-start">
                                        <div class="max-w-xs md:max-w-md p-3 chat-bubble-ai">
                                            Olá! Eu sou o assistente virtual da Normatic. Posso te ajudar com informações sobre nossos serviços de tratamento térmico (têmpera, recozimento, etc.) e a empresa. Como posso auxiliar hoje?
                                        </div>
                                    </div>
                                    <!-- Indicador de digitação (inicialmente oculto) -->
                                    <div id="typing-indicator" class="flex justify-start hidden">
                                        <div class="p-3 chat-bubble-ai flex items-center space-x-2">
                                            <span class="dot-flashing"></span>
                                            <span class="text-sm italic">Digitando...</span>
                                        </div>
                                    </div>
                                </main>

                                <!-- Área de Input -->
                                <footer class="p-4 border-t border-gray-200 bg-white">
                                    <div class="flex space-x-3">
                                        <input
                                            type="text"
                                            id="user-input"
                                            placeholder="Pergunte sobre a Normatic ou tratamentos térmicos..."
                                            class="flex-grow p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-150"
                                            onkeypress="if(event.key === 'Enter') sendMessage()"
                                        >
                                        <button
                                            id="send-button"
                                            onclick="sendMessage()"
                                            class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-lg transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                            </svg>
                                        </button>
                                    </div>
                                </footer>
                            </div>
                        </div>

                        <!-- PÁGINAS DO COLABORADOR -->
                        <div id="page-consultor-ia" class="page-content">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-4">Consultor Técnico (IA)</h2>
                            
                            <!-- Chat Container Estilo fale_conosco.html -->
                            <div class="w-full max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col" style="height: 80vh; max-height: 700px;">
                                
                                <!-- Cabeçalho -->
                                <header class="bg-gray-800 p-4 text-white flex items-center justify-between rounded-t-xl">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-red-600 rounded-full flex items-center justify-center mr-3">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <h1 class="text-xl font-bold">Consultor Técnico IA</h1>
                                            <p class="text-sm text-gray-400">Especialista em Tratamentos Térmicos e Processos</p>
                                        </div>
                                    </div>
                                </header>

                                <!-- Janela de Mensagens -->
                                <main id="consultant-chat-window" class="flex-grow p-4 space-y-4 overflow-y-auto bg-gray-50">
                                    <!-- Mensagem de boas-vindas do AI -->
                                    <div class="flex justify-start">
                                        <div class="max-w-xs md:max-w-md p-3 chat-bubble-ai">
                                            👋 Olá! Sou o consultor técnico especializado da Normatic. Posso ajudar com parâmetros de tratamento térmico, normas técnicas, instruções de trabalho e processos. Como posso ajudar?
                                        </div>
                                    </div>
                                    <!-- Indicador de digitação (inicialmente oculto) -->
                                    <div id="consultant-typing-indicator" class="flex justify-start hidden">
                                        <div class="p-3 chat-bubble-ai flex items-center space-x-2">
                                            <span class="dot-flashing"></span>
                                            <span class="text-sm italic">Analisando...</span>
                                        </div>
                                    </div>
                                </main>

                                <!-- Área de Input -->
                                <footer class="p-4 border-t border-gray-200 bg-white">
                                    <div class="flex space-x-3">
                                        <input
                                            type="text"
                                            id="consultant-input"
                                            placeholder="Ex: Temperatura para têmpera de SAE 4140?"
                                            class="flex-grow p-3 border border-gray-300 rounded-full focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none transition duration-150"
                                            onkeypress="if(event.key === 'Enter') sendConsultantMessage()"
                                        >
                                        <button
                                            id="consultant-send-button"
                                            onclick="sendConsultantMessage()"
                                            class="bg-red-600 hover:bg-red-700 text-white p-3 rounded-full shadow-lg transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                            </svg>
                                        </button>
                                    </div>
                                </footer>
                            </div>
                        </div>
                        
                        <!-- NOVA PÁGINA DA CALCULADORA -->
                        <div id="page-calculadora" class="page-content">
                             <div class="bg-white rounded-lg min-func-box p-0 md:p-4 flex flex-col">
                                <header class="text-center mb-8">
                                    <h1 class="text-3xl md:text-4xl font-bold normatic-blue-text">Calculadora de Processos</h1>
                                    <p class="text-gray-600 mt-2">Selecione o aço, veja os parâmetros do processo e os resultados de dureza.</p>
                                </header>

                                <!-- Controles de Seleção -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 items-end">
                                    <div>
                                        <label for="calc-steel-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">1. Selecione o Tipo de Aço</label>
                                        <select id="calc-steel-select" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 text-sm rounded-lg focus:ring-red-500 focus:border-red-500 block p-2.5 transition duration-150 ease-in-out">
                                            <option selected disabled>Escolha um aço...</option>
                                        </select>
                                    </div>
                                    <div id="calc-process-info-container" class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm hidden">
                                         <!-- Info do Processo será inserida aqui -->
                                    </div>
                                </div>

                                <!-- Seção de Resultados -->
                                <div id="calc-results-section" class="hidden">
                                    <div class="mb-6">
                                        <label for="calc-initial-hardness" class="block text-sm font-medium text-gray-700 mb-2">Dureza Máxima Pós-Têmpera</label>
                                        <input type="text" id="calc-initial-hardness" class="w-full md:w-1/3 bg-gray-200 border border-gray-300 text-gray-900 font-bold text-center text-lg rounded-lg block p-2.5 cursor-not-allowed" readonly>
                                    </div>

                                    <h2 class="text-2xl font-bold normatic-blue-text mb-4 border-b pb-2">Resultado de Revenimento</h2>
                                    <p class="text-sm text-gray-500 mb-4">Clique em um card para ver a conversão de dureza e a resistência à tração.</p>
                                    <div id="calc-results-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                        <!-- Cards de resultado serão inseridos aqui -->
                                    </div>
                                     <p id="calc-no-results-message" class="text-center text-gray-500 mt-6 hidden">Nenhum dado de revenimento encontrado para este aço.</p>
                                </div>
                                 <div id="calc-welcome-message" class="text-center py-12">
                                    <i data-lucide="ruler" class="mx-auto h-12 w-12 text-gray-400"></i>
                                    <h3 class="mt-2 text-sm font-medium text-gray-900">Aguardando seleção</h3>
                                    <p class="mt-1 text-sm text-gray-500">Selecione um tipo de aço para começar os cálculos.</p>
                                </div>
                            </div>
                        </div>

                        <div id="page-maquinas" class="page-content hidden">
                            <h2 class="text-2xl font-bold normatic-blue-text mb-4">Máquinas e Ajustes</h2>
                            <div class="mb-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <button type="button" data-maquina="maquina-forno-camara" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Forno de Câmara (Convencional)</button>
                                <button type="button" data-maquina="maquina-forno-inducao" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Forno de Indução</button>
                                <button type="button" data-maquina="maquina-forno-vacuo" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Forno a Vácuo</button>
                                <button type="button" data-maquina="maquina-forno-atmosfera" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Forno de Atmosfera Controlada</button>
                                <button type="button" data-maquina="maquina-forno-sais" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Forno de Sais (Banho de Sais)</button>
                                <button type="button" data-maquina="maquina-tanques-resfriamento" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Tanques de Resfriamento (Têmpera)</button>
                                <button type="button" data-maquina="maquina-nitreta-plasma" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Equipamento de Nitretação a Plasma</button>
                                <button type="button" data-maquina="maquina-oxidacao-negra" class="maquina-btn w-full bg-blue-100 hover:bg-blue-200 text-blue-900 font-semibold py-3 px-4 rounded-lg shadow transition">Equipamento de Oxidação Negra</button>
                            </div>
                            <div id="maquina-content" class="bg-white p-6 rounded-lg shadow border min-func-box">
                                <div id="maquina-forno-camara" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Forno de Câmara (Convencional)</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Equipamento tradicional para tratamentos térmicos, com controle de temperatura e atmosfera para processos como têmpera, revenimento e recozimento. Ideal para produção em lotes médios e grandes.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Verificar limpeza da câmara antes de carregar peças</li>
                                            <li>Posicionar peças com espaçamento adequado para circulação uniforme de calor</li>
                                            <li>Fechar porta e verificar vedação</li>
                                            <li>Programar temperatura e tempo conforme IT específica</li>
                                            <li>Aguardar estabilização de temperatura (patamar de encharque)</li>
                                            <li>Após ciclo, desligar e aguardar resfriamento controlado antes de abrir</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Nunca abrir o forno com temperatura acima de 200°C</li>
                                            <li>Usar EPI completo: luvas térmicas, óculos de proteção, avental</li>
                                            <li>Verificar funcionamento do sistema de exaustão antes de iniciar</li>
                                            <li>Não sobrecarregar a câmara (máx. 80% da capacidade)</li>
                                            <li>Manter área ao redor desobstruída</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Limpeza da câmara e remoção de resíduos</li>
                                            <li>Verificação visual de termopares e resistências</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Calibração de temperatura com padrão certificado</li>
                                            <li>Inspeção de vedações da porta</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Verificação de conexões elétricas</li>
                                            <li>Lubrificação de dobradiças e travas</li>
                                            <li>Teste de uniformidade de temperatura (survey térmico)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-forno-inducao" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Forno de Indução</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Utiliza campo eletromagnético para aquecimento rápido e localizado, ideal para têmpera superficial e tratamentos seletivos. Alta eficiência energética e precisão no controle de temperatura.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Verificar bobina de indução (sem trincas ou oxidação)</li>
                                            <li>Posicionar peça centralmente na bobina com distância uniforme</li>
                                            <li>Ajustar potência e frequência conforme material e profundidade desejada</li>
                                            <li>Programar tempo de aquecimento (geralmente 5-30 segundos)</li>
                                            <li>Acionar ciclo e monitorar temperatura via pirômetro</li>
                                            <li>Após aquecimento, realizar têmpera imediata por spray ou imersão</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Nunca operar com bobina danificada (risco de arco elétrico)</li>
                                            <li>Manter distância mínima de 30cm durante operação</li>
                                            <li>Não usar marcapasso cardíaco próximo ao equipamento</li>
                                            <li>Verificar sistema de refrigeração da bobina antes de iniciar</li>
                                            <li>Usar protetor facial devido à radiação térmica intensa</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Verificação do fluxo de água de refrigeração</li>
                                            <li>Inspeção visual de cabos e conexões</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Limpeza de bobina com ar comprimido</li>
                                            <li>Teste de isolamento elétrico</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Verificação de capacitores e componentes eletrônicos</li>
                                            <li>Calibração de potência e frequência</li>
                                            <li>Troca de filtros do sistema de refrigeração</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-forno-vacuo" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Forno a Vácuo</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Permite tratamentos livres de oxidação, com atmosfera controlada e alta pureza. Ideal para aços inoxidáveis, ligas especiais, brasagem e tratamentos que exigem acabamento superficial brilhante.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Limpar peças com solvente desengraxante (evitar contaminação)</li>
                                            <li>Carregar câmara e fechar porta com torque especificado</li>
                                            <li>Acionar bomba de vácuo até atingir &lt;10⁻² mbar</li>
                                            <li>Programar rampa de aquecimento (máx. 10°C/min para evitar choque térmico)</li>
                                            <li>Manter patamar de temperatura no vácuo</li>
                                            <li>Resfriar com gás inerte (N2 ou Ar) sob pressão controlada</li>
                                            <li>Equalizar pressão antes de abrir porta</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Nunca abrir porta com vácuo ativo (risco de implosão)</li>
                                            <li>Verificar vazamentos com detector de hélio mensalmente</li>
                                            <li>Não introduzir materiais com graxa ou óleo (contaminação irreversível)</li>
                                            <li>Monitorar nível de óleo da bomba de vácuo semanalmente</li>
                                            <li>Usar respirador em caso de vazamento de gases durante manutenção</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Limpeza interna da câmara com pano antiestático</li>
                                            <li>Verificação de nível de vácuo alcançado</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Inspeção de vedações (O-rings) e aplicação de graxa de vácuo</li>
                                            <li>Verificação de nível e qualidade do óleo da bomba</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Troca de óleo da bomba de vácuo</li>
                                            <li>Teste de estanqueidade (leak test) com hélio</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Substituição de O-rings e vedações</li>
                                            <li>Revisão completa da bomba de vácuo (palhetas/rotores)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-forno-atmosfera" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Forno de Atmosfera Controlada</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Opera com gases específicos (Endogas, N2, H2, CO, CO2) para controlar reações químicas durante o tratamento térmico. Essencial para cementação, carbonitretação e tratamentos que exigem controle de potencial de carbono.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Verificar disponibilidade de gases (pressão mínima 2 bar)</li>
                                            <li>Purgar câmara com N2 antes de introduzir atmosfera ativa</li>
                                            <li>Carregar peças e fechar retorta</li>
                                            <li>Estabelecer fluxo de gás conforme IT (vazão típica: 5-10 L/min)</li>
                                            <li>Aquecer e estabilizar temperatura</li>
                                            <li>Monitorar potencial de carbono via sonda de O2 ou análise de CO/CO2</li>
                                            <li>Ajustar composição de gases durante processo para manter PC desejado</li>
                                            <li>Após ciclo, resfriar sob atmosfera inerte</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>NUNCA misturar O2 com H2 ou CO (risco de explosão)</li>
                                            <li>Manter detector de gases calibrado e ativo</li>
                                            <li>Ventilar área antes de abrir forno (gases tóxicos: CO)</li>
                                            <li>Verificar integridade da retorta semanalmente (vazamentos causam descontrole de atmosfera)</li>
                                            <li>Usar analisador de CO portátil ao operar próximo ao forno</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Verificação de fluxo de gases e pressões</li>
                                            <li>Calibração de sonda de O2/PC</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Limpeza de bicos injetores de gás</li>
                                            <li>Inspeção de vedações da retorta</li>
                                            <li>Teste de detector de CO</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Substituição de sonda de O2 (vida útil: 1-3 meses)</li>
                                            <li>Verificação de válvulas reguladoras de pressão</li>
                                            <li>Análise química de atmosfera com cromatógrafo (verificação de PC)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Trimestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Limpeza completa da retorta (remoção de fuligem)</li>
                                            <li>Troca de filtros de linha de gases</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-forno-sais" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Forno de Sais (Banho de Sais)</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Utiliza banhos de sais fundidos (cloretos, nitratos, carbonatos) para aquecimento uniforme e resfriamento controlado. Ideal para martêmpera, austêmpera e têmpera isotérmica, minimizando distorções.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Verificar nível e temperatura do banho antes de iniciar</li>
                                            <li>Pré-aquecer peças em forno auxiliar até 400-600°C (evitar choque térmico)</li>
                                            <li>Imergir peças lentamente no banho de sais fundidos</li>
                                            <li>Manter tempo de permanência conforme IT (uniformização de temperatura)</li>
                                            <li>Para austêmpera: transferir rapidamente para banho de sais a 250-400°C</li>
                                            <li>Após tratamento, lavar peças em água quente (60-80°C) para remover sais</li>
                                            <li>Neutralizar resíduos com solução alcalina ou ácida</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>NUNCA introduzir peças úmidas (risco de explosão de vapor)</li>
                                            <li>Usar proteção facial completa (respingo de sal fundido causa queimaduras graves)</li>
                                            <li>Manter extintores Classe D próximos (sais podem reagir com água)</li>
                                            <li>Ventilar área constantemente (vapores tóxicos de nitratos)</li>
                                            <li>Descartar sais contaminados conforme normas ambientais</li>
                                            <li>Nunca permitir que temperatura ultrapasse 50°C acima do ponto de fusão do sal</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Remoção de escória superficial do banho</li>
                                            <li>Verificação de nível de sal (completar se necessário)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Análise química do banho (verificar contaminação)</li>
                                            <li>Inspeção de resistências elétricas ou queimadores</li>
                                            <li>Verificação de integridade do cadinho/tanque</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Troca parcial do banho (renovação de 20-30%)</li>
                                            <li>Calibração de termopares</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Drenagem completa e limpeza do tanque</li>
                                            <li>Inspeção de refratários e revestimentos</li>
                                            <li>Substituição total do banho de sais</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-tanques-resfriamento" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Tanques de Resfriamento (Têmpera)</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Tanques para resfriamento rápido de peças após aquecimento. Disponíveis com água, óleo mineral ou soluções poliméricas. Essenciais para transformação martensítica em processos de têmpera, com agitação controlada para uniformidade.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Verificar temperatura do meio de têmpera (óleo: 60-80°C, água: 20-40°C)</li>
                                            <li>Ativar sistema de agitação 2 minutos antes do uso</li>
                                            <li>Retirar peça do forno e transferir rapidamente (&lt;5 segundos)</li>
                                            <li>Imergir peça verticalmente, movimento de cima para baixo</li>
                                            <li>Manter peça em movimento circular durante primeiros 10-15 segundos</li>
                                            <li>Deixar peça imersa até atingir temperatura ambiente (&lt;50°C)</li>
                                            <li>Lavar peça em água quente (óleo) ou secar com ar comprimido (água)</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Manter distância de segurança durante imersão (risco de vaporização violenta)</li>
                                            <li>Nunca imergir peças acima de 900°C em água (trincas por choque térmico)</li>
                                            <li>Usar luvas térmicas impermeáveis e avental de couro</li>
                                            <li>Manter tampa do tanque de óleo fechada quando não em uso (risco de combustão)</li>
                                            <li>Instalar sistema de combate a incêndio próximo (espuma ou CO2)</li>
                                            <li>Monitorar temperatura do óleo (não exceder 100°C - risco de inflamação)</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Remoção de resíduos e escórias da superfície</li>
                                            <li>Verificação de nível do meio de têmpera</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Teste de velocidade de resfriamento (curva de resfriamento)</li>
                                            <li>Análise de viscosidade do óleo (40 cSt ideal a 40°C)</li>
                                            <li>Limpeza de filtros e telas</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Análise de contaminação por água no óleo (máx. 0,1%)</li>
                                            <li>Verificação de sistema de agitação (motores, hélices)</li>
                                            <li>Inspeção de serpentinas de aquecimento/resfriamento</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Trimestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Filtração completa do óleo (remoção de carbono e partículas)</li>
                                            <li>Análise de ponto de fulgor do óleo (mín. 180°C)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Anual:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Troca completa do óleo de têmpera</li>
                                            <li>Limpeza profunda e inspeção de tanque (corrosão, vazamentos)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-nitreta-plasma" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Equipamento de Nitretação a Plasma</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Realiza nitretação superficial por plasma ionizado (descarga de brilho). Promove formação de camada de compostos (Fe2-3N, Fe4N) com dureza 700-1200 HV e zona de difusão de nitrogênio. Ideal para ferramentas, moldes e componentes sujeitos a desgaste severo.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li>Limpar peças com ultrassom + álcool (contaminação impede uniformidade)</li>
                                            <li>Carregar peças e fixar suportes (garantir contato elétrico)</li>
                                            <li>Fechar câmara e fazer vácuo até 10⁻² mbar</li>
                                            <li>Introduzir mistura gasosa: 75% N2 + 25% H2 (pressão 2-5 mbar)</li>
                                            <li>Aplicar tensão DC (300-600V) para gerar descarga de brilho (plasma roxo/violeta)</li>
                                            <li>Aquecer até 480-580°C por efeito Joule do plasma</li>
                                            <li>Manter processo por 10-20h conforme profundidade de camada desejada</li>
                                            <li>Desligar plasma, resfriar sob vácuo ou N2 até &lt;150°C</li>
                                            <li>Equalizar pressão e descarregar</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Nunca abrir câmara com vácuo ativo ou temperatura &gt;100°C</li>
                                            <li>Usar óculos de proteção (plasma emite radiação UV intensa)</li>
                                            <li>Verificar isolamento elétrico de suportes (risco de arco elétrico)</li>
                                            <li>Não nitretar aços inoxidáveis sem passivação posterior (risco de corrosão)</li>
                                            <li>Manter detector de vazamento de H2 ativo (gás inflamável)</li>
                                            <li>Aterrar equipamento adequadamente (alta tensão DC)</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Limpeza interna da câmara (remoção de pó de ferro)</li>
                                            <li>Verificação de vácuo alcançado</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Inspeção de eletrodos (catodo/anodo) - substituir se corroídos</li>
                                            <li>Verificação de nível de óleo da bomba de vácuo</li>
                                            <li>Teste de uniformidade de plasma (visual - cor homogênea)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Troca de óleo da bomba de vácuo</li>
                                            <li>Calibração de fluxo de gases (N2 e H2)</li>
                                            <li>Teste de isolamento elétrico (suportes e câmara)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Trimestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Substituição de vedações (O-rings) da porta</li>
                                            <li>Revisão de fonte DC (capacitores, transformadores)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Overhaul da bomba de vácuo (troca de palhetas/rotores)</li>
                                            <li>Teste de estanqueidade com detector de hélio</li>
                                        </ul>
                                    </div>
                                </div>
                                <div id="maquina-oxidacao-negra" class="maquina-details hidden">
                                    <h3 class="text-xl font-bold mb-4 text-blue-900">Equipamento de Oxidação Negra</h3>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">📋 Descrição Geral</h4>
                                        <p class="text-gray-700">Sistema de banhos químicos para formação de camada de óxido de ferro (Fe3O4 - magnetita) em aços. Produz acabamento preto acetinado, aumenta resistência à corrosão leve e reduz reflexão de luz. Amplamente usado em ferramentas, componentes mecânicos e armas.</p>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔧 Operação</h4>
                                        <ol class="list-decimal ml-6 space-y-1 text-gray-700">
                                            <li><strong>Desengraxe alcalino:</strong> Imersão em solução de NaOH a 80-90°C por 10-15 min</li>
                                            <li><strong>Enxágue:</strong> Lavagem em água corrente (2-3 min)</li>
                                            <li><strong>Decapagem ácida:</strong> Imersão em HCl 10% por 3-5 min (remoção de óxidos)</li>
                                            <li><strong>Enxágue:</strong> Lavagem em água corrente</li>
                                            <li><strong>Oxidação:</strong> Imersão em banho de NaOH + NaNO3 a 135-145°C por 20-30 min</li>
                                            <li><strong>Enxágue:</strong> Lavagem em água fria</li>
                                            <li><strong>Neutralização:</strong> Imersão em ácido fosfórico diluído (1-2 min)</li>
                                            <li><strong>Enxágue final:</strong> Lavagem em água quente (60-70°C)</li>
                                            <li><strong>Proteção:</strong> Imersão em óleo protetivo ou selante acrílico</li>
                                            <li><strong>Secagem:</strong> Ar comprimido ou estufa a 80°C</li>
                                        </ol>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">⚠️ Cuidados e Segurança</h4>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Usar EPI completo: luvas nitrílicas, avental PVC, protetor facial, botas</li>
                                            <li>NUNCA adicionar água aos banhos (reação exotérmica violenta)</li>
                                            <li>Manter ventilação forçada permanente (vapores alcalinos são corrosivos)</li>
                                            <li>Ter chuveiro lava-olhos próximo e acessível</li>
                                            <li>Neutralizar respingos imediatamente com vinagre ou ácido fraco</li>
                                            <li>Não oxidar peças com cobre, latão ou alumínio (contaminação do banho)</li>
                                            <li>Descartar efluentes conforme legislação ambiental (tratamento de pH)</li>
                                        </ul>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4 class="font-bold text-lg mb-2 text-gray-800">🔨 Manutenção Preventiva</h4>
                                        <p class="font-semibold text-gray-800 mb-1">Diária:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Remoção de borras e sedimentos dos tanques</li>
                                            <li>Verificação de temperatura dos banhos</li>
                                            <li>Limpeza de bicos e filtros</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semanal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Análise de concentração de NaOH (120-150 g/L) e NaNO3 (200-300 g/L)</li>
                                            <li>Ajuste de pH dos banhos de enxágue</li>
                                            <li>Inspeção de resistências elétricas de aquecimento</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Mensal:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Renovação parcial do banho de oxidação (30-40%)</li>
                                            <li>Limpeza de serpentinas de aquecimento</li>
                                            <li>Verificação de integridade dos tanques (corrosão)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Trimestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700 mb-3">
                                            <li>Troca completa do banho de desengraxe</li>
                                            <li>Teste de qualidade da camada (uniformidade, aderência)</li>
                                        </ul>
                                        <p class="font-semibold text-gray-800 mb-1">Semestral:</p>
                                        <ul class="list-disc ml-6 space-y-1 text-gray-700">
                                            <li>Troca completa do banho de oxidação</li>
                                            <li>Revisão de sistema de ventilação/exaustão</li>
                                            <li>Treinamento de operadores em procedimentos de emergência</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!-- NOVO BLOCO DE SCRIPT PARA AS MÁQUINAS -->
                            <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                document.querySelectorAll('.maquina-btn').forEach(function(btn) {
                                    btn.addEventListener('click', function() {
                                        document.querySelectorAll('.maquina-details').forEach(function(detail) {
                                            detail.classList.add('hidden');
                                        });
                                        var target = this.getAttribute('data-maquina');
                                        var el = document.getElementById(target);
                                        if (el) el.classList.remove('hidden');
                                    });
                                });
                            });
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Conversão da Calculadora -->
    <div id="calc-conversion-modal" class="fixed inset-0 z-50 overflow-y-auto items-center justify-center hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center">
            <div id="calc-modal-backdrop" class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
            <div id="calc-modal-content" class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all my-8 max-w-sm w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
                            <i data-lucide="info" class="h-6 w-6 text-blue-600"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="calc-modal-title">Conversão de Dureza</h3>
                            <div class="mt-4 space-y-3" id="calc-modal-body">
                                <!-- Conteúdo da conversão -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="calc-close-modal-btn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <a href="https://wa.me/554191485285" target="_blank" id="whatsapp-button" class="fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition-transform hover:scale-110 z-40 flex items-center justify-center">
        <i class="fab fa-whatsapp fa-2x"></i>
    </a>
    <div id="confirmation-message" class="hidden fixed top-24 right-6 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2 fade-in" role="alert">
        <i data-lucide="check-circle" class="w-5 h-5"></i>
        <span id="confirmation-text" class="font-medium"></span>
    </div>

    <script>
        // --- LÓGICA DA LINHA DO TEMPO (MOVIDA PARA ESCOPO GLOBAL) ---
        function updateTimeline(status) {
            const statusMap = { 
                'Pedido Recebido': 0, 
                'Em Análise': 0, 
                'Aguardando Matéria-prima': 1,
                'Aguardando Material': 1,
                'Pendente': 1, 
                'Em Produção': 2, 
                'Controle de Qualidade': 3, 
                'Finalizado': 4,
                'Concluído': 4
            };
            const currentStepIndex = statusMap[status] !== undefined ? statusMap[status] : -1;
            
            document.querySelectorAll('.timeline-step').forEach((stepEl, index) => {
                stepEl.classList.remove('active', 'completed');
                const timeEl = stepEl.querySelector('time');
                timeEl.textContent = ''; 

                if (index < currentStepIndex) {
                    stepEl.classList.add('completed');
                    timeEl.textContent = `Concluído`;
                } else if (index === currentStepIndex) {
                    stepEl.classList.add('active');
                    timeEl.textContent = `Etapa atual`;
                }
            });
            // Re-cria os ícones Lucide após a atualização da classe
            // É importante chamar lucide.createIcons() aqui se o ícone for afetado pelo status
            if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
                lucide.createIcons();
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // =========================
            //   CHART.JS THEME HELPERS
            // =========================
            function setChartJsTheme(isDark) {
                if (!window.Chart) return;
                // Defaults for new charts (alto contraste)
                Chart.defaults.color = isDark ? '#f8fafc' : '#0f172a'; // texto global
                Chart.defaults.font = Object.assign({}, Chart.defaults.font, { size: 13, family: 'system-ui, Segoe UI, sans-serif' });
                // Grid & border defaults
                Chart.defaults.borderColor = isDark ? 'rgba(255,255,255,0.25)' : 'rgba(15,23,42,0.4)';
                Chart.defaults.elements = Chart.defaults.elements || {};
                // Lines
                Chart.defaults.elements.line = Object.assign({}, Chart.defaults.elements.line, {
                    borderWidth: 2,
                    tension: 0.3
                });
                // Points
                Chart.defaults.elements.point = Object.assign({}, Chart.defaults.elements.point, {
                    radius: 4,
                    hoverRadius: 6,
                    borderWidth: 2,
                    backgroundColor: isDark ? '#ffffff' : '#0f172a',
                    borderColor: isDark ? '#1f2937' : '#ffffff'
                });
                // Bars
                Chart.defaults.elements.bar = Object.assign({}, Chart.defaults.elements.bar, {
                    borderColor: isDark ? '#f8fafc' : '#0f172a',
                    borderWidth: 2,
                    hoverBorderColor: isDark ? '#ffffff' : '#0f172a'
                });
                // Plugins defaults
                Chart.defaults.plugins = Chart.defaults.plugins || {};
                Chart.defaults.plugins.legend = Object.assign({}, Chart.defaults.plugins.legend, {
                    labels: Object.assign({}, Chart.defaults.plugins.legend?.labels, {
                        color: isDark ? '#f1f5f9' : '#0f172a',
                        font: Object.assign({}, Chart.defaults.plugins.legend?.labels?.font, { size: 13 })
                    })
                });
                Chart.defaults.plugins.title = Object.assign({}, Chart.defaults.plugins.title, {
                    color: isDark ? '#f8fafc' : '#0f172a',
                    font: Object.assign({}, Chart.defaults.plugins.title?.font, { weight: '600', size: 16 })
                });
                Chart.defaults.plugins.tooltip = Object.assign({}, Chart.defaults.plugins.tooltip, {
                    backgroundColor: isDark ? 'rgba(15,23,42,0.95)' : 'rgba(255,255,255,0.95)',
                    titleColor: isDark ? '#f8fafc' : '#0f172a',
                    bodyColor: isDark ? '#f1f5f9' : '#1e293b',
                    borderColor: isDark ? '#334155' : '#cbd5e1',
                    borderWidth: 1
                });
                // Scale defaults
                const scaleCommon = {
                    grid: {
                        color: isDark ? 'rgba(255,255,255,0.12)' : 'rgba(15,23,42,0.12)',
                        borderColor: isDark ? '#f8fafc' : '#0f172a',
                        tickColor: isDark ? '#f8fafc' : '#0f172a'
                    },
                    ticks: {
                        color: isDark ? '#f1f5f9' : '#0f172a',
                        backdropColor: 'transparent'
                    }
                };
                Chart.defaults.scales = Chart.defaults.scales || {};
                ['x','y','r'].forEach(axis => {
                    Chart.defaults.scales[axis] = Object.assign({}, Chart.defaults.scales[axis], scaleCommon);
                });
            }

            function updateChartsTheme() {
                if (!window.Chart || !window.chartInstances) return;
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'transparent' : 'rgba(15,23,42,0.5)'; // azul muito escuro e bem opaco no modo claro
                const tickColor = isDark ? '#e5e7eb' : '#0f172a'; // azul quase preto no modo claro
                const borderColor = isDark ? '#ffffff' : '#0f172a'; // azul quase preto no modo claro
                
                // Cores vibrantes para datasets no modo escuro
                const darkModeColors = [
                    '#60a5fa', // blue-400
                    '#34d399', // emerald-400
                    '#f59e0b', // amber-500
                    '#a78bfa', // violet-400
                    '#fb923c', // orange-400
                    '#ec4899', // pink-500
                    '#14b8a6', // teal-500
                    '#f472b6', // pink-400
                ];
                
                // Cores acessíveis para daltonismo (para gráficos de pizza/donut no modo escuro)
                // Paleta com alto contraste e muito distintas entre si
                const colorBlindFriendlyColors = [
                    '#0072B2', // Azul forte e escuro
                    '#E69F00', // Laranja/Amarelo vibrante
                    '#009E73', // Verde-água/Teal
                    '#F0E442', // Amarelo brilhante
                    '#D55E00', // Vermelho-alaranjado
                    '#CC79A7', // Rosa médio
                    '#56B4E9', // Azul claro/Cyan
                    '#999999', // Cinza médio
                ];

                Object.values(window.chartInstances).forEach((chart) => {
                    if (!chart || !chart.options) return;
                    
                    const textColor = isDark ? '#f8fafc' : '#0f172a';
                    const gridColor = isDark ? 'rgba(255,255,255,0.12)' : 'rgba(15,23,42,0.12)';
                    const borderAxisColor = isDark ? '#f8fafc' : '#0f172a';
                    
                    // Atualiza legend, tooltip e title
                    if (!chart.options.plugins) chart.options.plugins = {};
                    
                    if (!chart.options.plugins.legend) chart.options.plugins.legend = {};
                    if (!chart.options.plugins.legend.labels) chart.options.plugins.legend.labels = {};
                    chart.options.plugins.legend.labels.color = textColor;
                    
                    if (chart.options.plugins.title) {
                        chart.options.plugins.title.color = textColor;
                    }
                    
                    if (!chart.options.plugins.tooltip) chart.options.plugins.tooltip = {};
                    chart.options.plugins.tooltip.backgroundColor = isDark ? 'rgba(15,23,42,0.95)' : 'rgba(255,255,255,0.95)';
                    chart.options.plugins.tooltip.titleColor = textColor;
                    chart.options.plugins.tooltip.bodyColor = textColor;
                    chart.options.plugins.tooltip.borderColor = isDark ? '#334155' : '#cbd5e1';
                    chart.options.plugins.tooltip.borderWidth = 1;
                    
                    // Atualiza scales (eixos)
                    if (chart.options.scales) {
                        Object.keys(chart.options.scales).forEach((axisKey) => {
                            const axis = chart.options.scales[axisKey];
                            if (!axis.grid) axis.grid = {};
                            if (!axis.ticks) axis.ticks = {};
                            
                            axis.grid.color = gridColor;
                            axis.grid.borderColor = borderAxisColor;
                            axis.grid.tickColor = borderAxisColor;
                            axis.ticks.color = textColor;
                        });
                    }
                    
                    // Dataset styling in dark mode (restrict to pie/doughnut to avoid scriptable recursion)
                    if (chart.data && Array.isArray(chart.data.datasets)) {
                        chart.data.datasets.forEach((ds, index) => {
                            if (isDark) {
                                // Aplica bordas brancas em gráficos de barras no modo escuro
                                if (chart.config.type === 'bar') {
                                    ds.borderColor = '#f8fafc';
                                    ds.borderWidth = 2;
                                    ds.hoverBorderColor = '#ffffff';
                                }
                                else if (chart.config.type === 'pie' || chart.config.type === 'doughnut') {
                                    // Usa cores acessíveis para daltonismo em gráficos de pizza/donut no modo escuro
                                    console.log('Aplicando cores no modo escuro para:', chart.canvas.id);
                                    // Armazena cores originais se ainda não foi feito
                                    if (!ds._originalBackgroundColor) {
                                        ds._originalBackgroundColor = Array.isArray(ds.backgroundColor) ? [...ds.backgroundColor] : ds.backgroundColor;
                                        ds._originalBorderColor = ds.borderColor;
                                        ds._originalBorderWidth = ds.borderWidth;
                                        console.log('Cores originais:', ds._originalBackgroundColor);
                                    }
                                    
                                    // Aplica cores vibrantes e distintas no modo escuro
                                    const darkModeChartColors = ['#10b981', '#f59e0b', '#8b5cf6', '#06b6d4', '#ef4444', '#ec4899'];
                                    
                                    if (Array.isArray(ds.backgroundColor)) {
                                        ds.backgroundColor = ds.backgroundColor.map((_, i) => darkModeChartColors[i % darkModeChartColors.length]);
                                    } else {
                                        ds.backgroundColor = darkModeChartColors;
                                    }
                                    ds.borderColor = 'rgba(31,41,55,1)';
                                    console.log('Novas cores aplicadas:', ds.backgroundColor);
                                    ds.borderWidth = 2;
                                }
                            } else {
                                // Modo claro: restaura configurações originais
                                if (chart.config.type === 'bar') {
                                    // Restaura bordas originais das barras
                                    ds.borderColor = ds.borderColor || '#0f172a';
                                    ds.borderWidth = 2;
                                    ds.hoverBorderColor = ds.hoverBorderColor || '#0f172a';
                                }
                                else if (chart.config.type === 'pie' || chart.config.type === 'doughnut') {
                                    // Restaura cores originais no modo claro
                                    if (ds._originalBackgroundColor) {
                                        ds.backgroundColor = Array.isArray(ds._originalBackgroundColor) ? [...ds._originalBackgroundColor] : ds._originalBackgroundColor;
                                        ds.borderColor = ds._originalBorderColor;
                                        ds.borderWidth = ds._originalBorderWidth || 0;
                                    }
                                }
                            }
                        });
                    }
                    try { 
                        chart.update();
                    } catch(e) { 
                        console.warn('Falha ao atualizar gráfico:', chart.config.type, e); 
                    }
                });
                console.log('Tema dos gráficos atualizado. Modo escuro:', isDark);
            }

            // Expose for other parts of the page
            window.setChartJsTheme = setChartJsTheme;
            window.updateChartsTheme = updateChartsTheme;
            
            // Inicializa o tema dos gráficos imediatamente
            const isDarkMode = document.documentElement.classList.contains('dark');
            setChartJsTheme(isDarkMode);

            // =========================
            //   LINE CHART OUTLINE PLUGIN (DARK MODE)
            // =========================
            (function registerLineOutlinePlugin(){
                if (!window.Chart || window._lineOutlinePluginRegistered) return;
                const lineOutlinePlugin = {
                    id: 'lineOutline',
                    beforeDatasetsDraw(chart) {
                        if (chart.config.type !== 'line') return;
                        const isDark = document.documentElement.classList.contains('dark');
                        if (!isDark) return;
                        
                        const ctx = chart.ctx;
                        ctx.save();
                        
                        chart.data.datasets.forEach((dataset, datasetIndex) => {
                            const meta = chart.getDatasetMeta(datasetIndex);
                            if (!meta.visible || meta.hidden) return;
                            
                            // Desenha contorno branco grosso
                            ctx.strokeStyle = '#ffffff';
                            ctx.lineWidth = (dataset.borderWidth || 2) + 4; // 4px mais grosso
                            ctx.lineJoin = 'round';
                            ctx.lineCap = 'round';
                            
                            ctx.beginPath();
                            meta.data.forEach((point, index) => {
                                if (point && !isNaN(point.x) && !isNaN(point.y)) {
                                    if (index === 0) {
                                        ctx.moveTo(point.x, point.y);
                                    } else {
                                        ctx.lineTo(point.x, point.y);
                                    }
                                }
                            });
                            ctx.stroke();
                        });
                        
                        ctx.restore();
                    }
                };
                Chart.register(lineOutlinePlugin);
                window._lineOutlinePluginRegistered = true;
            })();

            // =========================
            //   PIE/DOUGHNUT LABELS PLUGIN
            // =========================
            (function registerPieLabelsPlugin(){
                if (!window.Chart || window._pieLabelsPluginRegistered) return;
                const pieLabelsPlugin = {
                    id: 'pieLabels',
                    afterDatasetsDraw(chart) {
                        const type = chart.config.type;
                        if (!(type === 'pie' || type === 'doughnut')) return;
                        const disable = chart.options && chart.options.plugins && chart.options.plugins.pieLabels === false;
                        if (disable) return;
                        const ctx = chart.ctx;
                        const ds = chart.data.datasets?.[0];
                        const labels = chart.data.labels || [];
                        if (!ds) return;
                        const total = (ds.data || []).reduce((a, b) => a + (typeof b === 'number' ? b : 0), 0);
                        const meta = chart.getDatasetMeta(0);
                        const isDark = document.documentElement.classList.contains('dark');
                        ctx.save();
                        ctx.fillStyle = isDark ? '#e5e7eb' : '#111827';
                        ctx.strokeStyle = isDark ? '#9ca3af' : '#6b7280';
                        ctx.lineWidth = 1;
                        const area = chart.chartArea;
                        meta.data.forEach((arc, i) => {
                            if (!arc || !arc.circumference) return;
                            const angle = (arc.startAngle + arc.endAngle) / 2;
                            const outer = arc.outerRadius;
                            const centerX = arc.x;
                            const centerY = arc.y;
                            const value = ds.data[i] ?? 0;
                            const percent = total ? Math.round((value / total) * 100) : 0;
                            const label = labels[i] ?? '';
                            const text = `${label} (${percent}%)`;

                            // Dynamic font sizing based on radius
                            const fs = outer < 110 ? 10 : 12;
                            ctx.font = `${fs}px ${Chart.defaults.font?.family || 'sans-serif'}`;

                            // Position outside the slice
                            const lineStartR = outer + 4;
                            const labelR = outer + 10; // slightly closer to avoid clipping
                            const sx = centerX + Math.cos(angle) * lineStartR;
                            const sy = centerY + Math.sin(angle) * lineStartR;
                            const tx = centerX + Math.cos(angle) * labelR;
                            const ty = centerY + Math.sin(angle) * labelR;

                            // Leader line
                            ctx.beginPath();
                            ctx.moveTo(sx, sy);
                            ctx.lineTo(tx, ty);
                            ctx.stroke();

                            // Align text based on side
                            const onRight = Math.cos(angle) >= 0;
                            ctx.textAlign = onRight ? 'left' : 'right';
                            ctx.textBaseline = 'middle';
                            let nx = tx + (onRight ? 6 : -6); // nudge text away from leader line
                            let ny = ty;

                            // Clamp within chartArea to avoid clipping
                            const textWidth = ctx.measureText(text).width;
                            if (onRight) {
                                nx = Math.min(nx, area.right - 4 - textWidth);
                            } else {
                                // For 'right' aligned text, x is the right edge
                                nx = Math.max(nx, area.left + 4);
                            }
                            ny = Math.min(Math.max(ny, area.top + 6), area.bottom - 6);

                            ctx.fillText(text, nx, ny);
                        });
                        ctx.restore();
                    }
                };
                Chart.register(pieLabelsPlugin);
                window._pieLabelsPluginRegistered = true;
            })();

            // =========================
            //      THEME TOGGLER
            // =========================
            (function initTheme() {
                const storageKey = 'theme';
                const btn = document.getElementById('theme-toggle');

                function applyTheme(mode) {
                    const isDark = mode === 'dark';
                    document.documentElement.classList.toggle('dark', isDark);
                    
                    // Usar logo.svg em ambos os modos
                    const logo = document.getElementById('main-logo');
                    if (logo) {
                        logo.src = 'logo.svg';
                    }
                    
                    if (btn) {
                        btn.setAttribute('aria-pressed', String(isDark));
                        const icon = btn.querySelector('[data-lucide]');
                        if (icon) icon.setAttribute('data-lucide', isDark ? 'sun' : 'moon');
                        if (window.lucide && typeof window.lucide.createIcons === 'function') {
                            window.lucide.createIcons();
                        }
                    }
                    // Apply chart theme defaults and update existing charts
                    if (window.setChartJsTheme) window.setChartJsTheme(isDark);
                    if (window.updateChartsTheme) window.updateChartsTheme();
                }

                let current = localStorage.getItem(storageKey);
                if (!current) {
                    current = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                }
                applyTheme(current);

                btn && btn.addEventListener('click', () => {
                    current = current === 'dark' ? 'light' : 'dark';
                    localStorage.setItem(storageKey, current);
                    applyTheme(current);
                });

                // Follow system preference if user hasn't chosen a theme explicitly
                try {
                    const mql = window.matchMedia('(prefers-color-scheme: dark)');
                    mql.addEventListener('change', (e) => {
                        const stored = localStorage.getItem(storageKey);
                        if (!stored) {
                            current = e.matches ? 'dark' : 'light';
                            applyTheme(current);
                        }
                    });
                } catch(_) { /* older browsers */ }
            })();
            window.triggerDownload = (fileName, fileContent) => {
                // Se o conteúdo do arquivo estiver presente (foi um upload real), usa-o para o download.
                if (fileContent) {
                    function dataURLtoBlob(dataurl) {
                        var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
                            bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
                        while(n--){
                            u8arr[n] = bstr.charCodeAt(n);
                        }
                        return new Blob([u8arr], {type:mime});
                    }

                    try {
                        const blob = dataURLtoBlob(fileContent);
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = fileName;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                        return;
                    } catch (e) {
                        console.error("Error creating file for download from Data URL:", e);
                        // Fallback para simulação
                    }
                }
                
                // Se não houver conteúdo (ou a conversão falhou), faz a simulação.
                const dummyContent = `This is a simulation file for: ${fileName}\n\nTest file content.`;
                const blob = new Blob([dummyContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = fileName;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                console.warn(`Simulated download for ${fileName} as no file content was found or conversion failed.`);
            };
            
            // --- LÓGICA DO MENU HAMBURGUER ---
            const hamburgerButton = document.getElementById('hamburger-button');
            const mainMenu = document.getElementById('main-menu-list');
            const menuIcon = document.getElementById('menu-icon');
            const closeIcon = document.getElementById('close-icon');

            if (hamburgerButton && mainMenu && menuIcon && closeIcon) {
                hamburgerButton.addEventListener('click', () => {
                    mainMenu.classList.toggle('menu-open');
                    menuIcon.classList.toggle('hidden');
                    closeIcon.classList.toggle('hidden');
                });
            }
        }); // Fecha o DOMContentLoaded da linha 2080

            // ====================================================================
            // SISTEMA DE CARREGAMENTO DE DADOS DA PLANILHA EXCEL
            // ====================================================================
            
            // Variáveis globais para armazenar dados da planilha
            let rawOrdersData = [];
            let ordersById = {};
            let clientCredentials = {}; // Armazena {username: {password, company}}
            let excelDataLoaded = false;

            // Função para carregar a planilha Excel
            async function loadExcelData() {
                try {
                    console.log('🔄 Carregando planilha base_dados.xlsx...');
                    
                    const response = await fetch('base_dados.xlsx');
                    if (!response.ok) {
                        throw new Error(`Erro ao carregar planilha: ${response.status}`);
                    }
                    
                    const arrayBuffer = await response.arrayBuffer();
                    const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                    
                    // Pega a primeira planilha
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    
                    // Converte para JSON mantendo os nomes das colunas
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                        raw: false, // Mantém formatação de datas e números como string
                        defval: '' // Valor padrão para células vazias
                    });
                    
                    console.log(`✅ Planilha carregada: ${jsonData.length} registros encontrados`);
                    
                    // Processa os dados
                    rawOrdersData = jsonData;
                    
                    // Cria mapa de pedidos por número
                    ordersById = rawOrdersData.reduce((acc, order) => {
                        const orderNum = order["Nº do Pedido"];
                        if (orderNum) {
                            acc[orderNum] = order;
                        }
                        return acc;
                    }, {});
                    
                    // Cria mapa de credenciais dos clientes
                    // Estrutura: { "nomelogin": { password: "senha", company: "Nome da Empresa" } }
                    clientCredentials = {};
                    const uniqueClients = new Map();
                    
                    rawOrdersData.forEach(order => {
                        const loginName = order["Nome Login"];
                        const password = order["Senha Login"];
                        const company = order["Nome da Empresa"];
                        
                        if (loginName && company && !uniqueClients.has(loginName)) {
                            uniqueClients.set(loginName, true);
                            clientCredentials[loginName.toLowerCase().trim()] = {
                                password: password || '123', // Senha padrão se vazia
                                company: company.trim(),
                                loginName: loginName.trim()
                            };
                        }
                    });
                    
                    console.log('✅ Credenciais processadas:', Object.keys(clientCredentials).length, 'clientes');
                    console.log('📋 Clientes disponíveis:', Object.keys(clientCredentials));
                    
                    excelDataLoaded = true;
                    return true;
                    
                } catch (error) {
                    console.error('❌ Erro ao carregar planilha Excel:', error);
                    alert('Erro ao carregar dados da planilha. Verifique se o arquivo base_dados.xlsx está no diretório correto.');
                    
                    // Dados de fallback caso a planilha não carregue
                    rawOrdersData = [
                        { "Data do Pedido": "16/09/2025", "Nº do Pedido": "001", "Nome da Empresa": "Gama", "Nome Login": "gama", "Senha Login": "123", "CNPJ": "33.333.333/0001-33", "Contato Telefônico": "(41) 96666-6666", "E-mail": "contato@gama.com.br", "Material": "Ferro Fundido", "Tratamento Térmico": "Normalização", "Dureza Requerida (HRC)": "54 – 64", "Quantidade (peças)": 10, "Prazo de Entrega": "26/09/2025", "Status": "Aguardando Matéria-prima", "Observações": "Reteste necessário", "Última Atualização (Data/Hora)": "17/09/2025 10:00" }
                    ];
                    
                    ordersById = { "001": rawOrdersData[0] };
                    clientCredentials = { "gama": { password: "123", company: "Gama", loginName: "gama" } };
                    
                    return false;
                }
            }

            // ====================================================================
            // FIM DO SISTEMA DE CARREGAMENTO
            // ====================================================================
            
            // Carrega dados da planilha assim que a página carregar
            window.addEventListener('load', async () => {
                console.log('🚀 Iniciando carregamento da planilha...');
                await loadExcelData();
            });

            // --- BANCO DE DADOS E ESTADO GLOBAL ---
            let currentUser = null;
            let currentOrderStatus = '';
            let currentUserData = {};
            let navigationHistory = [];
            let currentPageId = null;
            
            // Simulação de banco de dados de arquivos (sem conteúdo inicial para os dados de exemplo)
            // Atualizado para usar o nome da empresa como clientId
            let mockUploadedFiles = [
                { docId: 'cert004', clientId: 'Indústria Beta', orderId: '004', type: 'Certificado', fileName: 'Certificado_Qualidade_Pedido_004.pdf', date: '02/10/2025', fileContent: null },
                { docId: 'os004', clientId: 'Indústria Beta', orderId: '004', type: 'Ordem de Serviço', fileName: 'OS_Pedido_004.pdf', date: '22/09/2025', fileContent: null },
                { docId: 'cert008', clientId: 'Indústria Beta', orderId: '008', type: 'Certificado', fileName: 'Certificado_Qualidade_Pedido_008.pdf', date: '16/09/2025', fileContent: null },
                { docId: 'ped002', clientId: 'MetalParts Ltda', orderId: '002', type: 'Pedido', fileName: 'Pedido_Cliente_002.pdf', date: '17/09/2025', fileContent: null },
            ];

            // Os mocks abaixo foram removidos e substituídos por rawOrdersData
            // const mockDatabase = {};
            // const mockHistoryData = []; 
            const treatmentOptions = { construcao_mecanica: ["Têmpera", "Beneficiamento", "Revenimento", "Martêmpera", "Carbonitretação", "Cementação", "Nitretação", "Alívio de tensões", "Recozimento", "Normalização", "Têmpera por indução", "Processo de Oxidação Negra", "Tufftride"], ferramenta_especiais: ["Têmpera a vácuo", "Triplo Revenimento", "Revenimento a vácuo", "Alívio de tensão a vácuo para acabamento brilhante (bright stress relief)", "Envelhecimento a vácuo", "Solubilização a vácuo", "Recozimento total ou pleno", "Recozimento isotérmico a vácuo", "Nitretação a plasma"], ferros_fundidos: ["Austêmpera", "Têmpera", "Têmpera por indução", "Nitretação", "Normalização", "Perlitização", "Recozimento"] };

            // --- ELEMENTOS DO DOM ---
            const landingPageView = document.getElementById('landing-page-view');
            const clientPortalWrapper = document.getElementById('client-portal-wrapper');
            const loginAreaButton = document.getElementById('login-area-button');
            const portalToggleButton = document.getElementById('portal-toggle-button');
            const portalActionsContainer = document.getElementById('portal-actions-container');
            const homeLogoLink = document.getElementById('home-logo-link');
            const mainNav = document.getElementById('main-nav');
            const loginView = document.getElementById('login-view');
            const dashboardView = document.getElementById('dashboard-view');
            const loginForm = document.getElementById('login-form');
                        // Radio user type labels setup (replace inline handlers)
                        (function initUserTypeRadios(){
                            const radios = document.querySelectorAll('input[name="userType"]');
                            const update = () => {
                                 radios.forEach(r => {
                                     const lbl = r.closest('label.user-type-label');
                                     if(!lbl) return;
                                     if(r.checked) lbl.classList.add('selected'); else lbl.classList.remove('selected');
                                 });
                            };
                            radios.forEach(r => r.addEventListener('change', update));
                            update();
                        })();
            const userInfo = document.getElementById('user-info');
            const usernameDisplay = document.getElementById('username-display');
            const logoutButton = document.getElementById('logout-button');
            const clientNav = document.getElementById('client-nav');
            const gestorNav = document.getElementById('gestor-nav');
            const adminNav = document.getElementById('admin-nav');
            const collaboratorNav = document.getElementById('collaborator-nav');
            const visitorNav = document.getElementById('visitor-nav');
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmationText = document.getElementById('confirmation-text');
            const previousFunctionButton = document.getElementById('previous-function-button');
            if (previousFunctionButton) {
                previousFunctionButton.style.display = 'none';
            }
            const whatsappButton = document.getElementById('whatsapp-button');
            const portalHeader = document.getElementById('portal-header');
            const backToSiteBtn = document.getElementById('back-to-site-btn');
            let confirmationTimeout;

            // Debug: Verificar se os elementos foram encontrados
            console.log('loginForm:', loginForm);
            console.log('loginView:', loginView);
            console.log('dashboardView:', dashboardView);


             // ============================================================================
             // CHAT NORMATIC - GOOGLE GEMINI API (CÓDIGO DE fale_conosco.html)
             // ============================================================================
            
            // Configuração da API (MODO DEMO - SEM CHAVES NO CÓDIGO)
// ============================================================================
// Este projeto é uma demo. Para habilitar a IA localmente, salve as chaves no navegador:
// localStorage.setItem('GEMINI_API_KEY_NORMATIC','SUA_CHAVE');
// localStorage.setItem('GEMINI_API_KEY_CONSULTANT','SUA_CHAVE');
// (ou use apenas GEMINI_API_KEY como fallback)

function getGeminiApiKey(purpose) {
    const p = (purpose || '').toUpperCase();
    // chaves específicas por função
    if (p === 'NORMATIC') return (localStorage.getItem('GEMINI_API_KEY_NORMATIC') || localStorage.getItem('GEMINI_API_KEY') || '').trim();
    if (p === 'CONSULTANT') return (localStorage.getItem('GEMINI_API_KEY_CONSULTANT') || localStorage.getItem('GEMINI_API_KEY') || '').trim();
    return (localStorage.getItem('GEMINI_API_KEY') || '').trim();
}

function buildGeminiUrl(purpose) {
    const key = getGeminiApiKey(purpose);
    if (!key || key.length < 10) return null;
    return `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${encodeURIComponent(key)}`;
}

function geminiDisabledResult(message) {
    return {
        candidates: [{
            content: { parts: [{ text: message }] }
        }]
    };
}

// System Instruction em Português para definir o papel do modelo
            const SYSTEM_PROMPT_NORMATIC = {
                parts: [{
                    text: "Você é o Assistente Virtual e Especialista em Tratamentos Térmicos da Normatic. Sua função é responder a todas as perguntas do usuário de forma concisa, profissional e informativa, utilizando informações baseadas em pesquisas na web sobre a empresa Normatic (Tratamentos Térmicos) e seus serviços (têmpera, recozimento, normalização, cementação, nitretação, etc.). Mantenha um tom prestativo e encoraje o usuário a entrar em contato com a equipe de vendas para cotações ou detalhes técnicos. Sempre utilize a busca na web (Google Search) para obter informações atualizadas e factuais sobre a empresa Normatic (mencionada no site https://www.normatic.com.br/) e o setor de tratamento térmico. Responda sempre em Português."
                }]
            };

            const chatWindow = document.getElementById('chat-window');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            const typingIndicator = document.getElementById('typing-indicator');

            // Histórico do Chat (usado para contexto na API)
            let chatHistory = [];

            function appendMessage(sender, text, sources = []) {
                const messageContainer = document.createElement('div');
                messageContainer.className = sender === 'user' ? 'flex justify-end' : 'flex justify-start';

                const messageBubble = document.createElement('div');
                messageBubble.className = `max-w-xs md:max-w-md p-3 ${sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`;
                messageBubble.style.whiteSpace = 'pre-wrap'; // Para respeitar quebras de linha

                // Adiciona o texto principal
                messageBubble.textContent = text;

                // Adiciona as citações/fontes
                if (sources.length > 0) {
                    const sourcesDiv = document.createElement('div');
                    sourcesDiv.className = 'citation';
                    sourcesDiv.innerHTML = '<strong>Fontes:</strong> ' + sources.map((source, index) => {
                        return `<a href="${source.uri}" target="_blank" rel="noopener noreferrer">${source.title || 'Link ' + (index + 1)}</a>`;
                    }).join(', ');
                    messageBubble.appendChild(sourcesDiv);
                }

                messageContainer.appendChild(messageBubble);
                chatWindow.appendChild(messageContainer);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function showTypingIndicator() {
                typingIndicator.classList.remove('hidden');
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function hideTypingIndicator() {
                typingIndicator.classList.add('hidden');
            }

            // Função principal para enviar mensagem
            async function sendMessage() {
                const query = userInput.value.trim();
                if (!query) return;

                // 1. Desabilita input e botão
                userInput.disabled = true;
                sendButton.disabled = true;

                // 2. Adiciona a mensagem do usuário e limpa o input
                appendMessage('user', query);
                userInput.value = '';

                // 3. Adiciona a query ao histórico
                chatHistory.push({ role: "user", parts: [{ text: query }] });

                // 4. Mostra indicador de digitação
                showTypingIndicator();

                try {
                    // 5. Chama a API do Gemini
                    const response = await callGeminiApi(chatHistory);

                    // 6. Processa a resposta
                    processResponse(response);

                } catch (error) {
                    console.error("Erro na comunicação com a API do Gemini:", error);
                    appendMessage('ai', "Desculpe, ocorreu um erro ao buscar a informação. Por favor, tente novamente mais tarde.");
                } finally {
                    // 7. Esconde indicador e habilita input
                    hideTypingIndicator();
                    userInput.disabled = false;
                    sendButton.disabled = false;
                    userInput.focus();
                }
            }

            // Função para chamar a API com retentativas (Exponential Backoff)
            async function callGeminiApi(history, maxRetries = 5) {
                const apiUrl = buildGeminiUrl('NORMATIC');
                if (!apiUrl) {
                    return geminiDisabledResult(`⚠️ Módulo de IA (Assistente Normatic) desativado na DEMO.

Para habilitar localmente: abra o Console (F12) e rode:
localStorage.setItem('GEMINI_API_KEY_NORMATIC','SUA_CHAVE')`);
                }

                const payload = {
                    contents: history,
                    systemInstruction: SYSTEM_PROMPT_NORMATIC,
                    // Habilita Google Search Grounding
                    tools: [{ "google_search": {} }],
                };

                for (let attempt = 0; attempt < maxRetries; attempt++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429 && attempt < maxRetries - 1) {
                            // Exponencial backoff
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue; // Tenta novamente
                        }

                        if (!response.ok) {
                            throw new Error(`API retornou erro HTTP: ${response.status}`);
                        }

                        return response.json();

                    } catch (error) {
                        if (attempt === maxRetries - 1) {
                            throw error; // Lança o erro após a última tentativa
                        }
                        // Continua para a próxima tentativa
                    }
                }
            }

            // Função para processar a resposta da API
            function processResponse(result) {
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    chatHistory.push({ role: "model", parts: [{ text: text }] }); // Adiciona a resposta ao histórico

                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Exibe a resposta
                    appendMessage('ai', text, sources);

                } else {
                    appendMessage('ai', "Desculpe, não consegui gerar uma resposta. A Normatic agradece o contato!");
                }
            }

            // Função para limpar históricos de chat (mantida para compatibilidade)
            function clearAllChatHistories() {
                // Limpa chat geral (Fale Conosco)
                if (chatWindow) {
                    const messages = chatWindow.querySelectorAll('.flex');
                    messages.forEach((msg, index) => {
                        if (index > 0) { // Mantém apenas a primeira mensagem (boas-vindas)
                            msg.remove();
                        }
                    });
                }
                chatHistory = [];
                
                // Limpa consultor técnico
                if (consultantChatWindow) {
                    const consultantMessages = consultantChatWindow.querySelectorAll('.flex');
                    consultantMessages.forEach((msg, index) => {
                        if (index > 0) { // Mantém apenas a primeira mensagem (boas-vindas)
                            msg.remove();
                        }
                    });
                }
                consultantChatHistory = [];
                
                console.log('✅ Históricos de chat limpos (geral + consultor técnico)');
            }

             // ============================================================================
             // FIM DO CHAT NORMATIC
             // ============================================================================

            const chatStatusIndicator = document.getElementById('chat-status-indicator');
            async function testGeminiConnectivity() {
                if (!apiKey) {
                    console.error('❌ API Key não configurada');
                    return;
                }

                console.log('🧪 Testando Gemini API...');
                
                try {
                    const testPayload = {
                        contents: [{
                            parts: [{ text: 'teste' }]
                        }]
                    };

                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(testPayload)
                    });

                    const responseText = await response.text();
                    console.log('🧪 Status teste:', response.status);
                    console.log('🧪 Resposta teste:', responseText);

                    if (response.status === 404) {
                        console.error('❌ ERRO 404: Chave API inválida ou expirada');
                        if (chatStatusIndicator) {
                            chatStatusIndicator.innerHTML = '❌ Chave API inválida. <a href="https://aistudio.google.com/app/apikey" target="_blank" class="underline">Gere uma nova aqui</a>';
                            chatStatusIndicator.classList.remove('hidden');
                            chatStatusIndicator.classList.add('text-red-600');
                        }
                        return;
                    }

                    if (!response.ok) {
                        console.error(`❌ Erro ${response.status}:`, responseText);
                        if (chatStatusIndicator) {
                            chatStatusIndicator.textContent = `Erro API: ${response.status}`;
                            chatStatusIndicator.classList.remove('hidden');
                            chatStatusIndicator.classList.add('text-red-600');
                        }
                        return;
                    }

                    const result = JSON.parse(responseText);
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        console.log('✅ Gemini conectado!');
                        if (chatStatusIndicator) {
                            chatStatusIndicator.textContent = `✅ IA conectada (${GEMINI_MODEL})`;
                            chatStatusIndicator.classList.remove('hidden');
                            chatStatusIndicator.classList.add('text-green-600');
                        }
                    }
                } catch (error) {
                    console.error('❌ Erro no teste:', error);
                    if (chatStatusIndicator) {
                        chatStatusIndicator.textContent = `⚠️ Rate limit detectado - retry automático ativo`;
                        chatStatusIndicator.classList.remove('hidden');
                        chatStatusIndicator.classList.add('text-yellow-600');
                    }
                }
            }
            
            // setTimeout(testGeminiConnectivity, 1000); // REMOVIDO - funcionalidade antiga

            // --- LÓGICA DE VISIBILIDADE DO BOTão WHATSAPP ---
            function updateWhatsappVisibility() {
                const isLandingVisible = !landingPageView.classList.contains('hidden');
                const isLoginVisible = !loginView.classList.contains('hidden');

                if (isLandingVisible) {
                    whatsappButton.classList.remove('hidden');
                } else if (isLoginVisible) {
                    whatsappButton.classList.add('hidden');
                } else if (currentUser) {
                    if (currentUser.profile === 'client') {
                        whatsappButton.classList.remove('hidden');
                    } else {
                        whatsappButton.classList.add('hidden');
                    }
                } else {
                    whatsappButton.classList.add('hidden');
                }
            }
            
            // --- LÓGICA DE LOGIN E NAVEGAÇÃO PRINCIPAL ---
            if (loginAreaButton) {
                loginAreaButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    landingPageView.classList.add('hidden');
                    clientPortalWrapper.classList.remove('hidden');
                    mainNav.classList.add('hidden');
                    portalActionsContainer.classList.remove('hidden');
                    portalActionsContainer.classList.add('flex');
                    updateWhatsappVisibility();
                });
            }
            
            if (homeLogoLink) {
                homeLogoLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentUser) return;
                clientPortalWrapper.classList.add('hidden');
                landingPageView.classList.remove('hidden');
                mainNav.classList.remove('hidden');
                portalActionsContainer.classList.add('hidden');
                portalActionsContainer.classList.remove('flex');
                updateWhatsappVisibility();
                });
            }
            
            if (loginForm) {
                loginForm.addEventListener('submit', async (event) => {
                event.preventDefault();
                console.log('Formulário de login submetido!');
                
                // Garante que os dados estão carregados
                if (!excelDataLoaded) {
                    alert('Aguarde, carregando dados do sistema...');
                    await loadExcelData();
                }
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                const userType = document.querySelector('input[name="userType"]:checked').value;
                console.log('Username:', username, 'UserType:', userType);
                
                if (username) {
                    const normalizedUsername = username.toLowerCase();
                    let finalClientId = username;
                    let loginSuccess = false;
                    
                    // =========================================================================
                    // AUTENTICAÇÃO BASEADA NA PLANILHA EXCEL
                    // =========================================================================
                    
                    if (userType === 'client') {
                        // Busca credenciais na planilha
                        const clientData = clientCredentials[normalizedUsername];
                        
                        if (clientData) {
                            // Valida senha
                            if (clientData.password === password) {
                                finalClientId = clientData.company;
                                loginSuccess = true;
                                console.log('✅ Login cliente aprovado:', clientData.loginName, '→', clientData.company);
                            } else {
                                alert('❌ Senha incorreta!');
                                console.log('❌ Senha incorreta para:', username);
                                return;
                            }
                        } else {
                            alert('❌ Usuário não encontrado!\n\nClientes cadastrados: ' + Object.keys(clientCredentials).join(', '));
                            console.log('❌ Cliente não encontrado:', username);
                            console.log('📋 Clientes disponíveis:', Object.keys(clientCredentials));
                            return;
                        }
                    } else if (userType === 'admin') {
                        // Admin tem login fixo (pode ser modificado)
                        if (username.toLowerCase() === 'admin' && password === '123') {
                            finalClientId = 'admin1';
                            loginSuccess = true;
                        } else {
                            alert('❌ Credenciais de administrador inválidas!');
                            return;
                        }
                    } else if (userType === 'gestor') {
                        // Gestor tem login fixo (pode ser modificado)
                        if (password === '123') {
                            finalClientId = 'gestor1';
                            loginSuccess = true;
                        } else {
                            alert('❌ Senha incorreta para gestor!');
                            return;
                        }
                    } else if (userType === 'collaborator') {
                        // Colaborador tem login fixo (pode ser modificado)
                        if (password === '123') {
                            finalClientId = 'colaborador1';
                            loginSuccess = true;
                        } else {
                            alert('❌ Senha incorreta para colaborador!');
                            return;
                        }
                    }
                    
                    // Se chegou aqui sem loginSuccess, algo deu errado
                    if (!loginSuccess) {
                        alert('❌ Erro na autenticação!');
                        return;
                    }
                    
                    // =========================================================================
                    // LOGIN APROVADO - PROSSEGUE
                    // =========================================================================

                    currentUser = { 
                        username, 
                        profile: userType,
                        id: finalClientId // Nome da empresa (cliente) ou ID de perfil
                    };
                    
                    loginView.classList.add('hidden');
                    dashboardView.classList.remove('hidden');
                    dashboardView.classList.add('fade-in');
                    
                    // Mostrar header e ocultar botão voltar ao site
                    if (portalHeader) portalHeader.classList.remove('hidden');
                    if (backToSiteBtn) backToSiteBtn.classList.add('hidden');
                    
                    const headerAuthSection = document.getElementById('header-auth-section');
                    if (headerAuthSection) headerAuthSection.classList.add('hidden');
                    if (userInfo) {
                        userInfo.classList.remove('hidden');
                        userInfo.classList.add('flex');
                    }
                    if (usernameDisplay) usernameDisplay.textContent = username;
                    if (portalActionsContainer) {
                        portalActionsContainer.classList.remove('hidden');
                        portalActionsContainer.classList.add('flex');
                    }
                    
                    clientNav.classList.add('hidden');
                    gestorNav.classList.add('hidden');
                    adminNav.classList.add('hidden');
                    collaboratorNav.classList.add('hidden');
                    if (visitorNav) visitorNav.classList.add('hidden');

                    // Limpa históricos de chat ao fazer login
                    clearAllChatHistories();

                    if (userType === 'client') { 
                        clientNav.classList.remove('hidden'); 
                        loadUserData(); 
                        showPage('dashboard-cliente'); // Redireciona para o novo dashboard do cliente
                    } 
                    else if (userType === 'gestor') { gestorNav.classList.remove('hidden'); showPage('dashboard'); }
                    else if (userType === 'admin') { adminNav.classList.remove('hidden'); showPage('gerenciar-pedidos'); } 
                    else if (userType === 'collaborator') { collaboratorNav.classList.remove('hidden'); showPage('consultor-ia'); }
                    updateWhatsappVisibility();
                }
                });
            }
            
            if (logoutButton) {
                logoutButton.addEventListener('click', () => {
                    // Reset user state
                    currentUser = null;
                    if (loginForm) loginForm.reset();
                    navigationHistory = [];
                    currentPageId = null;

                    // Limpa históricos de chat ao fazer logout
                    clearAllChatHistories();

                    // Header: hide portal header, show back button to site
                    if (portalHeader) portalHeader.classList.add('hidden');
                    if (backToSiteBtn) backToSiteBtn.classList.remove('hidden');
                    if (userInfo) userInfo.classList.add('hidden');

                    // Keep portal wrapper visible to show login form again
                    if (clientPortalWrapper) clientPortalWrapper.classList.remove('hidden');
                    if (landingPageView) landingPageView.classList.add('hidden');
                    if (dashboardView) dashboardView.classList.add('hidden');
                    if (loginView) loginView.classList.remove('hidden');

                    // Hide main navigation (focus on login screen)
                    if (mainNav) mainNav.classList.add('hidden');
                    const headerAuthSection = document.getElementById('header-auth-section');
                    if (headerAuthSection) headerAuthSection.classList.remove('hidden');

                    // Hide portal actions
                    if (portalActionsContainer) {
                        portalActionsContainer.classList.add('hidden');
                        portalActionsContainer.classList.remove('flex');
                    }

                    // Adjust toggle button label back to site
                    if (portalToggleButton) portalToggleButton.innerHTML = `<i data-lucide="arrow-left" class="w-5 h-5"></i><span>Voltar ao Site</span>`;
                    lucide.createIcons();
                    updateWhatsappVisibility();
                });
            }

            if (portalToggleButton) {
                portalToggleButton.addEventListener('click', () => {
                const isPortalVisible = !clientPortalWrapper.classList.contains('hidden');
                if (isPortalVisible) {
                    clientPortalWrapper.classList.add('hidden');
                    landingPageView.classList.remove('hidden');
                    mainNav.classList.remove('hidden');
                    if (currentUser) {
                        portalToggleButton.innerHTML = `<i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Acessar Portal</span>`;
                    } else {
                        portalActionsContainer.classList.add('hidden');
                        portalActionsContainer.classList.remove('flex');
                    }
                } else {
                    landingPageView.classList.add('hidden');
                    clientPortalWrapper.classList.remove('hidden');
                    mainNav.classList.add('hidden');
                    if (portalToggleButton) portalToggleButton.innerHTML = `<i data-lucide="arrow-left" class="w-5 h-5"></i><span>Voltar ao Site</span>`;
                }
                lucide.createIcons();
                updateWhatsappVisibility();
                });
            }

            if (previousFunctionButton) {
                previousFunctionButton.addEventListener('click', () => {
                    if (navigationHistory.length > 0) {
                        const previousPageId = navigationHistory.pop();
                        showPage(previousPageId, true); 
                    }
                });
            }
            
            // --- LÓGICA DE NAVEGAÇÃO INTERNA (MENUS LATERAIS) ---
            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page-content');
            function showPage(pageId, isNavigatingBack = false) {
                console.log('showPage chamada com pageId:', pageId);
                console.log('Páginas encontradas:', pages.length);
                if (pageId === currentPageId) return; 

                // Encerrar animações ao sair de páginas específicas
                if (currentPageId === 'rastreamento' && pageId !== 'rastreamento') {
                    if (typeof stopRastreamentoAnimation === 'function') stopRastreamentoAnimation();
                }

                if (!isNavigatingBack && currentPageId) {
                    navigationHistory.push(currentPageId);
                }

                pages.forEach(page => page.classList.remove('active'));
                const activePage = document.getElementById(`page-${pageId}`);
                console.log('Procurando por página:', `page-${pageId}`, 'Encontrada:', activePage);
                if (activePage) {
                    activePage.classList.add('active');
                    console.log('Página ativada:', pageId);
                } else {
                    console.error('Página não encontrada:', `page-${pageId}`);
                }
                
                navItems.forEach(item => { 
                    item.classList.remove('active'); 
                    if (item.getAttribute('href') === `#${pageId}`) item.classList.add('active'); 
                });

                currentPageId = pageId;

                if (pageId === 'dashboard-cliente') renderClientDashboard(); // Novo!
                if (pageId === 'gerenciar-pedidos') renderAdminGerenciarPedidos(); // Admin: Gerenciar Pedidos
                if (pageId === 'historico') renderHistory();
                if (pageId === 'downloads') renderDownloads();
                if (pageId === 'orcamento') updateTreatmentOptions();
                if (pageId === 'coleta') document.getElementById('pickup-address').value = currentUserData.defaultPickup || currentUserData.address || '';
                if (pageId === 'entrega') document.getElementById('delivery-address').value = currentUserData.defaultDelivery || currentUserData.address || '';
                if (pageId === 'chat') {
                    // Mostra mensagem de boas-vindas no chat geral se estiver vazio
                    const normaticWindow = document.getElementById('normatic-chat-window');
                    if (normaticWindow && normaticWindow.children.length === 0) {
                        addNormaticMessage('👋 Olá! Sou o assistente virtual da Normatic. Como posso ajudá-lo com informações sobre nossos serviços de tratamento térmico?', false);
                        if (normaticChatStatus) {
                            normaticChatStatus.textContent = 'Sistema pronto';
                        }
                    }
                }
                // Nota: Mensagem de boas-vindas do consultor técnico já está no HTML
                
                if (pageId.startsWith('dashboard') && pageId !== 'dashboard-cliente' || ['qualidade', 'expedicao', 'tratamentos', 'financeiro', 'rh'].includes(pageId)) renderDashboardCharts(pageId);
                if (pageId === 'calculadora') initializeCalculatorApp();
                
                // Inicializa botões de normas técnicas
                if (pageId === 'normas') {
                    document.querySelectorAll('.norma-btn').forEach(function(btn) {
                        btn.addEventListener('click', function() {
                            document.querySelectorAll('.norma-details').forEach(function(detail) {
                                detail.classList.add('hidden');
                            });
                            var target = this.getAttribute('data-norma');
                            var el = document.getElementById(target);
                            if (el) el.classList.remove('hidden');
                        });
                    });
                }
                
                // Inicializa botões de instruções de trabalho
                if (pageId === 'instrucoes') {
                    document.querySelectorAll('.it-btn').forEach(function(btn) {
                        btn.addEventListener('click', function() {
                            document.querySelectorAll('.it-details').forEach(function(detail) {
                                detail.classList.add('hidden');
                            });
                            var target = this.getAttribute('data-it');
                            var el = document.getElementById(target);
                            if (el) el.classList.remove('hidden');
                        });
                    });
                    // Todas as instruções começam ocultas - só exibem quando clicar
                }
                
                if (pageId === 'uploads') lucide.createIcons();

                // Inicializa/ativa o mapa de rastreamento quando a página for aberta
                if (pageId === 'rastreamento') {
                    if (typeof initRastreamentoMap === 'function') initRastreamentoMap();
                    if (typeof startRastreamentoAnimation === 'function') startRastreamentoAnimation();
                    // Ajuste de tamanho após exibir a página
                    setTimeout(() => { if (window.rastreamentoMap && typeof window.rastreamentoMap.invalidateSize === 'function') window.rastreamentoMap.invalidateSize(); }, 150);
                }
            }
            navItems.forEach(item => { item.addEventListener('click', (e) => { e.preventDefault(); const pageId = e.currentTarget.getAttribute('href').substring(1); showPage(pageId); }); });

             // --- LÓGICA DAS PÁGINAS DO CLIENTE E ADMIN ---
            function showConfirmation(message) {
                if (confirmationTimeout) clearTimeout(confirmationTimeout);
                confirmationText.textContent = message;
                confirmationMessage.classList.remove('hidden');
                confirmationTimeout = setTimeout(() => { confirmationMessage.classList.add('hidden'); }, 3000);
            }
             function updateTreatmentOptions() {
                const metalTypeSelect = document.getElementById('metal-type');
                const treatmentTypeSelect = document.getElementById('treatment-type');
                const selectedMetalType = metalTypeSelect.value;
                const options = treatmentOptions[selectedMetalType] || [];
                treatmentTypeSelect.innerHTML = '';
                options.forEach(optionText => { treatmentTypeSelect.innerHTML += `<option value="${optionText}">${optionText}</option>`; });
            }
            document.getElementById('metal-type').addEventListener('change', updateTreatmentOptions);
            function loadUserData() {
                const savedData = localStorage.getItem('userData');
                if (savedData) {
                    currentUserData = JSON.parse(savedData);
                    document.getElementById('user-name').value = currentUserData.name || '';
                    document.getElementById('user-address').value = currentUserData.address || '';
                    document.getElementById('user-phone').value = currentUserData.phone || '';
                    document.getElementById('user-email').value = currentUserData.email || '';
                    document.getElementById('user-default-delivery').value = currentUserData.defaultDelivery || '';
                    document.getElementById('user-default-pickup').value = currentUserData.defaultPickup || '';
                }
            }

            // --- LÓGICA DE DOWNLOADS (CORRIGIDA PARA NOVO CLIENTE) ---
            function renderDownloads() {
                const downloadsContainer = document.getElementById('page-downloads');
                downloadsContainer.innerHTML = `
                    <div class="bg-white rounded-lg shadow-sm border min-func-box flex flex-col">
                        <h2 class="text-2xl font-bold normatic-blue-text mb-2">Downloads</h2>
                        <p class="text-gray-500 dark:text-gray-400 mb-6">Filtre e baixe os documentos relacionados aos seus pedidos.</p>
                        <div class="mb-6">
                            <label for="doc-type-filter" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Filtrar por tipo de documento:</label>
                            <select id="doc-type-filter" class="mt-1 block w-full md:w-1/3 px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 text-gray-900 dark:text-gray-100">
                                <option value="todos">Todos os Tipos</option>
                                <option value="Certificado">Certificado</option>
                                <option value="Ordem de Serviço">Ordem de Serviço</option>
                                <option value="Pedido">Pedido</option>
                                <option value="Laudo">Laudo</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div id="downloads-list" class="space-y-4 flex-1"></div>
                    </div>
                `;

                const filterSelect = document.getElementById('doc-type-filter');
                const listContainer = document.getElementById('downloads-list');
                // CORREÇÃO: Usa o ID do cliente exatamente como ele está, e em minúsculas para o filtro.
                const clientFilterId = currentUser.id; 

                function updateList() {
                    const filterValue = filterSelect.value;
                    listContainer.innerHTML = '';

                    // O filtro compara o clientId (que é o nome completo da empresa/usuário) com o ID do documento.
                    const userFiles = mockUploadedFiles.filter(file => file.clientId === clientFilterId);
                    const filteredFiles = filterValue === 'todos' ? userFiles : userFiles.filter(file => file.type === filterValue);

                    if (filteredFiles.length === 0) {
                        listContainer.innerHTML = '<div class="bg-white p-4 rounded-md border text-center"><p class="text-gray-500">Nenhum documento encontrado para este filtro.</p></div>';
                        return;
                    }

                    filteredFiles.forEach(file => {
                        const itemContainer = document.createElement('div');
                        itemContainer.className = 'bg-white p-4 rounded-md border flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3';

                        const infoDiv = document.createElement('div');
                        infoDiv.innerHTML = `
                            <p class="font-bold text-gray-800 flex items-center gap-2">
                                <i data-lucide="file-text" class="w-5 h-5 text-gray-500"></i>
                                ${file.fileName}
                            </p>
                            <p class="text-sm text-gray-500 ml-7">
                                <span class="font-medium">Tipo:</span> ${file.type} | 
                                <span class="font-medium">Pedido:</span> ${file.orderId || 'N/A'} | 
                                <span class="font-medium">Data:</span> ${file.date}
                            </p>
                        `;

                        const downloadLink = document.createElement('a');
                        downloadLink.href = '#';
                        downloadLink.className = 'btn-primary !py-2 !px-4 text-sm w-full sm:w-auto text-center';
                        downloadLink.innerHTML = `<i data-lucide="download" class="w-4 h-4 inline-block -mt-1 mr-1"></i> Baixar`;
                        
                        downloadLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            // Passa o fileName e o conteúdo do arquivo
                            triggerDownload(file.fileName, file.fileContent);
                        });

                        itemContainer.appendChild(infoDiv);
                        itemContainer.appendChild(downloadLink);
                        listContainer.appendChild(itemContainer);
                    });
                    
                    lucide.createIcons();
                }

                filterSelect.addEventListener('change', updateList);
                updateList(); // Renderização inicial
            }

            
            // --- LÓGICA DO DASHBOARD DO CLIENTE (ATUALIZADA) ---
            
            // Mapeamento de status para os grupos de card desejados
            const statusGroupMap = {
                'Em Análise': 'pendente',
                'Aguardando Matéria-prima': 'pendente',
                'Aguardando Material': 'pendente',
                'Pendente': 'pendente',
                'Pedido Recebido': 'pendente',
                
                'Em Produção': 'producao',
                
                'Controle de Qualidade': 'qualidade',
                
                'Finalizado': 'finalizado',
                'Concluído': 'finalizado'
            };

            function getStatusGroup(status) {
                return statusGroupMap[status] || 'pendente'; // Default para Pendente/Análise se for desconhecido
            }
            
            function renderClientDashboard() {
                // =========================================================================
                // CORREÇÃO: Usar o currentUser.id que agora contém o nome da empresa correto (case-sensitive)
                const currentCompany = currentUser.id;
                // Filtragem do pedido usando o ID da empresa logada
                const clientOrders = rawOrdersData.filter(order => order["Nome da Empresa"] === currentCompany);
                // =========================================================================

                // 1. CÁLCULO DE MÉTRICAS (Contagem por Grupo)
                const counts = { 'pendente': 0, 'producao': 0, 'qualidade': 0, 'finalizado': 0 };
                const groupedOrders = { 'pendente': [], 'producao': [], 'qualidade': [], 'finalizado': [] };

                clientOrders.forEach(order => {
                    const group = getStatusGroup(order.Status);
                    counts[group]++;
                    groupedOrders[group].push(order);
                });

                // 2. ATUALIZAÇÃO DOS CARDS
                document.getElementById('client-pending-count').textContent = counts.pendente;
                document.getElementById('client-prod-count').textContent = counts.producao;
                document.getElementById('client-quality-count').textContent = counts.qualidade;
                document.getElementById('client-completed-count').textContent = counts.finalizado;
                
                // Remove o gráfico que foi solicitado para ser removido
                const chartElement = document.getElementById('clientTreatmentsChart');
                if(chartElement) {
                    const parent = chartElement.parentElement;
                    if(parent) parent.classList.add('hidden'); // Esconde o container do gráfico
                }
                
                // Adiciona listeners aos cards de status
                document.querySelectorAll('.status-card').forEach(card => {
                    card.onclick = () => displayOrdersForStatus(card.getAttribute('data-status-group'), groupedOrders);
                });
                
                // Exibe a lista de pedidos pendentes por padrão (se houver)
                if (counts.pendente > 0) {
                    displayOrdersForStatus('pendente', groupedOrders);
                } else {
                    document.getElementById('client-orders-table-body').innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhum pedido ativo encontrado.</td></tr>`;
                    document.getElementById('details-table-title').textContent = 'Selecione um status acima para ver os pedidos';
                    document.querySelectorAll('.status-card').forEach(card => card.classList.remove('active-status'));
                }

                lucide.createIcons();
            }
            
            function displayOrdersForStatus(statusGroup, groupedOrders) {
                const tableBody = document.getElementById('client-orders-table-body');
                const title = document.getElementById('details-table-title');
                const orders = groupedOrders[statusGroup] || [];
                
                // Atualiza o card ativo
                document.querySelectorAll('.status-card').forEach(card => card.classList.remove('active-status'));
                document.querySelector(`[data-status-group="${statusGroup}"]`).classList.add('active-status');

                let titleText = 'Pedidos';
                switch (statusGroup) {
                    case 'pendente': titleText = 'Pedidos em Análise / Pendentes'; break;
                    case 'producao': titleText = 'Pedidos Em Produção'; break;
                    case 'qualidade': titleText = 'Pedidos em Controle de Qualidade'; break;
                    case 'finalizado': titleText = 'Pedidos Finalizados / Concluídos'; break;
                }
                title.textContent = titleText;

                tableBody.innerHTML = '';

                if (orders.length === 0) {
                     tableBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhum pedido neste status.</td></tr>`;
                     return;
                }

                orders.forEach(order => {
                    const orderId = order["Nº do Pedido"];
                    const row = tableBody.insertRow();
                    row.className = 'hover:bg-gray-50';
                    
                    const statusColor = order.Status.includes('Finalizado') || order.Status.includes('Concluído') ? 'text-green-600 bg-green-100' : 
                                        (order.Status.includes('Produção') || order.Status.includes('Qualidade') ? 'text-red-600 bg-red-100' : 
                                        'text-yellow-600 bg-yellow-100');
                    
                    row.innerHTML = `
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${orderId}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700">${order["Tratamento Térmico"]}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-700">${order.Material}</td>
                        <td class="px-3 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${order.Status}
                            </span>
                        </td>
                        <td class="px-3 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <button onclick="viewOrderDetails('${orderId}')" class="text-indigo-600 hover:text-indigo-900 hover:underline text-xs">Ver Detalhes</button>
                        </td>
                    `;
                });
            }
            
            // --- LÓGICA DO HISTÓRICO DE PEDIDOS (CORRIGIDO) ---
            function renderHistory() {
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = '';
                
                // =========================================================================
                // CORREÇÃO: Usar o currentUser.id que agora contém o nome da empresa correto (case-sensitive)
                const currentCompany = currentUser.id;
                
                // Filtra os pedidos do cliente que estão com status "Finalizado" ou "Concluído"
                const completedOrders = rawOrdersData.filter(order => 
                    order["Nome da Empresa"] === currentCompany && 
                    (order.Status === 'Finalizado' || order.Status === 'Concluído')
                );
                // =========================================================================

                if(completedOrders.length === 0) { 
                    historyList.innerHTML = '<div class="bg-white p-4 rounded-md border text-center"><p class="text-gray-500">Nenhum pedido concluído no histórico.</p></div>'; 
                    return; 
                }
                
                completedOrders.forEach(order => {
                    const orderId = order["Nº do Pedido"];
                    historyList.innerHTML += `
                        <div class="bg-white p-4 rounded-md border flex flex-col sm:flex-row justify-between items-start sm:items-center">
                            <div>
                                <p class="font-bold text-gray-800">Pedido #${orderId} - ${order["Tratamento Térmico"]}</p>
                                <p class="text-sm text-gray-500">Data de Entrega: ${order["Prazo de Entrega"]}</p>
                            </div>
                            <button onclick="viewOrderDetails('${orderId}')" class="btn-primary !py-2 !px-4 text-sm mt-2 sm:mt-0">
                                Ver Detalhes
                            </button>
                        </div>`;
                });
            }

            // --- LÓGICA DE GERENCIAMENTO DE PEDIDOS (ADMINISTRADOR) ---
            function renderAdminGerenciarPedidos() {
                console.log('🔧 Renderizando página de gerenciamento de pedidos...');
                
                // Popula dropdown de clientes únicos
                const filterCliente = document.getElementById('admin-filter-cliente');
                const uniqueClients = [...new Set(rawOrdersData.map(order => order["Nome da Empresa"]))].sort();
                
                // Limpa e repovoar opções
                filterCliente.innerHTML = '<option value="todos">Todos os Clientes</option>';
                uniqueClients.forEach(client => {
                    filterCliente.innerHTML += `<option value="${client}">${client}</option>`;
                });
                
                // Função para atualizar tabela
                function updateAdminTable() {
                    const filterClienteValue = document.getElementById('admin-filter-cliente').value;
                    const filterStatusValue = document.getElementById('admin-filter-status').value;
                    const searchValue = document.getElementById('admin-search-pedido').value.trim().toLowerCase();
                    
                    // Filtra pedidos
                    let filteredOrders = rawOrdersData;
                    
                    if (filterClienteValue !== 'todos') {
                        filteredOrders = filteredOrders.filter(order => order["Nome da Empresa"] === filterClienteValue);
                    }
                    
                    if (filterStatusValue !== 'todos') {
                        filteredOrders = filteredOrders.filter(order => order.Status === filterStatusValue);
                    }
                    
                    if (searchValue) {
                        filteredOrders = filteredOrders.filter(order => 
                            order["Nº do Pedido"].toLowerCase().includes(searchValue)
                        );
                    }
                    
                    // Atualiza estatísticas
                    const statusGroups = {
                        pendente: ['Em Análise', 'Aguardando Matéria-prima', 'Aguardando Material', 'Pendente', 'Pedido Recebido'],
                        producao: ['Em Produção'],
                        qualidade: ['Controle de Qualidade'],
                        finalizado: ['Finalizado', 'Concluído']
                    };
                    
                    const stats = {
                        total: rawOrdersData.length,
                        pendente: rawOrdersData.filter(o => statusGroups.pendente.includes(o.Status)).length,
                        producao: rawOrdersData.filter(o => statusGroups.producao.includes(o.Status)).length,
                        qualidade: rawOrdersData.filter(o => statusGroups.qualidade.includes(o.Status)).length,
                        finalizado: rawOrdersData.filter(o => statusGroups.finalizado.includes(o.Status)).length
                    };
                    
                    document.getElementById('admin-total-pedidos').textContent = stats.total;
                    document.getElementById('admin-total-pendentes').textContent = stats.pendente;
                    document.getElementById('admin-total-producao').textContent = stats.producao;
                    document.getElementById('admin-total-qualidade').textContent = stats.qualidade;
                    document.getElementById('admin-total-finalizados').textContent = stats.finalizado;
                    
                    // Renderiza tabela
                    const tbody = document.getElementById('admin-pedidos-tbody');
                    tbody.innerHTML = '';
                    
                    if (filteredOrders.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="8" class="text-center py-8 text-gray-500">Nenhum pedido encontrado com os filtros aplicados.</td></tr>';
                        return;
                    }
                    
                    filteredOrders.forEach(order => {
                        const statusColor = 
                            order.Status.includes('Finalizado') || order.Status.includes('Concluído') ? 'bg-green-100 text-green-800' :
                            order.Status.includes('Produção') ? 'bg-red-100 text-red-800' :
                            order.Status.includes('Qualidade') ? 'bg-purple-100 text-purple-800' :
                            'bg-yellow-100 text-yellow-800';
                        
                        const row = tbody.insertRow();
                        row.className = 'hover:bg-gray-50';
                        row.innerHTML = `
                            <td class="px-4 py-3 text-sm font-semibold text-gray-900">#${order["Nº do Pedido"]}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">${order["Nome da Empresa"]}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">${order.Material}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">${order["Tratamento Térmico"]}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">${order["Quantidade (peças)"]}</td>
                            <td class="px-4 py-3 text-sm text-gray-700">${order["Prazo de Entrega"]}</td>
                            <td class="px-4 py-3">
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColor}">
                                    ${order.Status}
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm">
                                <button onclick="editOrderStatus('${order["Nº do Pedido"]}')" class="text-blue-600 hover:text-blue-800 font-semibold">
                                    <i data-lucide="edit-2" class="w-4 h-4 inline"></i> Editar
                                </button>
                            </td>
                        `;
                    });
                    
                    lucide.createIcons();
                }
                
                // Event listeners para filtros
                document.getElementById('admin-filter-cliente').addEventListener('change', updateAdminTable);
                document.getElementById('admin-filter-status').addEventListener('change', updateAdminTable);
                document.getElementById('admin-search-pedido').addEventListener('input', updateAdminTable);
                
                // Renderiza tabela inicial
                updateAdminTable();
            }
            
            // Função para editar status do pedido
            window.editOrderStatus = function(orderId) {
                const order = ordersById[orderId];
                if (!order) return;
                
                const statusOptions = [
                    'Em Análise',
                    'Aguardando Matéria-prima',
                    'Aguardando Material',
                    'Pendente',
                    'Em Produção',
                    'Controle de Qualidade',
                    'Finalizado',
                    'Concluído'
                ];
                
                const currentStatus = order.Status;
                
                // Cria modal de edição
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">Editar Status do Pedido #${orderId}</h3>
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-2"><strong>Cliente:</strong> ${order["Nome da Empresa"]}</p>
                            <p class="text-sm text-gray-600 mb-4"><strong>Tratamento:</strong> ${order["Tratamento Térmico"]}</p>
                            
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Novo Status:</label>
                            <select id="new-status-select" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                ${statusOptions.map(status => 
                                    `<option value="${status}" ${status === currentStatus ? 'selected' : ''}>${status}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="saveOrderStatus('${orderId}')" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700">
                                💾 Salvar
                            </button>
                            <button onclick="closeStatusModal()" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400">
                                ❌ Cancelar
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                window.currentStatusModal = modal;
            };
            
            // Função para enviar SMS de notificação de atualização de pedido
            async function sendOrderUpdateSMS(orderId, oldStatus, newStatus, order) {
                try {
                    // Configuração do Twilio (SUBSTITUA COM SUAS CREDENCIAIS)
                    const TWILIO_ACCOUNT_SID = 'ACa21e50a3e265119db0fb18eaa602e0ee'; // Ex: ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                    const TWILIO_AUTH_TOKEN = 'ada4ef93fea82f2dc7299f4f8806aead';   // Ex: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                    const TWILIO_PHONE_NUMBER = '+18158532247';      // Seu número Twilio (formato: +55XXXXXXXXXXX)
                    const DESTINATION_PHONE = '+5541995119783';        // Número de destino (WhatsApp da empresa)
                    
                    // Monta mensagem curta e compatível com Trial (1 segmento)
                    const rawMessage = `Normatic: Ola ${order["Nome da Empresa"] || 'N/A'}, seu pedido #${orderId} esta agora com o status: ${newStatus}. Seu prazo de entrega é: ${order["Prazo de Entrega"] || 'N/A'}.`;
                    // Remove acentos/emojis e mantém ASCII (GSM-7) para atingir 160 chars/segmento
                    const asciiMessage = rawMessage
                        .normalize('NFD')
                        .replace(/[\u0300-\u036f]/g, '') // remove diacríticos
                        .replace(/[^\x20-\x7E]/g, '');   // remove caracteres fora de ASCII básico
                    // Limita a ~150 chars para caber em 1 segmento no Trial (com margem)
                    const smsMessage = asciiMessage.length > 150 ? asciiMessage.slice(0, 147) + '...' : asciiMessage;
                    
                    // Cria autorização Basic Auth
                    const authHeader = 'Basic ' + btoa(TWILIO_ACCOUNT_SID + ':' + TWILIO_AUTH_TOKEN);
                    
                    // Prepara dados do formulário
                    const formData = new URLSearchParams();
                    formData.append('To', DESTINATION_PHONE);
                    formData.append('From', TWILIO_PHONE_NUMBER);
                    formData.append('Body', smsMessage);
                    
                    // Envia SMS via Twilio API
                    const response = await fetch(`https://api.twilio.com/2010-04-01/Accounts/${TWILIO_ACCOUNT_SID}/Messages.json`, {
                        method: 'POST',
                        headers: {
                            'Authorization': authHeader,
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: formData.toString()
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`Twilio API error: ${errorData.message || response.statusText}`);
                    }
                    
                    const result = await response.json();
                    console.log('✅ SMS enviado com sucesso:', result);
                    return true;
                    
                } catch (error) {
                    console.error('❌ Erro ao enviar SMS:', error);
                    return false;
                }
            }
            
            // Função para enviar e-mail de notificação de atualização de pedido
            async function sendOrderUpdateEmail(orderId, oldStatus, newStatus, order) {
                try {
                    // Inicializa EmailJS (usando chave pública)
                    emailjs.init('S9NzHoivG-vr65v7w'); // Public Key do EmailJS (atualizada)
                    
                    // Parâmetros do e-mail
                    const templateParams = {
                        to_email: 'robsonstica18@gmail.com',
                        pedido_numero: orderId,
                        cliente: order["Nome da Empresa"] || 'N/A',
                        material: order.Material || 'N/A',
                        tratamento: order["Tratamento Térmico"] || 'N/A',
                        quantidade: order["Quantidade (peças)"] || 'N/A',
                        status_antigo: oldStatus,
                        status_novo: newStatus,
                        prazo_entrega: order["Prazo de Entrega"] || 'N/A',
                        data_atualizacao: order["Última Atualização (Data/Hora)"] || 'N/A',
                        usuario_admin: currentUser?.username || 'Administrador'
                    };
                    
                    // Envia e-mail usando o serviço e template configurados
                    const response = await emailjs.send(
                        'service_23buzgs', // Service ID
                        'template_wct0dtm', // Template ID (atualizado)
                        templateParams
                    );
                    
                    console.log('✅ E-mail enviado com sucesso:', response);
                    return true;
                    
                } catch (error) {
                    console.error('❌ Erro ao enviar e-mail:', error);
                    return false;
                }
            }
            
            // Função para salvar novo status
            window.saveOrderStatus = async function(orderId) {
                const newStatus = document.getElementById('new-status-select').value;
                const order = ordersById[orderId];
                
                if (!order) return;
                
                // Guarda status antigo para o e-mail
                const oldStatus = order.Status;
                
                // Atualiza status no objeto
                order.Status = newStatus;
                
                // Atualiza data de última atualização
                const now = new Date();
                order["Última Atualização (Data/Hora)"] = `${now.toLocaleDateString('pt-BR')} ${now.toLocaleTimeString('pt-BR')}`;
                
                // Fecha modal
                closeStatusModal();
                
                // Atualiza tabela
                renderAdminGerenciarPedidos();
                
                // Mostra confirmação
                alert(`✅ Status do Pedido #${orderId} atualizado para: ${newStatus}\n\n📧 Enviando notificações (E-mail + SMS)...`);
                
                console.log(`✅ Pedido #${orderId} atualizado:`, order);
                
                // Envia e-mail de notificação (assíncrono, não bloqueia a interface)
                sendOrderUpdateEmail(orderId, oldStatus, newStatus, order).then(success => {
                    if (success) {
                        console.log('✅ Notificação por e-mail enviada com sucesso!');
                    } else {
                        console.warn('⚠️ E-mail não foi enviado, mas o pedido foi atualizado.');
                    }
                });
                
                // Envia SMS de notificação (assíncrono, não bloqueia a interface)
                sendOrderUpdateSMS(orderId, oldStatus, newStatus, order).then(success => {
                    if (success) {
                        console.log('✅ Notificação por SMS enviada com sucesso!');
                    } else {
                        console.warn('⚠️ SMS não foi enviado, mas o pedido foi atualizado.');
                    }
                });
            };
            
            // Função para fechar modal
            window.closeStatusModal = function() {
                if (window.currentStatusModal) {
                    window.currentStatusModal.remove();
                    window.currentStatusModal = null;
                }
            };


            // --- LÓGICA DO HISTÓRICO DE PEDIDOS (CORRIGIDO) ---
            function renderHistory() {
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = '';
                
                // =========================================================================
                // CORREÇÃO: Usar o currentUser.id que agora contém o nome da empresa correto (case-sensitive)
                const currentCompany = currentUser.id;
                
                // Filtra os pedidos do cliente que estão com status "Finalizado" ou "Concluído"
                const completedOrders = rawOrdersData.filter(order => 
                    order["Nome da Empresa"] === currentCompany && 
                    (order.Status === 'Finalizado' || order.Status === 'Concluído')
                );
                // =========================================================================

                if(completedOrders.length === 0) { 
                    historyList.innerHTML = '<div class="bg-white p-4 rounded-md border text-center"><p class="text-gray-500">Nenhum pedido concluído no histórico.</p></div>'; 
                    return; 
                }
                
                completedOrders.forEach(order => {
                    const orderId = order["Nº do Pedido"];
                    historyList.innerHTML += `
                        <div class="bg-white p-4 rounded-md border flex flex-col sm:flex-row justify-between items-start sm:items-center">
                            <div>
                                <p class="font-bold text-gray-800">Pedido #${orderId} - ${order["Tratamento Térmico"]}</p>
                                <p class="text-sm text-gray-500">Data de Entrega: ${order["Prazo de Entrega"]}</p>
                            </div>
                            <button onclick="viewOrderDetails('${orderId}')" class="btn-primary !py-2 !px-4 text-sm mt-2 sm:mt-0">
                                Ver Detalhes
                            </button>
                        </div>`;
                });
            }


            // Função para exibir detalhes do pedido ao clicar (EXISTENTE)
            window.viewOrderDetails = (orderId) => {
                // Navega para a página de consulta
                showPage('consulta');
                // Preenche o campo de busca com o ID do pedido
                document.getElementById('order-id').value = orderId;
                // Dispara o evento de busca (chamando a função reutilizável)
                searchOrder(orderId);
            };
            
            // --- NOVA FUNÇÃO REUTILIZÁVEL PARA BUSCAR PEDIDO ---
            async function searchOrder(orderId) {
                if (!orderId) return;

                const searchInput = document.getElementById('order-id');
                const searchButton = document.querySelector('#search-form button');
                const buttonText = searchButton.querySelector('span');
                const loadingSpinner = searchButton.querySelector('#loading-spinner');
                
                buttonText.textContent = 'A buscar...';
                searchButton.disabled = true;
                loadingSpinner.classList.remove('hidden');
                
                await new Promise(res => setTimeout(res, 800)); // Simula delay
                
                buttonText.textContent = 'Buscar';
                searchButton.disabled = false;
                loadingSpinner.classList.add('hidden');

                const data = ordersById[orderId];
                const resultContainer = document.getElementById('result-container');
                const successResult = document.getElementById('success-result');
                const errorMessage = document.getElementById('error-message');
                const geminiSummaryContainer = document.getElementById('gemini-summary-container');
                const geminiSummaryLoader = document.getElementById('gemini-summary-loader');
                const geminiSummaryText = document.getElementById('gemini-summary-text');
                const geminiNextStepsContainer = document.getElementById('gemini-next-steps-container');

                resultContainer.classList.remove('hidden');
                geminiSummaryContainer.classList.add('hidden');
                geminiNextStepsContainer.classList.add('hidden');
                geminiSummaryText.classList.add('hidden');
                
                // =========================================================================
                // CORREÇÃO: Usar o currentUser.id que agora contém o nome da empresa correto (case-sensitive)
                const currentCompany = currentUser.id;

                if(data) {
                    // 1. Verifica se o pedido pertence ao cliente logado (se for um cliente)
                    if (currentUser.profile === 'client' && data["Nome da Empresa"] !== currentCompany) {
                        successResult.classList.add('hidden');
                        errorMessage.classList.remove('hidden');
                        errorMessage.querySelector('p').textContent = "Pedido não encontrado ou não pertence a sua empresa.";
                        return;
                    }
                    // =========================================================================
                    
                    // 2. Exibe os dados
                    successResult.classList.remove('hidden');
                    errorMessage.classList.add('hidden');
                    document.getElementById('result-order-id').textContent = `#${orderId}`;
                    
                    // Atualiza os campos com os dados da planilha
                    document.getElementById('status').textContent = data.Status;
                    document.getElementById('delivery-date').textContent = data["Prazo de Entrega"];
                    document.getElementById('last-update').textContent = data["Última Atualização (Data/Hora)"];
                    document.getElementById('material').textContent = data.Material;
                    document.getElementById('treatment').textContent = data["Tratamento Térmico"];
                    document.getElementById('hardness').textContent = data["Dureza Requerida (HRC)"];

                    updateTimeline(data.Status);
                    currentOrderStatus = data.Status;

                    // 3. Resumo da IA
                    geminiSummaryContainer.classList.remove('hidden');
                    geminiSummaryLoader.classList.remove('hidden');
                    const summaryPrompt = `Crie um resumo amigável e conciso para um cliente sobre o seu pedido. O status atual é '${data.Status}', a previsão de entrega é '${data["Prazo de Entrega"]}', o material é ${data.Material} e o tratamento é ${data["Tratamento Térmico"]}. Seja otimista e claro.`;
                    
                    // Usando try/catch para garantir que o resto da página não falhe se a chamada da IA der erro
                    try {
                        const summary = await callGeminiAPI(summaryPrompt);
                        geminiSummaryText.innerHTML = marked.parse(summary);
                    } catch (e) {
                         console.error("Falha ao gerar resumo da IA:", e);
                         geminiSummaryText.innerHTML = `<p class="text-red-700">A IA falhou ao gerar o resumo. Por favor, consulte os dados brutos acima.</p>`;
                    }
                    
                    geminiSummaryLoader.classList.add('hidden');
                    geminiSummaryText.classList.remove('hidden');

                } else {
                    successResult.classList.add('hidden');
                    errorMessage.classList.remove('hidden');
                    errorMessage.querySelector('p').textContent = "Pedido não encontrado.";
                }
            }
            
            // --- ATUALIZAÇÃO DOS EVENT LISTENERS ---
            document.getElementById('search-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const orderId = document.getElementById('order-id').value.trim();
                searchOrder(orderId);
            });


            // --- DECLARAÇÃO DE VARIÁVEIS DO DOM (RESOLUÇÃO DO ERRO) ---
            const nextStepsButton = document.getElementById('next-steps-button');

            nextStepsButton.addEventListener('click', async () => {
                const nextStepsContainer = document.getElementById('gemini-next-steps-container');
                const nextStepsLoader = document.getElementById('gemini-next-steps-loader');
                const nextStepsText = document.getElementById('gemini-next-steps-text');
                
                nextStepsContainer.classList.remove('hidden');
                nextStepsText.classList.add('hidden');
                nextStepsLoader.classList.remove('hidden');

                const nextStepsPrompt = `O status de um pedido na minha empresa de tratamento térmico é '${currentOrderStatus}'. Explique para o cliente, de forma simples, direta e em 1 ou 2 frases, qual é a próxima etapa do processo de produção.`;
                
                // Usando try/catch para garantir que o resto da página não falhe se a chamada da IA der erro
                try {
                    const explanation = await callGeminiAPI(nextStepsPrompt);
                    nextStepsText.innerHTML = marked.parse(explanation);
                } catch (e) {
                    console.error("Falha ao gerar próximos passos da IA:", e);
                    nextStepsText.innerHTML = `<p class="text-red-700">A IA falhou ao determinar os próximos passos.</p>`;
                }
                
                nextStepsLoader.classList.add('hidden');
                nextStepsText.classList.remove('hidden');
            });

            // ============================================================================
            // CHAT ANTIGO REMOVIDO - Agora usa normatic-chat-form
            // ============================================================================
            
            // ============================================================================
            // CONSULTOR TÉCNICO IA - PADRÃO fale_conosco.html
            // ============================================================================
            
            // Configuração da API (MODO DEMO - chaves via localStorage; ver topo do script)
// System Instruction específico para Consultor Técnico
            const CONSULTANT_SYSTEM_PROMPT = {
                parts: [{
                    text: `Você é o CONSULTOR TÉCNICO ESPECIALIZADO da Normatic, empresa líder em tratamentos térmicos desde 1985.

⚠️ LIMITAÇÕES RIGOROSAS:
- Responda APENAS sobre tratamentos térmicos, processos metalúrgicos e normas técnicas
- EXCEÇÃO: Responda educadamente a saudações básicas (oi, olá, bom dia, etc) de forma breve antes de oferecer ajuda técnica
- NÃO responda sobre política, entretenimento, atualidades, conversas gerais ou outros assuntos não técnicos
- Se a pergunta não for técnica (exceto saudações), responda: "Desculpe, sou especializado apenas em tratamentos térmicos e processos metalúrgicos. Como posso ajudar nessa área específica?"

📚 ÁREAS DE EXPERTISE:
1. TRATAMENTOS TÉRMICOS:
   - Têmpera, Revenimento, Cementação, Nitretação, Carbonitretação
   - Normalização, Recozimento, Alívio de tensões
   - Austêmpera, Martêmpera, Tufftride
   - Tratamentos a vácuo, Nitretação a plasma
   - Oxidação negra, Processos por indução

2. ESPECIFICAÇÕES DE MATERIAIS:
   - Aços SAE, AISI, DIN, ABNT
   - Propriedades mecânicas e metalúrgicas
   - Dureza (HRC, HB, HV), Microestrutura

3. NORMAS TÉCNICAS:
   - ABNT NBR (normas brasileiras)
   - SAE, ASTM (normas americanas)
   - DIN (normas alemãs)
   - ISO (normas internacionais)

4. PROCESSOS E INSTRUÇÕES:
   - Parâmetros de processo (temperatura, tempo, resfriamento)
   - Instruções de trabalho (ITs)
   - Especificações de fornos e equipamentos
   - Controle de qualidade e inspeção
   - Procedimentos operacionais

5. CONSULTAS INTERNAS DA SEÇÃO:
   - Calculadora de Processos
   - Instruções de Trabalho
   - Normas Técnicas
   - Máquinas e Ajustes

🎯 FORMATO DE RESPOSTA:
- **SEMPRE CURTA E OBJETIVA**: Máximo de 7 linhas (aproximadamente 100 palavras)
- **RESPOSTAS DETALHADAS**: Apenas quando explicitamente solicitado com palavras como "detalhe", "explique", "completo", "aprofunde"
- Técnica e profissional
- Use Markdown para formatação quando necessário (**, *, listas curtas)
- **NUNCA use notação LaTeX, KaTeX ou fórmulas matemáticas** (evite $, \text{}, subscritos/sobrescritos)
- Escreva fórmulas químicas em texto simples: CO₂, H₂, N₂ ou CO2, H2, N2
- Cite normas específicas de forma resumida (ex: "ABNT NBR 6006")
- Forneça dados numéricos essenciais (temperaturas principais, faixas de dureza)
- Para perguntas simples: responda direto ao ponto

✅ EXEMPLOS DE RESPOSTAS CURTAS:
Pergunta: "Qual temperatura de têmpera para SAE 4140?"
Resposta: "**820-870°C** seguido de resfriamento em óleo. Resulta em dureza de **54-58 HRC**. Sempre fazer revenimento posterior para reduzir fragilidade."

Pergunta: "Diferença entre cementação e nitretação?"
Resposta: "**Cementação**: enriquece superfície com carbono (900-950°C), maior camada (0,5-2mm), >58 HRC. **Nitretação**: enriquece com nitrogênio (500-580°C), camada fina (0,1-0,6mm), até 1200 HV."

✅ RESPOSTA DETALHADA (quando solicitado):
Pergunta: "Explique detalhadamente a cementação"
Resposta: [Fornecer resposta completa com todos os parâmetros, normas, etapas, etc.]

📞 CONTATO NORMATIC:
Tel: (41) 3283-4556 | WhatsApp: (41) 99148-5285
Email: comercial@normatic.com.br

Sempre utilize a busca na web (Google Search) para obter informações técnicas atualizadas. Responda sempre em Português de forma CONCISA.`
                }]
            };

            const consultantChatWindow = document.getElementById('consultant-chat-window');
            const consultantInput = document.getElementById('consultant-input');
            const consultantSendButton = document.getElementById('consultant-send-button');
            const consultantTypingIndicator = document.getElementById('consultant-typing-indicator');

            // Histórico do Chat do Consultor
            let consultantChatHistory = [];

            function appendConsultantMessage(sender, text, sources = []) {
                const messageContainer = document.createElement('div');
                messageContainer.className = sender === 'user' ? 'flex justify-end' : 'flex justify-start';

                const messageBubble = document.createElement('div');
                messageBubble.className = `max-w-xs md:max-w-md p-3 ${sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-ai'}`;
                messageBubble.style.whiteSpace = 'pre-wrap';

                // Limpa notações LaTeX/KaTeX do texto
                let cleanText = text
                    .replace(/\$\\text\{([^}]+)\}\$/g, '$1')  // Remove $\text{...}$
                    .replace(/\$\\text\{([^}]+)\}_\{?([^}$]+)\}?\$/g, '$1$2')  // Remove $\text{...}_{...}$
                    .replace(/\$([^$]+)\$/g, '$1')  // Remove $ ... $ inline
                    .replace(/\\text\{([^}]+)\}/g, '$1')  // Remove \text{...}
                    .replace(/\\([a-zA-Z]+)/g, '')  // Remove comandos LaTeX como \PO
                    .replace(/[_^]\{([^}]+)\}/g, '$1')  // Remove subscritos e sobrescritos _{...} ^{...}
                    .replace(/[_^]([0-9a-zA-Z])/g, '$1');  // Remove subscritos simples _2, ^2

                // Adiciona o texto limpo
                messageBubble.textContent = cleanText;

                // Adiciona as citações/fontes
                if (sources.length > 0) {
                    const sourcesDiv = document.createElement('div');
                    sourcesDiv.className = 'citation';
                    sourcesDiv.innerHTML = '<strong>Fontes:</strong> ' + sources.map((source, index) => {
                        return `<a href="${source.uri}" target="_blank" rel="noopener noreferrer">${source.title || 'Link ' + (index + 1)}</a>`;
                    }).join(', ');
                    messageBubble.appendChild(sourcesDiv);
                }

                messageContainer.appendChild(messageBubble);
                consultantChatWindow.appendChild(messageContainer);
                consultantChatWindow.scrollTop = consultantChatWindow.scrollHeight;
            }

            function showConsultantTypingIndicator() {
                consultantTypingIndicator.classList.remove('hidden');
                consultantChatWindow.scrollTop = consultantChatWindow.scrollHeight;
            }

            function hideConsultantTypingIndicator() {
                consultantTypingIndicator.classList.add('hidden');
            }

            // Função principal para enviar mensagem do consultor
            async function sendConsultantMessage() {
                const query = consultantInput.value.trim();
                if (!query) return;

                // 1. Desabilita input e botão
                consultantInput.disabled = true;
                consultantSendButton.disabled = true;

                // 2. Adiciona a mensagem do usuário e limpa o input
                appendConsultantMessage('user', query);
                consultantInput.value = '';

                // 3. Adiciona a query ao histórico
                consultantChatHistory.push({ role: "user", parts: [{ text: query }] });

                // 4. Mostra indicador de digitação
                showConsultantTypingIndicator();

                try {
                    // 5. Chama a API do Gemini
                    const response = await callConsultantGeminiApi(consultantChatHistory);

                    // 6. Processa a resposta
                    processConsultantResponse(response);

                } catch (error) {
                    console.error("Erro na comunicação com a API do Gemini (Consultor):", error);
                    appendConsultantMessage('ai', "Desculpe, ocorreu um erro ao buscar a informação técnica. Por favor, tente novamente ou entre em contato: (41) 3283-4556");
                } finally {
                    // 7. Esconde indicador e habilita input
                    hideConsultantTypingIndicator();
                    consultantInput.disabled = false;
                    consultantSendButton.disabled = false;
                    consultantInput.focus();
                }
            }

            // Função para chamar a API com retentativas (Exponential Backoff)
            async function callConsultantGeminiApi(history, maxRetries = 5) {
                const apiUrl = buildGeminiUrl('CONSULTANT');
                if (!apiUrl) {
                    return geminiDisabledResult(`⚠️ Módulo de IA (Consultor Técnico) desativado na DEMO.

Para habilitar localmente: abra o Console (F12) e rode:
localStorage.setItem('GEMINI_API_KEY_CONSULTANT','SUA_CHAVE')`);
                }

                const payload = {
                    contents: history,
                    systemInstruction: CONSULTANT_SYSTEM_PROMPT,
                    // Habilita Google Search Grounding
                    tools: [{ "google_search": {} }],
                };

                for (let attempt = 0; attempt < maxRetries; attempt++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429 && attempt < maxRetries - 1) {
                            // Exponencial backoff
                            const delay = Math.pow(2, attempt) * 1000 + Math.random() * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue; // Tenta novamente
                        }

                        if (!response.ok) {
                            throw new Error(`API retornou erro HTTP: ${response.status}`);
                        }

                        return response.json();

                    } catch (error) {
                        if (attempt === maxRetries - 1) {
                            throw error; // Lança o erro após a última tentativa
                        }
                        // Continua para a próxima tentativa
                    }
                }
            }

            // Função para processar a resposta da API
            function processConsultantResponse(result) {
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    consultantChatHistory.push({ role: "model", parts: [{ text: text }] }); // Adiciona a resposta ao histórico

                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    // Exibe a resposta
                    appendConsultantMessage('ai', text, sources);

                } else {
                    appendConsultantMessage('ai', "Desculpe, não consegui gerar uma resposta técnica. Entre em contato: (41) 3283-4556");
                }
            }

            // Função para limpar histórico do consultor (compatibilidade)
            function clearConsultantChatHistory() {
                if (consultantChatWindow) {
                    const messages = consultantChatWindow.querySelectorAll('.flex');
                    messages.forEach((msg, index) => {
                        if (index > 0) { // Mantém apenas a primeira mensagem (boas-vindas)
                            msg.remove();
                        }
                    });
                }
                consultantChatHistory = [];
                console.log('✅ Histórico do consultor técnico limpo');
            }

            // ============================================================================
            // FIM DO CONSULTOR TÉCNICO IA
            // ============================================================================

            // Lógica dos Gráficos do Dashboard
            let chartInstances = {};
            window.chartInstances = chartInstances;
            function renderDashboardCharts(pageId) {
                // Esta função é mantida para os dashboards de Gestor/Admin, mas é ignorada pelo 'dashboard-cliente'
                const chartConfigs = {
                    'dashboard': [
                        { id: 'ordersChart', type: 'bar', data: { labels: ['Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'], datasets: [{ label: 'Nº de Pedidos', data: [5, 9, 7, 8, 6, 12], backgroundColor: 'rgba(23, 60, 88, 0.8)' }] } },
                        { id: 'treatmentsChart', type: 'doughnut', data: { labels: ['Têmpera', 'Revenimento', 'Cementação', 'Outros'], datasets: [{ data: [40, 25, 15, 20], backgroundColor: ['rgba(202, 56, 40, 0.9)', 'rgba(23, 60, 88, 0.9)', 'rgba(202, 56, 40, 0.7)', 'rgba(23, 60, 88, 0.7)'] }] }, options: { plugins: { legend: { display: true }, pieLabels: false } } }
                    ],
                    'qualidade': [{ id: 'qualidadeChart', type: 'line', data: { labels: ['Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'], datasets: [{ label: 'Índice de Conformidade (%)', data: [99.5, 99.6, 99.7, 99.5, 99.8, 99.8], borderColor: 'rgba(23, 60, 88, 1)' }] } }],
                    'expedicao': [{ id: 'expedicaoChart', type: 'bar', data: { labels: ['Transp. A', 'Transp. B', 'Transp. C'], datasets: [{ label: 'Pedidos Entregues', data: [120, 88, 45], backgroundColor: 'rgba(202, 56, 40, 0.8)' }] } }],
                    'tratamentos': [{ id: 'tratamentosChart', type: 'pie', data: { labels: ['Forno A', 'Forno B', 'Forno a Vácuo'], datasets: [{ data: [50, 35, 15], backgroundColor: ['rgba(23, 60, 88, 0.9)', 'rgba(202, 56, 40, 0.9)', 'rgba(23, 60, 88, 0.7)'], offset: 20 }] }, options: { plugins: { legend: { display: false } }, layout: { padding: { top: 20, right: 64, bottom: 20, left: 64 } }, radius: '68%' } }],
                    'financeiro': [{ id: 'financeiroChart', type: 'line', data: { labels: ['Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'], datasets: [{ label: 'Faturação (R$ k)', data: [1100, 1150, 1210, 1180, 1250, 1200], borderColor: 'rgba(23, 60, 88, 1)' }, { label: 'Custos (R$ k)', data: [850, 880, 910, 900, 940, 920], borderColor: 'rgba(202, 56, 40, 1)' }] } }],
                    'rh': [{ id: 'rhChart', type: 'bar', data: { labels: ['Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'], datasets: [{ label: 'Contratações', data: [2, 1, 3, 2, 1, 4], backgroundColor: 'rgba(23, 60, 88, 0.8)' }, { label: 'Desligamentos', data: [1, 0, 1, 2, 0, 1], backgroundColor: 'rgba(202, 56, 40, 0.8)' }] } }]
                };
                const configsToRender = chartConfigs[pageId];
                if (!configsToRender) return;
                
                configsToRender.forEach(config => {
                    const ctx = document.getElementById(config.id)?.getContext('2d');
                    if (!ctx) return;
                    if (chartInstances[config.id]) chartInstances[config.id].destroy();
                    chartInstances[config.id] = new Chart(ctx, { type: config.type, data: config.data, options: Object.assign({ responsive: true }, config.options || {}) });
                });
                // Ensure charts adopt the current theme after creation
                window.chartInstances = chartInstances;
                if (window.updateChartsTheme) window.updateChartsTheme();
            }
            
             // --- NOVA LÓGICA PARA A CALCULADORA DE PROCESSOS ---
            function initializeCalculatorApp() {
                const page = document.getElementById('page-calculadora');
                if (!page || page.dataset.initialized) return;

                const steelDataCalc = {
                    "Aços para Beneficiamento": {
                        "SAE 1030": { maxHardness: "62 HRC", processInfo: { temp: "860-900°C", cooling: "Água" }, treatments: { "180°C": "60", "200°C": "56", "250°C": "54", "300°C": "52", "350°C": "50", "400°C": "47", "450°C": "44", "500°C": "37", "550°C": "34", "600°C": "30", "650°C": "25" } },
                        "SAE 1045": { maxHardness: "62 HRC", processInfo: { temp: "840-880°C", cooling: "Água / Martêmpera" }, treatments: { "180°C": "61", "200°C": "58", "250°C": "55", "300°C": "52", "350°C": "47", "400°C": "43", "450°C": "38", "500°C": "35", "550°C": "30", "600°C": "25", "650°C": "19" } },
                        "SAE 1050": { maxHardness: "63 HRC", processInfo: { temp: "820-860°C", cooling: "Água / Martêmpera" }, treatments: { "180°C": "61", "200°C": "59", "250°C": "57", "300°C": "55", "350°C": "52", "400°C": "48", "450°C": "46", "500°C": "40", "550°C": "38", "600°C": "33", "650°C": "25" } },
                        "SAE 1060": { maxHardness: "62 HRC", processInfo: { temp: "820-860°C", cooling: "Martêmpera" }, treatments: { "180°C": "60", "200°C": "58", "250°C": "55", "300°C": "53", "350°C": "48", "400°C": "45", "450°C": "40", "500°C": "35", "550°C": "30", "600°C": "25", "650°C": "28" } },
                        "SAE 4140": { maxHardness: "58 HRC", processInfo: { temp: "840-880°C", cooling: "Martêmpera" }, treatments: { "180°C": "58", "200°C": "57", "250°C": "56", "300°C": "54", "350°C": "52", "400°C": "49", "450°C": "46", "500°C": "42", "550°C": "38", "600°C": "35", "650°C": "28" } },
                        "SAE 4340": { maxHardness: "58 HRC", processInfo: { temp: "830-870°C", cooling: "Martêmpera" }, treatments: { "180°C": "58", "200°C": "57", "250°C": "56", "300°C": "54", "350°C": "52", "400°C": "49", "450°C": "46", "500°C": "42", "550°C": "38", "600°C": "35", "650°C": "28" } },
                        "SAE 5160": { maxHardness: "55 HRC", processInfo: { temp: "830-870°C", cooling: "Martêmpera" }, treatments: { "180°C": "55", "200°C": "54", "250°C": "53", "300°C": "51", "350°C": "50", "400°C": "48", "450°C": "44", "500°C": "40", "550°C": "35", "600°C": "32", "650°C": "28" } },
                        "SAE 6150": { maxHardness: "58 HRC", processInfo: { temp: "850-890°C", cooling: "Martêmpera" }, treatments: { "180°C": "54", "200°C": "52", "250°C": "48", "300°C": "45", "350°C": "43", "400°C": "40", "450°C": "37", "500°C": "35", "550°C": "33", "600°C": "31", "650°C": "29" } },
                        "SAE 8640": { maxHardness: "56 HRC", processInfo: { temp: "830-870°C", cooling: "Martêmpera" }, treatments: { "180°C": "56", "200°C": "54", "250°C": "53", "300°C": "51", "350°C": "50", "400°C": "48", "450°C": "44", "500°C": "40", "550°C": "35", "600°C": "32", "650°C": "28" } },
                        "SAE 9260": { maxHardness: "60 HRC", processInfo: { temp: "840-880°C", cooling: "Martêmpera" }, treatments: { "180°C": "60", "200°C": "58", "250°C": "57", "300°C": "56", "350°C": "54", "400°C": "52", "450°C": "49", "500°C": "46", "550°C": "42", "600°C": "35", "650°C": "28" } },
                    },
                    "Aços para Cementação": {
                        "SAE 8620": { maxHardness: "64 HRC", processInfo: { temp: "900-930°C", cooling: "Martêmpera" }, treatments: { "180°C": "63", "200°C": "60", "250°C": "58", "300°C": "57", "350°C": "53", "400°C": "50", "500°C": "45", "600°C": "40" } },
                        "SAE 4320": { maxHardness: "64 HRC", processInfo: { temp: "900-930°C", cooling: "Martêmpera" }, treatments: { "180°C": "63", "200°C": "61", "250°C": "58", "300°C": "57", "350°C": "53", "400°C": "50", "500°C": "45", "600°C": "40" } },
                        "SAE 5120": { maxHardness: "63 HRC", processInfo: { temp: "900-930°C", cooling: "Martêmpera" }, treatments: { "180°C": "63", "200°C": "59", "250°C": "57", "300°C": "54", "350°C": "51", "400°C": "47", "500°C": "42", "600°C": "38" } },
                        "SAE 1020": { maxHardness: "65 HRC", processInfo: { temp: "900-930°C", cooling: "Água" }, treatments: { "180°C": "62", "200°C": "60", "250°C": "58", "300°C": "55", "350°C": "50", "400°C": "48", "500°C": "42", "600°C": "35" } },
                    },
                    "Aços Ferramenta": {
                         "SAE D-6": { maxHardness: "64 HRC", processInfo: { temp: "950°C", cooling: "Ar / Martêmpera" }, treatments: { "180°C": "64", "200°C": "63", "250°C": "62", "300°C": "60", "350°C": "58", "400°C": "57", "450°C": "56", "500°C": "53", "550°C": "50", "600°C": "48" } },
                         "SAE D-2": { maxHardness: "63 HRC", processInfo: { temp: "950°C", cooling: "Martêmpera" }, treatments: { "180°C": "62", "200°C": "61", "250°C": "59", "300°C": "58", "350°C": "57", "400°C": "56", "450°C": "55", "500°C": "54", "550°C": "52", "600°C": "50" } },
                         "SAE O-1": { maxHardness: "63 HRC", processInfo: { temp: "790-820°C", cooling: "Martêmpera" }, treatments: { "180°C": "62", "200°C": "61", "250°C": "60", "300°C": "58", "350°C": "55", "400°C": "53", "450°C": "50", "500°C": "48", "550°C": "45", "600°C": "42" } },
                         "SAE H-13": { maxHardness: "56 HRC", processInfo: { temp: "950°C", cooling: "Martêmpera" }, treatments: { "300°C": "56", "350°C": "55", "400°C": "54", "450°C": "53", "500°C": "50" } },
                         "SAE W-1": { maxHardness: "65 HRC", processInfo: { temp: "780-820°C", cooling: "Água" }, treatments: { "180°C": "63", "200°C": "61", "250°C": "60", "300°C": "57", "350°C": "55", "400°C": "53", "450°C": "51", "500°C": "48", "550°C": "45", "600°C": "42" } },
                         "SAE P-20": { maxHardness: "55 HRC", processInfo: { temp: "860°C", cooling: "Martêmpera" }, treatments: { "180°C": "54", "200°C": "49", "250°C": "48", "300°C": "45", "350°C": "38", "400°C": "35", "450°C": "34", "500°C": "30", "550°C": "28"} },
                    }
                };
                const hardnessConversionDataCalc = [
                    { hrc: 65.3, hb: 745, hv: 840, tensile_kgf: 260 }, { hrc: 61.7, hb: 682, hv: 737, tensile_kgf: 240 }, { hrc: 60.0, hb: 653, hv: 697, tensile_kgf: 230 },
                    { hrc: 57.3, hb: 601, hv: 640, tensile_kgf: 212 }, { hrc: 54.7, hb: 555, hv: 591, tensile_kgf: 196 }, { hrc: 52.1, hb: 514, hv: 547, tensile_kgf: 181 },
                    { hrc: 51.0, hb: 495, hv: 528, tensile_kgf: 175 }, { hrc: 49.6, hb: 477, hv: 508, tensile_kgf: 168 }, { hrc: 48.5, hb: 461, hv: 491, tensile_kgf: 163 },
                    { hrc: 47.1, hb: 444, hv: 472, tensile_kgf: 157 }, { hrc: 45.7, hb: 429, hv: 455, tensile_kgf: 151 }, { hrc: 44.5, hb: 415, hv: 440, tensile_kgf: 146 },
                    { hrc: 43.1, hb: 401, hv: 425, tensile_kgf: 142 }, { hrc: 41.8, hb: 388, hv: 410, tensile_kgf: 137 }, { hrc: 40.4, hb: 375, hv: 396, tensile_kgf: 132 },
                    { hrc: 39.1, hb: 363, hv: 383, tensile_kgf: 128 }, { hrc: 37.9, hb: 352, hv: 372, tensile_kgf: 124 }, { hrc: 36.6, hb: 341, hv: 360, tensile_kgf: 120 },
                    { hrc: 35.5, hb: 331, hv: 350, tensile_kgf: 117 }, { hrc: 34.3, hb: 321, hv: 339, tensile_kgf: 113 }, { hrc: 33.1, hb: 311, hv: 328, tensile_kgf: 110 },
                    { hrc: 32.1, hb: 302, hv: 319, tensile_kgf: 107 }, { hrc: 30.9, hb: 293, hv: 309, tensile_kgf: 103 }, { hrc: 29.9, hb: 285, hv: 301, tensile_kgf: 101 },
                    { hrc: 28.8, hb: 277, hv: 292, tensile_kgf: 98 }, { hrc: 27.6, hb: 269, hv: 284, tensile_kgf: 95 }, { hrc: 26.6, hb: 262, hv: 276, tensile_kgf: 92 },
                    { hrc: 25.4, hb: 255, hv: 269, tensile_kgf: 90 }, { hrc: 24.2, hb: 248, hv: 261, tensile_kgf: 88 }, { hrc: 22.8, hb: 241, hv: 253, tensile_kgf: 85 },
                    { hrc: 20.5, hb: 229, hv: 241, tensile_kgf: 81 }
                ];

                const steelSelect = document.getElementById('calc-steel-select');
                const initialHardnessInput = document.getElementById('calc-initial-hardness');
                const resultsSection = document.getElementById('calc-results-section');
                const resultsGrid = document.getElementById('calc-results-grid');
                const welcomeMessage = document.getElementById('calc-welcome-message');
                const noResultsMessage = document.getElementById('calc-no-results-message');
                const processInfoContainer = document.getElementById('calc-process-info-container');
                const modal = document.getElementById('calc-conversion-modal');
                const modalBackdrop = document.getElementById('calc-modal-backdrop');
                const modalContent = document.getElementById('calc-modal-content');
                const modalBody = document.getElementById('calc-modal-body');
                const closeModalBtn = document.getElementById('calc-close-modal-btn');

                Object.keys(steelDataCalc).forEach(category => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = category;
                    const steelsInCategory = steelDataCalc[category];
                    Object.keys(steelsInCategory).sort().forEach(steelName => {
                        const option = document.createElement('option');
                        option.value = `${category}|${steelName}`;
                        option.textContent = steelName;
                        optgroup.appendChild(option);
                    });
                    steelSelect.appendChild(optgroup);
                });
                
                function findClosestConversion(hrc) {
                    if (!hrc || isNaN(hrc)) return { hrc: hrc, hb: 'N/A', hv: 'N/A', tensile_kgf: 'N/A' };
                    return hardnessConversionDataCalc.reduce((prev, curr) => (Math.abs(curr.hrc - hrc) < Math.abs(prev.hrc - hrc) ? curr : prev));
                }

                function showModal(hrc) {
                    const conversion = findClosestConversion(parseFloat(hrc));
                    modalBody.innerHTML = `
                        <div class="flex justify-between border-b pb-2"><span class="font-semibold text-gray-700">Rockwell C (HRC):</span><span class="font-bold text-red-600 text-lg">${hrc}</span></div>
                        <div class="flex justify-between border-b py-2"><span class="font-semibold text-gray-700">Brinell (HB):</span><span class="font-bold text-gray-800">${conversion.hb}</span></div>
                        <div class="flex justify-between border-b py-2"><span class="font-semibold text-gray-700">Vickers (HV):</span><span class="font-bold text-gray-800">${conversion.hv}</span></div>
                        <div class="flex justify-between pt-2"><span class="font-semibold text-gray-700">Resist. à Tração:</span><span class="font-bold text-gray-800">${conversion.tensile_kgf} kgf/mm²</span></div>`;
                    modal.classList.remove('hidden');
                    modal.classList.add('flex');
                }

                function hideModal() {
                     modal.classList.add('hidden');
                     modal.classList.remove('flex');
                }

                closeModalBtn.addEventListener('click', hideModal);
                modalBackdrop.addEventListener('click', hideModal);

                steelSelect.addEventListener('change', (event) => {
                    const [category, selectedSteelName] = event.target.value.split('|');
                    const data = steelDataCalc[category][selectedSteelName];
                    if (!data) return;

                    welcomeMessage.classList.add('hidden');
                    resultsSection.classList.remove('hidden');
                    processInfoContainer.classList.remove('hidden');
                    initialHardnessInput.value = data.maxHardness;
                    processInfoContainer.innerHTML = `
                        <p class="font-bold normatic-blue-text">Parâmetros de Têmpera:</p>
                        <p class="text-gray-600"><span class="font-medium">Temperatura:</span> ${data.processInfo.temp}</p>
                        <p class="text-gray-600"><span class="font-medium">Resfriamento:</span> ${data.processInfo.cooling}</p>`;
                    resultsGrid.innerHTML = '';
                    const treatments = data.treatments;
                    const treatmentKeys = Object.keys(treatments);
                    noResultsMessage.classList.toggle('hidden', treatmentKeys.length > 0);
                    treatmentKeys.forEach(temp => {
                        const hardness = treatments[temp];
                        const card = document.createElement('div');
                        card.className = 'bg-gray-50 rounded-lg p-4 text-center border border-gray-200 hover:shadow-md hover:border-red-400 transition-all duration-200 cursor-pointer';
                        card.innerHTML = `
                            <p class="text-sm text-gray-500 font-medium">Revenimento</p>
                            <p class="text-lg font-semibold normatic-red-text">${temp}</p>
                            <p class="mt-2 text-sm text-gray-500">Dureza Final</p>
                            <p class="text-xl font-bold text-gray-900">${hardness} HRC</p>`;
                        card.addEventListener('click', () => showModal(hardness));
                        resultsGrid.appendChild(card);
                    });
                });

                page.dataset.initialized = 'true';
            }


            // --- INICIALIZAÇÃO GERAL ---
            lucide.createIcons();
            updateWhatsappVisibility();

            // --- LIGAÇÃO COM ANDROID WEBVIEW ---
            function triggerAppBack() {
                const isPortalVisible = !document.getElementById('client-portal-wrapper').classList.contains('hidden');
                if (isPortalVisible && navigationHistory.length > 0) {
                    const previousFunctionButton = document.getElementById('previous-function-button');
                    if (previousFunctionButton) {
                        previousFunctionButton.click();
                        return true;
                    }
                }
                return false; 
            }

            // --- LÓGICA PARA LAYOUT RESPONSIVO DO CABEÇALHO ---\
            function handleResponsiveHeader() {
                const headerTopContainer = document.querySelector('.header-top .container');
                const mainNav = document.getElementById('main-nav');
                const headerAuthSection = document.getElementById('header-auth-section');
                
                if (!headerTopContainer || !mainNav || !headerAuthSection) {
                    console.error("Elementos do cabeçalho não encontrados para o script de responsividade.");
                    return;
                }

                if (window.innerWidth <= 500) {
                    if (headerAuthSection.parentElement !== mainNav) {
                        mainNav.appendChild(headerAuthSection);
                    }
                } else {
                    if (headerAuthSection.parentElement !== headerTopContainer) {
                        headerTopContainer.appendChild(headerAuthSection);
                    }
                }
            }
            
            window.addEventListener('resize', handleResponsiveHeader);
            handleResponsiveHeader();
            
            // --- LÓGICA DO UPLOAD (ADMINISTRADOR) - CORRIGIDA PARA PREVENIR CRASH/RELOAD ---
            const uploadForm = document.getElementById('upload-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', (e) => {
                    e.preventDefault(); // Impedir o reload da página!
                    // CORREÇÃO: Pega o valor do clientId (Nome da Empresa)
                    const clientId = document.getElementById('upload-client-id').value.trim(); 
                    const orderId = document.getElementById('upload-order-id').value.trim();
                    const docType = document.getElementById('upload-doc-type').value;
                    const fileInput = document.getElementById('upload-file');
                    
                    if (!clientId || !docType || fileInput.files.length === 0) {
                        showConfirmation('Por favor, preencha o ID do Cliente, Tipo e selecione um arquivo.');
                        return;
                    }

                    const file = fileInput.files[0];
                    const reader = new FileReader();

                    reader.onload = function(event) {
                        const fileContent = event.target.result; // Conteúdo do arquivo como Data URL

                        mockUploadedFiles.unshift({ 
                            docId: `doc${Date.now()}`,
                            clientId: clientId, // Usa o nome completo da empresa
                            orderId: orderId,
                            type: docType,
                            fileName: file.name,
                            fileContent: fileContent, // Armazena o conteúdo completo (Data URL)
                            date: new Date().toLocaleDateString('pt-BR')
                        });

                        showConfirmation(`Documento "${file.name}" enviado com sucesso para ${clientId}!`);
                        e.target.reset();
                        // Garante que o input de arquivo é limpo após o upload
                        fileInput.value = ''; 
                    };

                    reader.onerror = function(error) {
                        console.error("Error reading file:", error);
                        showConfirmation("Erro ao ler o arquivo para upload.");
                    };

                    reader.readAsDataURL(file); // Lê o arquivo como Data URL
                });
            }

            // =========================
            //   LISTA DE CLIENTES - EXPANDIR/RECOLHER
            // =========================
            document.querySelectorAll('.cliente-item').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const details = this.parentElement.querySelector('.cliente-details');
                    const chevron = this.querySelector('[data-lucide="chevron-down"]');
                    
                    // Toggle detalhes
                    details.classList.toggle('hidden');
                    
                    // Rotacionar ícone
                    if (details.classList.contains('hidden')) {
                        chevron.style.transform = 'rotate(0deg)';
                    } else {
                        chevron.style.transform = 'rotate(180deg)';
                    }
                });
            });

            // =========================
            //   BUSCA DE CLIENTES
            // =========================
            const searchInput = document.getElementById('search-clientes');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    const clienteCards = document.querySelectorAll('#clientes-list > div');
                    
                    clienteCards.forEach(function(card) {
                        const nome = card.querySelector('h3').textContent.toLowerCase();
                        const cnpj = card.querySelector('.text-sm').textContent.toLowerCase();
                        const emailEl = card.querySelector('.cliente-details .text-gray-900');
                        const email = emailEl ? emailEl.textContent.toLowerCase() : '';
                        
                        // Verifica se o termo de busca está presente em nome, CNPJ ou e-mail
                        if (nome.includes(searchTerm) || cnpj.includes(searchTerm) || email.includes(searchTerm)) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }

            // =========================
            //   CADASTRO DE CLIENTES
            // =========================
            const formCadastroCliente = document.getElementById('cadastro-cliente-form');
            if (formCadastroCliente) {
                formCadastroCliente.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Pegar valores dos campos
                    const nome = document.getElementById('cliente-nome').value.trim();
                    const cnpj = document.getElementById('cliente-cnpj').value.trim();
                    const email = document.getElementById('cliente-email').value.trim();
                    const telefone = document.getElementById('cliente-telefone').value.trim();
                    const endereco = document.getElementById('cliente-endereco').value.trim();
                    const contato = document.getElementById('cliente-contato').value.trim();
                    
                    // Validar campos obrigatórios
                    if (!nome || !cnpj || !email || !telefone || !endereco || !contato) {
                        alert('Por favor, preencha todos os campos obrigatórios.');
                        return;
                    }
                    
                    // Gerar cor aleatória para o ícone
                    const cores = [
                        {bg: 'bg-blue-100 dark:bg-blue-900', text: 'text-blue-600 dark:text-blue-300'},
                        {bg: 'bg-purple-100 dark:bg-purple-900', text: 'text-purple-600 dark:text-purple-300'},
                        {bg: 'bg-orange-100 dark:bg-orange-900', text: 'text-orange-600 dark:text-orange-300'},
                        {bg: 'bg-green-100 dark:bg-green-900', text: 'text-green-600 dark:text-green-300'},
                        {bg: 'bg-red-100 dark:bg-red-900', text: 'text-red-600 dark:text-red-300'},
                        {bg: 'bg-indigo-100 dark:bg-indigo-900', text: 'text-indigo-600 dark:text-indigo-300'},
                        {bg: 'bg-yellow-100 dark:bg-yellow-900', text: 'text-yellow-600 dark:text-yellow-300'},
                        {bg: 'bg-pink-100 dark:bg-pink-900', text: 'text-pink-600 dark:text-pink-300'},
                        {bg: 'bg-teal-100 dark:bg-teal-900', text: 'text-teal-600 dark:text-teal-300'},
                        {bg: 'bg-cyan-100 dark:bg-cyan-900', text: 'text-cyan-600 dark:text-cyan-300'}
                    ];
                    const corEscolhida = cores[Math.floor(Math.random() * cores.length)];
                    
                    // Data de cadastro (hoje)
                    const hoje = new Date();
                    const dataFormatada = hoje.toLocaleDateString('pt-BR');
                    
                    // Criar HTML do novo cliente
                    const novoClienteHTML = `
                        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden">
                            <button type="button" class="cliente-item w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 ${corEscolhida.bg} rounded-full flex items-center justify-center">
                                        <i data-lucide="building-2" class="w-6 h-6 ${corEscolhida.text}"></i>
                                    </div>
                                    <div class="text-left">
                                        <h3 class="font-semibold text-gray-900 dark:text-gray-100">${nome}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: ${cnpj}</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                            </button>
                            <div class="cliente-details hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                        <p class="text-gray-900 dark:text-gray-100">${email}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                        <p class="text-gray-900 dark:text-gray-100">${telefone}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                        <p class="text-gray-900 dark:text-gray-100">${endereco}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                        <p class="text-gray-900 dark:text-gray-100">${contato}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                        <p class="text-gray-900 dark:text-gray-100">${dataFormatada}</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">Ativo</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Adicionar à lista
                    const clientesList = document.getElementById('clientes-list');
                    if (clientesList) {
                        clientesList.insertAdjacentHTML('afterbegin', novoClienteHTML);
                        
                        // Reinicializar ícones Lucide
                        if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
                            lucide.createIcons();
                        }
                        
                        // Adicionar event listener ao novo item
                        const novoItem = clientesList.querySelector('.cliente-item');
                        if (novoItem) {
                            novoItem.addEventListener('click', function() {
                                const details = this.parentElement.querySelector('.cliente-details');
                                const chevron = this.querySelector('[data-lucide="chevron-down"]');
                                
                                details.classList.toggle('hidden');
                                
                                if (details.classList.contains('hidden')) {
                                    chevron.style.transform = 'rotate(0deg)';
                                } else {
                                    chevron.style.transform = 'rotate(180deg)';
                                }
                            });
                        }
                    }
                    
                    // Exibir mensagem de sucesso
                    const confirmationMessage = document.getElementById('confirmation-message');
                    const confirmationText = document.getElementById('confirmation-text');
                    if (confirmationMessage && confirmationText) {
                        confirmationText.textContent = 'Cliente cadastrado com sucesso!';
                        confirmationMessage.classList.remove('hidden');
                        setTimeout(function() {
                            confirmationMessage.classList.add('hidden');
                        }, 3000);
                    }
                    
                    // Limpar formulário
                    formCadastroCliente.reset();
                });
            }

            // ===== EDITAR CLIENTES =====
            
            // Função para renderizar lista de clientes editável
            function renderEditableClientsList() {
                const editarClientesList = document.getElementById('editar-clientes-list');
                if (!editarClientesList) return;

                // Limpar lista atual
                editarClientesList.innerHTML = '';

                // Obter todos os clientes da lista principal
                const clientesCards = document.querySelectorAll('#clientes-list > div');
                
                clientesCards.forEach((card, index) => {
                    // Extrair dados do cliente
                    const nome = card.querySelector('h3').textContent;
                    const cnpj = card.querySelector('.text-sm').textContent.replace('CNPJ: ', '');
                    const detailsDiv = card.querySelector('.cliente-details');
                    const detailsText = detailsDiv.querySelectorAll('p.text-gray-900, p.dark\\:text-gray-100');
                    
                    const email = detailsText[0].textContent;
                    const telefone = detailsText[1].textContent;
                    const endereco = detailsText[2].textContent;
                    const contato = detailsText[3].textContent;
                    const dataCadastro = detailsText[4].textContent;
                    const statusBadge = detailsDiv.querySelector('span');
                    const status = statusBadge.textContent;
                    
                    // Obter classes completas de cor do ícone (evita classes dinâmicas incompatíveis com Tailwind)
                    const iconDiv = card.querySelector('.w-12.h-12, .w-12.h-12');
                    const iconBgClasses = iconDiv ? Array.from(iconDiv.classList).filter(c => c.startsWith('bg-') || c.startsWith('dark:bg-')).join(' ') : 'bg-blue-100 dark:bg-blue-900';
                    const iconI = card.querySelector('i[data-lucide="building-2"]');
                    const iconTextClasses = iconI ? Array.from(iconI.classList).filter(c => c.startsWith('text-') || c.startsWith('dark:text-')).join(' ') : 'text-blue-600 dark:text-blue-300';

                    // Criar card editável
                    const clienteCard = document.createElement('div');
                    clienteCard.className = 'bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm overflow-hidden';
                    clienteCard.setAttribute('data-cliente-id', cnpj);
                    
                    clienteCard.innerHTML = `
                        <button type="button" class="cliente-item-editar w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 ${iconBgClasses} rounded-full flex items-center justify-center">
                                    <i data-lucide="building-2" class="w-6 h-6 ${iconTextClasses}"></i>
                                </div>
                                <div class="text-left">
                                    <h3 class="font-semibold text-gray-900 dark:text-gray-100">${nome}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">CNPJ: ${cnpj}</p>
                                </div>
                            </div>
                            <i data-lucide="chevron-down" class="w-5 h-5 text-gray-400 transform transition-transform"></i>
                        </button>
                        <div class="cliente-details-editar hidden px-6 py-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">E-mail:</p>
                                    <p class="text-gray-900 dark:text-gray-100">${email}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">Telefone:</p>
                                    <p class="text-gray-900 dark:text-gray-100">${telefone}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">Endereço:</p>
                                    <p class="text-gray-900 dark:text-gray-100">${endereco}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">Contato Principal:</p>
                                    <p class="text-gray-900 dark:text-gray-100">${contato}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">Data de Cadastro:</p>
                                    <p class="text-gray-900 dark:text-gray-100">${dataCadastro}</p>
                                </div>
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 font-medium">Status:</p>
                                    <span class="status-badge inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${status === 'Ativo' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'}">${status}</span>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-2 border-t border-gray-200 dark:border-gray-700 pt-4">
                                <button type="button" class="btn-editar-cliente flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                    Editar
                                </button>
                                <button type="button" class="btn-inativar-cliente flex items-center gap-2 px-4 py-2 ${status === 'Ativo' ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-green-600 hover:bg-green-700'} text-white rounded-lg transition">
                                    <i data-lucide="${status === 'Ativo' ? 'pause' : 'play'}" class="w-4 h-4"></i>
                                    ${status === 'Ativo' ? 'Inativar' : 'Ativar'}
                                </button>
                                <button type="button" class="btn-excluir-cliente flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    Excluir
                                </button>
                            </div>
                        </div>
                    `;
                    
                    editarClientesList.appendChild(clienteCard);
                });

                // Recriar ícones do Lucide
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }

                // Adicionar event listeners para expandir/recolher
                const clienteItems = editarClientesList.querySelectorAll('.cliente-item-editar');
                clienteItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const details = this.nextElementSibling;
                        const chevron = this.querySelector('[data-lucide="chevron-down"]');
                        
                        details.classList.toggle('hidden');
                        if (chevron) {
                            chevron.style.transform = details.classList.contains('hidden') ? '' : 'rotate(180deg)';
                        }
                    });
                });

                // Adicionar event listeners para botões de ação
                addEditActionListeners();
            }

            // Função para adicionar listeners aos botões de ação
            function addEditActionListeners() {
                // Botões de editar
                document.querySelectorAll('.btn-editar-cliente').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const card = this.closest('[data-cliente-id]');
                        const cnpj = card.getAttribute('data-cliente-id');
                        editCliente(cnpj);
                    });
                });

                // Botões de inativar/ativar
                document.querySelectorAll('.btn-inativar-cliente').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const card = this.closest('[data-cliente-id]');
                        const cnpj = card.getAttribute('data-cliente-id');
                        toggleStatusCliente(cnpj);
                    });
                });

                // Botões de excluir
                document.querySelectorAll('.btn-excluir-cliente').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const card = this.closest('[data-cliente-id]');
                        const cnpj = card.getAttribute('data-cliente-id');
                        const nome = card.querySelector('h3').textContent;
                        deleteCliente(cnpj, nome);
                    });
                });
            }

            // Função para editar cliente
            function editCliente(cnpj) {
                // Encontrar o card na lista principal
                const clienteCards = document.querySelectorAll('#clientes-list > div');
                let clienteCard = null;
                
                clienteCards.forEach(card => {
                    const cardCnpj = card.querySelector('.text-sm').textContent.replace('CNPJ: ', '');
                    if (cardCnpj === cnpj) {
                        clienteCard = card;
                    }
                });

                if (!clienteCard) return;

                // Extrair dados atuais
                const nome = clienteCard.querySelector('h3').textContent;
                const detailsDiv = clienteCard.querySelector('.cliente-details');
                const detailsText = detailsDiv.querySelectorAll('p.text-gray-900, p.dark\\:text-gray-100');
                
                const email = detailsText[0].textContent;
                const telefone = detailsText[1].textContent;
                const endereco = detailsText[2].textContent;
                const contato = detailsText[3].textContent;

                // Criar modal de edição
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">Editar Cliente</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">CNPJ: ${cnpj}</p>
                        </div>
                        <form id="form-edit-cliente" class="p-6 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nome da Empresa *</label>
                                <input type="text" name="nome" value="${nome}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">E-mail *</label>
                                <input type="email" name="email" value="${email}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Telefone *</label>
                                <input type="tel" name="telefone" value="${telefone}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Endereço Completo *</label>
                                <input type="text" name="endereco" value="${endereco}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Contato Principal *</label>
                                <input type="text" name="contato" value="${contato}" required class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100">
                            </div>
                            <div class="flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition">
                                    Salvar Alterações
                                </button>
                                <button type="button" class="btn-cancel-edit flex-1 bg-gray-300 hover:bg-gray-400 dark:bg-gray-600 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-100 font-medium py-2 px-4 rounded-lg transition">
                                    Cancelar
                                </button>
                            </div>
                        </form>
                    </div>
                `;

                document.body.appendChild(modal);

                // Event listener para cancelar
                modal.querySelector('.btn-cancel-edit').addEventListener('click', function() {
                    document.body.removeChild(modal);
                });

                // Event listener para fechar ao clicar fora
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });

                // Event listener para salvar
                modal.querySelector('#form-edit-cliente').addEventListener('submit', function(e) {
                    e.preventDefault();

                    const formData = new FormData(this);
                    const novoNome = formData.get('nome');
                    const novoEmail = formData.get('email');
                    const novoTelefone = formData.get('telefone');
                    const novoEndereco = formData.get('endereco');
                    const novoContato = formData.get('contato');

                    // Atualizar na lista principal
                    clienteCard.querySelector('h3').textContent = novoNome;
                    detailsText[0].textContent = novoEmail;
                    detailsText[1].textContent = novoTelefone;
                    detailsText[2].textContent = novoEndereco;
                    detailsText[3].textContent = novoContato;

                    // Atualizar na lista de edição
                    renderEditableClientsList();

                    // Fechar modal
                    document.body.removeChild(modal);

                    // Mostrar mensagem de sucesso
                    const confirmationMessage = document.getElementById('confirmation-message');
                    const confirmationText = document.getElementById('confirmation-text');
                    if (confirmationMessage && confirmationText) {
                        confirmationText.textContent = 'Cliente atualizado com sucesso!';
                        confirmationMessage.classList.remove('hidden');
                        setTimeout(function() {
                            confirmationMessage.classList.add('hidden');
                        }, 3000);
                    }
                });
            }

            // Função para inativar/ativar cliente
            function toggleStatusCliente(cnpj) {
                // Encontrar o card na lista principal
                const clienteCards = document.querySelectorAll('#clientes-list > div');
                let clienteCard = null;
                
                clienteCards.forEach(card => {
                    const cardCnpj = card.querySelector('.text-sm').textContent.replace('CNPJ: ', '');
                    if (cardCnpj === cnpj) {
                        clienteCard = card;
                    }
                });

                if (!clienteCard) return;

                // Obter status atual
                const statusBadge = clienteCard.querySelector('.cliente-details span');
                const statusAtual = statusBadge.textContent;
                const novoStatus = statusAtual === 'Ativo' ? 'Inativo' : 'Ativo';

                // Confirmar ação
                const acao = novoStatus === 'Inativo' ? 'inativar' : 'ativar';
                if (!confirm(`Tem certeza que deseja ${acao} este cliente?`)) {
                    return;
                }

                // Atualizar badge na lista principal
                statusBadge.textContent = novoStatus;
                statusBadge.className = novoStatus === 'Ativo' 
                    ? 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                    : 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200';

                // Atualizar lista de edição
                renderEditableClientsList();

                // Mostrar mensagem de sucesso
                const confirmationMessage = document.getElementById('confirmation-message');
                const confirmationText = document.getElementById('confirmation-text');
                if (confirmationMessage && confirmationText) {
                    confirmationText.textContent = `Cliente ${novoStatus === 'Inativo' ? 'inativado' : 'ativado'} com sucesso!`;
                    confirmationMessage.classList.remove('hidden');
                    setTimeout(function() {
                        confirmationMessage.classList.add('hidden');
                    }, 3000);
                }
            }

            // Função para excluir cliente
            function deleteCliente(cnpj, nome) {
                if (!confirm(`Tem certeza que deseja excluir o cliente "${nome}"?\n\nEsta ação não pode ser desfeita.`)) {
                    return;
                }

                // Remover da lista principal
                const clienteCards = document.querySelectorAll('#clientes-list > div');
                clienteCards.forEach(card => {
                    const cardCnpj = card.querySelector('.text-sm').textContent.replace('CNPJ: ', '');
                    if (cardCnpj === cnpj) {
                        card.remove();
                    }
                });

                // Atualizar lista de edição
                renderEditableClientsList();

                // Mostrar mensagem de sucesso
                const confirmationMessage = document.getElementById('confirmation-message');
                const confirmationText = document.getElementById('confirmation-text');
                if (confirmationMessage && confirmationText) {
                    confirmationText.textContent = 'Cliente excluído com sucesso!';
                    confirmationMessage.classList.remove('hidden');
                    setTimeout(function() {
                        confirmationMessage.classList.add('hidden');
                    }, 3000);
                }
            }

            // Busca na lista de editar clientes
            const searchEditarClientes = document.getElementById('search-editar-clientes');
            if (searchEditarClientes) {
                searchEditarClientes.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const clienteCards = document.querySelectorAll('#editar-clientes-list > div');

                    clienteCards.forEach(card => {
                        const nome = card.querySelector('h3').textContent.toLowerCase();
                        const cnpj = card.querySelector('.text-sm').textContent.toLowerCase();
                        const email = card.querySelector('.cliente-details-editar p.text-gray-900, .cliente-details-editar p.dark\\:text-gray-100').textContent.toLowerCase();

                        if (nome.includes(searchTerm) || cnpj.includes(searchTerm) || email.includes(searchTerm)) {
                            card.style.display = '';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            }

            // Renderizar lista editável ao carregar
            renderEditableClientsList();

            // ===== RASTREAMENTO EM TEMPO REAL (Leaflet) =====
            // Rota da Normatic (R. Anselmo Vacari, 254) até a Volvo no CIC (aproximação)
            function generateRouteNormaticToVolvo() {
                // Observação: coordenadas aproximadas para demonstração (sem geocodificação online)
                const A = { lat: -25.5452, lng: -49.1678, name: 'Saída: Normatic (R. Anselmo Vacari, 254)' };
                const p1 = { lat: -25.5405, lng: -49.1800, name: 'Curva 1' };
                const p2 = { lat: -25.5350, lng: -49.2000, name: 'Curva 2' };
                const p3 = { lat: -25.5300, lng: -49.2300, name: 'Curva 3' };
                const p4 = { lat: -25.5220, lng: -49.2600, name: 'Curva 4' };
                const p5 = { lat: -25.5140, lng: -49.3000, name: 'Curva 5' };
                const p6 = { lat: -25.5055, lng: -49.3300, name: 'Curva 6' };
                const p7 = { lat: -25.4985, lng: -49.3450, name: 'Curva 7' };
                const B = { lat: -25.4955, lng: -49.3545, name: 'Destino: Volvo (CIC)' };
                return [A, p1, p2, p3, p4, p5, p6, p7, B];
            }

            let rastreamentoRoute = generateRouteNormaticToVolvo();

            window.rastreamentoMap = null;
            let rastreamentoMarker = null;
            let rastreamentoPolyline = null;
            let rastreamentoIndex = 0;
            // Parâmetros de animação (mais lento e cadenciado)
            const RAST_SEGMENT_DURATION = 5000; // ms por trecho (mais lento)
            const RAST_PAUSE_MS = 500; // pausa breve em cada ponto
            let rastAnimationFrame = null;
            let rastPauseTimeout = null;
            let rastLastTs = null;
            let rastFrom = null;
            let rastTo = null;
            let rastElapsed = 0;

            function initRastreamentoMap() {
                const mapDiv = document.getElementById('leaflet-map');
                if (!mapDiv) return;
                if (window.rastreamentoMap) {
                    // Garantir que o tamanho seja recalculado ao reexibir
                    setTimeout(() => window.rastreamentoMap.invalidateSize(), 100);
                    return;
                }

                window.rastreamentoMap = L.map('leaflet-map').setView([rastreamentoRoute[0].lat, rastreamentoRoute[0].lng], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap'
                }).addTo(window.rastreamentoMap);

                // Traçado completo da rota (desenhado de uma vez)
                const fullLatLngs = rastreamentoRoute.map(p => [p.lat, p.lng]);
                rastreamentoPolyline = L.polyline(fullLatLngs, {
                    color: '#ca3828',
                    weight: 5,
                    opacity: 0.9,
                    lineJoin: 'round',
                    lineCap: 'round'
                }).addTo(window.rastreamentoMap);
                window.rastreamentoMap.fitBounds(rastreamentoPolyline.getBounds(), { padding: [20, 20] });

                // Marcador do caminhão
                const truckIcon = L.divIcon({ className: 'truck-icon', html: '🚚', iconSize: [24, 24], iconAnchor: [12, 12] });
                rastreamentoMarker = L.marker([rastreamentoRoute[0].lat, rastreamentoRoute[0].lng], { icon: truckIcon }).addTo(window.rastreamentoMap);

                // Ajuste de tamanho pós-renderização
                setTimeout(() => window.rastreamentoMap.invalidateSize(), 150);
            }

            function startRastreamentoAnimation() {
                const loc = document.getElementById('truck-location');
                if (!window.rastreamentoMap) initRastreamentoMap();
                stopRastreamentoAnimation();
                rastreamentoIndex = 0;
                rastFrom = rastreamentoRoute[0];
                rastTo = rastreamentoRoute[1] || rastreamentoRoute[0];
                rastElapsed = 0;
                rastLastTs = null;
                if (rastreamentoMarker) rastreamentoMarker.setLatLng([rastFrom.lat, rastFrom.lng]);
                if (loc) loc.textContent = `Saída: Normatic (R. Anselmo Vacari, 254) → Destino: Volvo (CIC)`;
                if (window.rastreamentoMap) window.rastreamentoMap.flyTo([rastTo.lat, rastTo.lng], window.rastreamentoMap.getZoom(), { animate: true, duration: RAST_SEGMENT_DURATION / 1000 });

                const step = (ts) => {
                    if (rastLastTs == null) rastLastTs = ts;
                    const delta = ts - rastLastTs;
                    rastLastTs = ts;
                    rastElapsed += delta;
                    const t = Math.min(rastElapsed / RAST_SEGMENT_DURATION, 1);
                    const lat = rastFrom.lat + (rastTo.lat - rastFrom.lat) * t;
                    const lng = rastFrom.lng + (rastTo.lng - rastFrom.lng) * t;
                    if (rastreamentoMarker) rastreamentoMarker.setLatLng([lat, lng]);

                    if (t < 1) {
                        rastAnimationFrame = requestAnimationFrame(step);
                    } else {
                        // Final do trecho: atualiza índice e pausa breve (sem loop; para no destino)
                        // Se já estamos chegando no último ponto, finalizar animação
                        if (rastreamentoIndex + 1 >= rastreamentoRoute.length - 1) {
                            // Garantir posicionamento final
                            if (rastreamentoMarker) rastreamentoMarker.setLatLng([rastTo.lat, rastTo.lng]);
                            if (loc) loc.textContent = `Chegada no destino: Volvo (CIC)`;
                            // Não agenda novo segmento (encerra)
                            return;
                        }
                        // Avança para o próximo ponto intermediário
                        rastreamentoIndex = rastreamentoIndex + 1;
                        const p = rastreamentoRoute[rastreamentoIndex];
                        if (loc) loc.textContent = `Agora: ${p.name || 'Ponto'}`;
                        rastPauseTimeout = setTimeout(() => {
                            rastFrom = p;
                            rastTo = rastreamentoRoute[rastreamentoIndex + 1];
                            rastElapsed = 0;
                            rastLastTs = null;
                            if (window.rastreamentoMap) window.rastreamentoMap.flyTo([rastTo.lat, rastTo.lng], window.rastreamentoMap.getZoom(), { animate: true, duration: RAST_SEGMENT_DURATION / 1000 });
                            rastAnimationFrame = requestAnimationFrame(step);
                        }, RAST_PAUSE_MS);
                    }
                };

                rastAnimationFrame = requestAnimationFrame(step);
            }

            function stopRastreamentoAnimation() {
                if (rastAnimationFrame) {
                    cancelAnimationFrame(rastAnimationFrame);
                    rastAnimationFrame = null;
                }
                if (rastPauseTimeout) {
                    clearTimeout(rastPauseTimeout);
                    rastPauseTimeout = null;
                }
                rastLastTs = null;
            }

    </script>
</body>
</html>
